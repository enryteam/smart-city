# 一、大数据融合分析子系统

信息计算主要对规整后的数据实时的进行计算，主要包含以下几种计算功能：

Ø 交通调查指标数据的计算，如平均速度、饱和度等

Ø 交通运行指数的计算，包括整体交通运行指数和区域交通运行指数

Ø 信号优化计算，包括自适应信控配时以及干道绿波计算

Ø 基于车辆识别的OD数据分析计算

Ø 基于车辆识别的黑车、套牌车分析计算

Ø 多源数据融合分析

## 1.1 交通调查指标数据计算

### 1.1.1 概述

道路的交通状况有多种表现的方式，一般从交通量、交通流密度、交通流速度、交通延误、道路通行能力等各个方面去评估。

Ø 交通量

交通量是指单位时间内，通过道路某一地点或某一断面的实际交通参与者（本方案中具体指机动车辆，因行人与非机动车辆的无序无规则性暂不纳入考虑范围）的数量，又称交通流量或称流量。如果不加说明时，通常是指单位时间内通过道路某一地点或某一断面往来两个方向的车辆数，亦称为车流量

1）平均交通量

交通量不是一个静止的量，它是随时间变化的，在表达方式上通常取某一时段内的平均值作为该时段的代表交通量。如，年平均日交通量就是将一年内的交通量总数除以当年的总天数所得出的平均值。常用的平均日交通量还有月平均日交通量、周平均日交通量以及任意期间（依特定分析目的而定）的平均日交通量等。

2）高峰小时交通量

指一天内的交通高峰期间连续1h的最大小时交通量。

Ø 交通流速度

行车速度既是道路规划设计中的一项指控指标，又是车辆运营效率的一项评议指标。速度在某种程度上是效益的表征，对于运输安全、迅捷、经济和舒适具有重要意义。设车辆在t时间内、在道路上行驶l距离，则车速可用![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps54.jpg)形式表示。按l和t的取值不同，可定义各种不同车速:

1）地点车速（又叫点车速或瞬时车速）

车辆驶过道路上某一断面时的瞬时速度，观测距离很短，以行驶该距离的时间小于2s为限。汽车上车速里程表指示的车速、交通标志中限制的车速和雷达测速仪测得的车速均为地点车速，它是用作道路设计、交通管理和规划的依据。

2）行驶车速

它是指车辆在某一路段所行距离，用有效行驶时间（不包括停车时间）除之所求的车速。行驶车速用来分析道路区段行驶难易程度和设计道路通行能力以及车辆运行的成本效益分析。

3）行程车速

行程车速又称区间车速，是车辆行驶路程与通过该路程所需的总时间（包括停车时间）之比。行程车速是一项综合性指标，用以评价道路的通畅程度，估计行车延误情况。要提高运输效率归根结底是要提高车辆的行程车速。

4）设计车速

设计车速是指在道路交通与气候条件良好的情况下仅收到路条件限制所能保持的最大安全车速，用作道路线性几何设计的标准。

5）时间平均车速和区间平均车速

时间平均车速是车辆通过道路某断面时，某段时间内车速分布的平均值，简称平均车速。它的大小就是地点车速观测值的算术平均值。区间平均车速（即路段平均车速），如果说时间平均车速表征的是该路段的“点”车速，那么区间平均车速则表征了某观测路段的“线”车速。它的定义为：某瞬间道路上某区间内全部车辆车速分布的调和平均值，或者定义为一批车辆通过某一路段时，其行驶距离与各辆车行程时间的平均值之比。

Ø 交通流密度

是指在某一时刻，某单位长的路段上一条车道或几条车道内的车辆数。它是反映道路上车辆的密集程度、衡量道路上车流畅通情况的重要指标。在交通流密度中，能够使道路上的交通量达到最大值时的密度，称为最佳车流密度；而道路上的车流使车辆几乎无法进行，即发生交通阻塞时的交通流密度，称为阻塞密度。

Ø 车道占有率

由于交通密度是瞬时值，随观测的时间或区间长度的变化而变化，而且反映不出车辆长度与速度的关系，尤其当车辆混合行驶时，交通密度的高低，并不能明确地表示出交通流的状态，所以引用了车道占有率来表示交通密度，车道占有率包括空间占有率和时间占有率两种。

1）空间占有率

公路的单位面积中各车辆所占面积的综合即是空间占有率，能够反映出某路段上车队的长度。

2）时间占有率

在公路的任一短路段上，车辆通过时间的累计值与观测时间的比值，以百分数表示，即为时间占有率。

### 1.1.2 处理流程

#### 1.1.2.1 交通量计算

采集各个车道的交通量数据保存在数据库中，计算交通量各个指标数据时从数据库中取出数据进行计算，具体的处理流程如下：

![image-20210727145421328](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727145421328.png)

Ø 平均交通量

常用的平均交通量有：

u 年平均日交通量（AADT），即一年的总交通量除以该年的总日数。

u 月平均日交通量（MADT），即一月的总交通量除以该月的总日数。

u 周平均日交通量（WADT），即一周的总交通量除以该周的总日数。

u 平均日交通量（ADT），即某一段时间内的总交通量除以该段时间的总日数。

平均日交通量（ADT） =  ![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps55.jpg)

其中，![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps56.jpg)表示计算期内各单位时间的交通量，n表示计算期内的单位时间总数。如果计算年平均日交通量（AADT）时，n为365或者366，则

![image-20210727145441222](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727145441222.png)

![image-20210727145444936](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727145444936.png)

Ø 高峰小时交通量

一天内的交通高峰期间内连续1h的最大小时交通量。在一天的上、下午各有一个高峰值，交通量出现高峰值的那个小时，称为高峰小时。在高峰小时内的交通量称为高峰小时交通量，高峰小时交通量与日交通量之比为高峰小时流量比。

![image-20210727145453480](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727145453480.png)

Ø 交通量在一年中的逐月变化

交通量在一年中每个月交通量是不同的。后台会计算各个月的月平均日交通量与年平均日交通量之比，称为交通量月变系数M，即

M = ![img](C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml59492\wps57.jpg) = ![img](C:\Users\ADMINI~1\AppData\Local\Temp\ksohtml59492\wps58.jpg)

后台计算每个月交通量月变系数存入数据库。

Ø 交通量在一周内的逐日变化

在一周七天中，交通量也是逐日变化的。用交通量日变图显示这种变化，用各个周日的交通量日变系数D表示交通量的日变规律。

交通辆日变系数D是以年平均日交通量（AADT）除以某周日的平均日交通量（ADT），某周日的平均日交通量等于全年所有周日交通量的综合除以全年某周日的天数，即：

D = ![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps59.jpg)

其中 ADT = ![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps60.jpg)

Ø 交通量在一日中的小时变化

一天24h内交通量分布也不均匀，若绘成分布曲线，一般呈现出两个高峰值，一个出现在上午，一个出现在下午。

一个高峰小时内交通量不是均匀分布的，如将一个高峰小时划分成时间更短的几个高峰区间，通畅5min或15min作为时段，连续5min或15min内累计交通量最大的那个时段，就是高峰小时内的高峰时段，把高峰时段内的累计交通量扩大为一个小时的交通量，可称为扩大高峰小时交通量。高峰小时交通量与扩大高峰小时交通量之比称为高峰小时系数，计算如下：

高峰小时系数 = ![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps61.jpg)

#### 1.1.2.2 交通流速度计算

行车速度既是道路规划设计中的一项指控指标，又是车辆运营效率的一项评议指标。速度在某种程度上是效益的表征，对于运输安全、迅捷、经济和舒适具有重要意义。

设车辆在t时间内、在道路上行驶l距离，则车速可用![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps62.jpg)形式表示。按l和t的取值不同，可定义各种不同车速：

1、地点车速（又叫点车速或瞬时车速）

踏实车辆驶过道路上某一断面时的瞬时速度，观测距离很短，以行驶该距离的时间小于2s为限。汽车上车速里程表指示的车速、交通标志中限制的车速和雷达测速仪测得的车速均为地点车速，它是用作道路设计、交通管理和规划的依据。

2、行驶车速

它是指车辆在某一路段所行距离，用有效行驶时间（不包括停车时间）除之所求的车速。行驶车速用来分析道路区段行驶难易程度和设计道路通行能力以及车辆运行的成本效益分析。

3、行程车速

行程车速又称区间车速，是车辆行驶路程与通过该路程所需的总时间（包括停车时间）之比。行程车速是一项综合性指标，用以评价道路的通畅程度，估计行车延误情况。要提高运输效率归根结底是要提高车辆的行程车速。

4、设计车速

设计车速是指在道路交通与气候条件良好的情况下仅收到路条件限制所能保持的最大安全车速，用作道路线性几何设计的标准。

5、时间平均车速和区间平均车速

时间平均车速是车辆通过道路某断面时，某段时间内车速分布的平均值，简称平均车速。它的大小就是地点车速观测值的算术平均值。

区间平均车速（即路段平均车速），如果说时间平均车速表征的是该路段的“点”车速，那么区间平均车速则表征了某观测路段的“线”车速。它的定义为：某瞬间道路上某区间内全部车辆车速分布的调和平均值，或者定义为一批车辆通过某一路段时，其行驶距离与各辆车行程时间的平均值之比。

#### 1.1.2.3 交通流密度计算

是指在某一时刻，某单位长的路段上一条车道或几条车道内的车辆数。它是反映道路上车辆的密集程度、衡量道路上车流畅通情况的重要指标。在交通流密度中，能够使道路上的交通量达到最大值时的密度，称为最佳车流密度；而道路上的车流使车辆几乎无法进行，即发生交通阻塞时的交通流密度，称为阻塞密度。

 

#### 1.1.2.4 车道占有率计算

由于交通密度是瞬时值，随观测的时间或区间长度的变化而变化，而且反映不出车辆长度与速度的关系，尤其当车辆混合行驶时，交通密度的高低，并不能明确地表示出交通流的状态，所以引用了车道占有率来表示交通密度，车道占有率包括空间占有率和时间占有率两种。

Ø 空间占有率

公路的单位面积中各车辆所占面积的综合即是空间占有率，能够反映出某路段上车队的长度。

Ø 时间占有率

在公路的任一短路段上，车辆通过时间的累计值与观测时间的比值，以百分数表示，即为时间占有率。

## 1.2 交通运行指数计算

### 1.2.1 概述

道路交通运行指数（Traffic Congestion Index, TCI）是对道路整体运行水平这一抽象概念进行量化评估的综合性指标，具有直观、简单、敏感的特点，要求能够反映路网拥堵程度和变化，符合人对实际路况的主观感受。本项目将在交通大数据实时采集的基础上，实现道路交通运行指数的时空动态计算，为交通管理部门提供实时的决策参考，避免原有静态运行指数无法提供实时参考的问题。近年来，美国等西方国家，以及上海、北京等国内大城市先后提出了不同的交通指数定义和算法

Ø 基于道路交通密度的道路拥堵指数

道路拥堵指数（Roadway Congestion Index, RCI）是美国德克萨斯州交通研究院在较早版本《美国城市道路畅通性报告》中采用的主要指标，用车英里数与车道英里数的比值经加权后计算，衡量道路交通密度，描述拥堵强度和持续情况。指数大于等于1时表明路网拥堵不可接受。

Ø 基于综合评价方法的道路交通指数

《2002上海城市综合交通发展报告》中首次以道路交通指数（Road Traffic Index, RTI）来综合评价交通运行质量，取值范围为0~1000。以行驶速度及道路交通负荷度为基础构造评价因子，然后用层次分析法进行专家打分确定因子权重，建立交通指数模型，并通过实际调查数据进行检验。

Ø 基于拥堵里程比例的交通拥堵指数

交通拥堵指数（Traffic Congestion Index, TCI）是一定统计间隔内城市整体或区域道路网总体拥堵程度的相对数，取值区间为0~10，分为五级，数值越大表示拥堵越严重。计算流程为：计算各路段平均行程车速，判断所处运行等级；统计各等级道路中处于最拥堵水平的里程比例，并利用车公里数加权计算路网拥堵里程比例；基于线性转换关系得到拥堵指数。

Ø 基于出行时间比的交通运行指数

基于出行时间比的交通运行指数（Traffic Performance Index, TPI）,取值范围为0~5，分为畅通（0~1）、基本畅通（1~2）、缓行（2~3）、轻度拥堵（3~4）和拥堵（4~5）等5个等级，如表5.1。

![image-20210727150216048](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727150216048.png)

其中，出行时间比是路段或路网实际行程时间与期望行程时间的比值，表征当前路况下相比期望车速情形下多花费的时间，如比值为1.5，表明畅通情况下30min的车程现在需要45min，多花费15min。在此基础上通过专家打分，建立行程时间比与交通运行指数的换算关系。公式如下：

![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps63.jpg)（1）

式中，T为路段或路网的实际行程时间，![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps64.jpg)为期望车速下（如凌晨时段）行程时间，F（）为由专家打分确定的换算关系。利用实时获取的交通数据，可计算不同路段在不同时间下的RCI、RTI、TCI和TPI，达到实时动态计算道路交通运行指数的目的，为交通管理部门对交通实时状况进行快速响应提供数据支撑。

### 1.2.2 交通运行指数各项指标计算

#### 1.2.2.1 道路交通运行指数

##### 1. 概述

道路交通运行指数（Traffic Performance Index，即“TPI”）是综合反映道路网交通运行状况的指标。交通指数取值范围为0～10，分为五级。其中0～2、2～4、4～6、6～8、8～10分别对应“畅通”、“基本畅通”、“轻度拥堵”、“中度拥堵”、“严重拥堵”五个级别，数值越高表明交通拥堵状况越严重。具体数据规定如下：

| **交通指数** | **级别** | **对应路况**                           | **出行时间**                         |
| ------------ | -------- | -------------------------------------- | ------------------------------------ |
| 0~2          | 畅通     | 交通运行状况良好，基本没有道路拥堵     | 可以按道路限速标准行驶               |
| 2~4          | 基本畅通 | 有交通运行状况较好，少量道路拥堵       | 比畅通时多耗时0.2至0.5倍             |
| 4~6          | 轻度拥堵 | 交通运行状况较差，部分环路、主干路拥堵 | 比畅通时多耗时0.5至0.8倍             |
| 6~8          | 中度拥堵 | 交通运行状况差，大量环路、主干路拥堵   | 交通运行状况差，大量环路、主干路拥堵 |
| 8~10         | 严重拥堵 | 交通运行状况很差，全市大部分道路拥堵   | 比畅通时多耗时1.1倍以上              |

##### 2. 计算方法

道路交通运行指数的计算方法：

Ø 根据前端感知设备采集到的车速信息，计算每个路段的平均车速

Ø 分别统计快速路、主干路、次干路、和支路中处于严重拥堵运行等级的路段里程比例，其中路段交通运行等级的确定见下表;

Ø 对各等级道路拥堵里程比例以VKT（车公里数）比例作为权重进行加权，计算确定道路网拥堵里程比例；

Ø 按照道路网拥堵里程比例与道路交通运行指数的转换关系，计算道路交通运行指数，道路交通运行指数取值区间为[0，10]。

**表**6.71**路段交通运行等级划分**

**单位为公里/小时**

| **运行等级**                | **畅通** | **基本畅通** | **轻度拥堵** | **中度拥堵** | **严重拥堵** |
| --------------------------- | -------- | ------------ | ------------ | ------------ | ------------ |
| 快速路                      | V＞65    | 50＜V≤65     | 35＜V≤50     | 20＜V≤35     | V≤20         |
| 主干路                      | V＞40    | 30＜V≤40     | 20＜V≤30     | 15＜V≤20     | V≤15         |
| 次干路、支路                | V＞35    | 25＜V≤35     | 15＜V≤25     | 10＜V≤15     | V≤10         |
| 注：V表示路段平均行程速度。 |          |              |              |              |              |

**表**6.72**道路拥堵里程比例与TPI的推荐转换关系**

| **道路拥堵里程比例**      | [0,4%] | (5%,8%] | (8%,11%] | (11%,14%] | (14%,24%] | >=24% |
| ------------------------- | ------ | ------- | -------- | --------- | --------- | ----- |
| **道路交通运行指数(TPI)** | [0,2]  | (2,4]   | (4,6]    | (6,8]     | (8,10]    | 10    |

VKT比例计算方法：

以快速路为例，说明VKT计算方法。

Ø 按照如下公式计算统计时段内各路段的VKT值

![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps65.jpg) 

![image-20210727150405736](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727150405736.png)

##### 3. 处理流程

![image-20210727150422399](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727150422399.png)

Ø 确定计算的区域和计算的周期，区域可以是整个市区，也可以是中心城区或者各个行政区，计算周期一般是15min，这边以15min为例。

Ø 根据区域编号确定区域下各路段的编号。

Ø 计算每个路段15min周期内的平均速度，得到各路段的平均速度。

Ø 根据平均速度确定路段的拥堵级别，然后分别计算快速路、支干路，次干路的拥堵比例。

Ø 根据每个路段的交通量计算每个路段的VKT值，然后汇总计算得到快速路、支干路、次干路的VKT值以及计算各等级道理的VKT值占道路网总VKT值的比例

Ø 对各等级道路拥堵里程比例以VKT（车公里数）比例作为权重进行加权，计算确定道路网拥堵里程比例

Ø 根据道路网拥堵里程比例计算出该区域的道路通行指数，根据道路通行指数确定路网的运行水平，道路通行指数和路网运行水平对应关系如下表所示。

Ø 计算的结果保存在数据库中。

表6.73**道路交通运行水平划分**

| **道路交通运行****指数（TPI）** | 0≤TPI＜2 | 2≤TPI＜4 | 4≤TPI＜6 | 6≤TPI＜8 | 8≤TPI≤10 |
| ------------------------------- | -------- | -------- | -------- | -------- | -------- |
| **道路网运行水平**              | 畅通     | 基本畅通 | 轻度拥堵 | 中度拥堵 | 严重拥堵 |

#### 1.2.2.2 道路交通拥堵率

##### 1. 概述

特定时段内道路网处于中度拥堵和严重拥堵等级的道路交通运行指数之和，与该时段内所有道路交通运行指数之和的比值，综合反映特定时段内的交通拥堵程度，值越大拥堵越严重。

##### 2. 计算方法

道路交通拥堵率指标按照如下公式计算：

![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps72.jpg)

![image-20210727150512510](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727150512510.png)

##### 3. 常发拥堵路段数

道路网中以一定频率出现严重拥堵的路段的数量（条）。分为周常发拥堵路段、月常发拥堵路段和年常发拥堵路段。常发拥堵路段的空间与方向分布反映交通拥堵发生的聚集性、潮汐性。

a)日拥堵路段指当日1小时（含）以上处于严重拥堵的路段。

b)周常发拥堵路段指一周5个工作日内，大于或等于4天为日拥堵路段的路段。

c)月常发拥堵路段指一月4个周内，大于或等于3周为周常发拥堵路段的路段。

d)年常发拥堵路段指一年12个月内，大于或等于6个月为月常发拥堵路段的路段。

#### 1.2.2.3 程时间可靠性指数

95%概率条件下通过一个或多个路段比平均行程时间多花费的时间与畅通状态下行程时间的比值，值越大越不可靠。行程时间可靠性指数反映道路网交通运行的波动性。

行程时间可靠性指数计算方法：

Ø 按照如下公式计算统计间隔内道路网各路段的行程时间可靠性指数。

![image-20210727150638713](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727150638713.png)

## 1.3 信号优化

### 1.3.1 自适应信控配时计算

#### 1.3.1.1 概述

随着国民经济的增长，城镇化水平日益加快，近年来我国机动车保有量持续快速增长，交通压力越来越大，由此导致的交通拥堵、交通事故和环境污染等问题严重影响了人民的生活水平。以拥堵为代表的交通问题已经成了制约城市发展的主要障碍之一。传统的解决拥堵的方法是通过修建道路来提高路网的通行能力，然而事实说明，修建道路只能缓解一时的拥堵，往往路修道哪里拥堵就跟随到哪里。加之城市空间有限，依靠修建道路来解决拥堵已经不可行了。因此在现有条件下，合理利用交通设施，提高交通管理和控制水平，充分发挥交通系统的能力，提高运行效率，成为解决交通问题的一个有效途径。

众所周知，交叉口是道路网的节点，是行人、非机动车和机动车等各种方式交通流在路网中通行的咽喉。世界经济合作与发展组织（OECD）的统计数据显示，2011 年发生在交叉口及其周边的交通事故占整个道路交通事故的30%左右，改善城市道路交叉口的交通安全是提高整个道路交通安全服务水平的关键；其次，交叉口是城市道路交通拥堵的常发地点，国内外研究表明城市道路总行程延误的约60.80% 发生在交叉口，因此，交叉口的运行效率很大程度上决定了城市道路交通系统的整体运行效率；再则，车辆在交叉口经常需要经历减速和加速过程，而加减速过程是车辆能源消耗和尾气排放的主要根源，据统计车辆在交叉口的停车、怠速和启动过程，造成了机动车能耗和污染的30.35% 左右，因此，交叉口控制和管理的效率直接影响城市交通环境质量以及机动车能源消耗；最后，交叉口的建设需要占用大量的城市用地，并且需要高昂的包括交通机电设备的建设投资和运行维护费用,而其运行是否顺畅，又反过来影响了整个城市的运行效率，构成了社会成本。

道路交通信号控制技术的发展可以追溯到19 世纪中叶，从最原始的两色（红和绿）煤气照明灯到现代高科技的三色LED 信号灯，从最简单的单点定时控制到目前复杂的区域协调自适应控制，道路交通信号控制技术的发展已经历了140多年的历史。世界交通信号控制技术的发展经历了从早期的偏向硬件系统（信号灯、信号机等）开发到后期注重软件系统（控制算法和系统集成）研发的过程。二十世纪70 年代，伴随TRANSYT、SCOOT 和SCATS 的相继问世，传统的基于参数化模型的控制系统已趋于成熟。之后，随着现代科技的进步，人工智能技术、现代控制理论、计算机及其网络技术等广泛应用于城市交通控制系统的设计与开发，出现了一批基于非参数化模型的城市交通控制系统，例如，美国的RHODES 和OPAC、法国的PRODYN、意大利的SPOT／UTOPIA 等。

虽然目前自适应控制的算法和模型都较为复杂，但仍然没有能充分发挥信号控制的潜能，采集数据的方法依然主要依靠单一的线圈检测，算法效果严重依赖检测精度。近年来，随着智能交通（ITS）的发展，检测手段日趋多样化。在以车联网、车路协同等为代表的新一代智能交通系统迅速发展的背景下，新型的交通检测技术手段，例如基于专用短程通讯、高清视频和车路协同技术的车辆实时检测等，使得交叉口全息（包括车辆速度、位置、车型、密度、交叉口排队长度、饱和度和延误等）检测成为可能。然而，传统的自适应信号控制方法主要依赖于定点检测器的数据，对车辆和交叉口状态信息的利用不足，同时由于检测器的位置固定，限制了临界排队长度和等待时间等关键控制参数的准确取值。

通过近年来国内外在新型检测手段方面的研究，可以将全息检测进行如下描述。全息检测是指交叉口一定范围内单个车辆的运行状态和总体交通状态均可以被实时检测到。全息检测包含两个层面的信息，车辆层面和交叉口层面。车辆层面信息包括车型、速度、位置和延误等信息，交叉口层面信息包括排队长度、密度、流量和达到率等信息。与传统的线圈检测相比，全息检测信息更为丰富，两种检测方式的检测信息对比如下表所示。

**表**6.74**检测方式信息对比**

| **线圈检测**                   | **全息检测**                                                 |
| ------------------------------ | ------------------------------------------------------------ |
| 车头时距定点车速流量、占有率„„ | 车型、速度、车辆长度、停车次数、排队长度、饱和流率、流量、达到率、延误、密度、等待时间„„ |

交叉口的全息检测，一方面为评价交叉口的运行状况及交通管理提供了依据，同时还为交叉口信号控制策略的制定提供了数据支持。利用这些信息，可以更精细化的求解最优控制策略，得出更符合实际交通状况的控制方案，充分发挥信号控制在交叉口运行中的作用。这也是交通信息化环境下的下一代信号控制系统的研究重点，是信号控制未来的发展方向之一。

本系统中使用的自适应算法是基于交叉口全息检测的单点自适应控制策略。

#### 1.3.1.2 实现算法

##### 1. 基于传统线圈检测的感应控制算法

感应控制的原理是根据检测器采集到的车辆信息，对绿灯时长做出调整。常见的调整方法有3 种：（1）基于车头时距检测的绿灯时长调整，（2）基于占有率检测的绿灯时长调整，（3）基于拥挤检测的绿灯时长调整。其中基于车头时距的感应控制原理如下图所示。设置单位绿灯延长时间（车头间隙），在绿灯时间达到最小绿灯时间之后，开始检测车头时距是否大于设定间隙，如果是，则结束绿灯，否则继续绿灯，直到达到最大绿灯时间。

![image-20210727151225758](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151225758.png)

下面在美国标准NEMA 相位结构的基础上，介绍两种感应控制，分别称之为基本感应控制（Basic NEMA）和改进的感应控制（Extend NEMA）。

Ø 基本感应控制策略

基本感应控制策略主要根据车头时距来判断是否进行相位切换。在停车线上游布设一排检测器用于检测车头时距，检测器的位置布设根据交叉口的限速和设定的车头时距ZL 来确定，检测器布设距离如表所示。

**表**6.75**检测器布设距离**

![image-20210727151333098](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151333098.png)

基本感应控制只布设一排检测器用于检测车头时距，因而不具有相位选择功能，只能按照设定好的相位结构进行控制，相位顺序如图所示。

![image-20210727151351458](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151351458.png)

Ø 改进的感应控制策略

Extend NEMA 算法是在Basic NEMA 结构的基础上，增加了一组排队检测器，用以检测排队长度，排队检测器的位置根据交叉口流量水平确定。在最小绿灯时间结束以后，如果某一红灯相位出现排队超过排队检测器的位置，则结束绿灯切换至该相位，否则继续执行基本感应控制的逻辑，控制逻辑图如图所示。Extend NEMA 算法中，相位顺序可以根据排队情况进行变换，但是必须要满足双环结构的约束，不允许主路和支路之间的跳相。

![image-20210727151358648](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151358648.png)

##### 2. 基于新型检测技术的自适应控制算法

随着智能交通（ITS）的发展，检测手段日趋多样化，通过先进的交通检测技术和手段，获取交叉口的实时交通状态和信息，以此为基础做信号控制可以使信号控制方案更加适应交叉口实时交通状况。近年来，国内外学者根据不同检测手段获得的数据，研究出多种信号控制方案。

Ø Henry X. Liu

2001 年，Henry X. Liu 等人用车辆再识别技术提出一种基于延误最小的在线闭环优化算法。该研究中将检测器分别布设在交叉口的进口道上游325 ~ 375 ft处和出口道处，并且利用先进的ILD 卡(Inductive Loop Detector cards)获得车辆通过检测器时形成的电波图像，通过匹配上下游检测器的电波图像来完成车辆再识别，根据车辆经过上下游检测的时间差来计算实时延误。控制策略的结构框架如图所示。

![image-20210727151642926](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151642926.png)

该算法的优化目标是使总车辆延误和各流向的平均延误达到最小，为此设计了一种兼顾用户平衡（user.equilibrium）和系统平衡（system equilibrium）的多目标优化优化算法。具体目标为系统效率（system efficiency）和系统公平（system fairness）。

![image-20210727151654174](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151654174.png)

Ø CARREN

2006 年，Miho Asano人利用ITS 技术来实时获得交叉口延误信息，研究出一种能自动生成信号参数的信号控制系统，CARREN（Control Algorithm Retuning paRameters with self performance EvaluatioN）。该方法利用上游交叉口出口道AVI 传感器计算车辆的累积达到曲线，利用本交叉口出口道超声波检测器计算车辆的离开曲线，通过达到.离开累积曲线图估算交叉口的实时延误，如图所示。

![image-20210727151712927](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151712927.png)

CARREN 通过对信号控制参数进行小步距试探调整来寻找使得总体延误最小的配时方案。将每个参数分别调整（.△T，0，+△T）后，重新画出到达离开累积曲线图估算延误，选取延误最小的调整方案。CARREN 调整的参数主要有3个：周期，绿灯时长和相位差。总体控制结构图如图所示。在2010 年，Hisatomo等人在此基础上加入浮动车数据进行延误的实时估计。

![image-20210727151721463](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151721463.png)

Ø ADS

2005 年，Yosuke Imai 等人[47] 通过车路通信技术获取车辆位置信息，提出了ADS（Advanced Demand Signals）控制方案。该算法中，通过车辆的位置信息，计算各流向车辆对于绿灯的请求程度，来决定是否进行相位切换。假设![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps75.jpg)为主路方向的请求程度，![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps75.jpg)为次路方向的请求程度，计算方式如下：

![image-20210727151802063](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151802063.png)

##### 3 基于规则的自适应控制算法

本系统开发了一种基于实时车辆行驶轨迹的单点自适应信号控制策略。为了充分利用车辆轨迹数据，将一个绿灯相位分成3个阶段：绿灯保持阶段、相位切换判断阶段、下一相位选择阶段。3个阶段所处的位置不同，所要解决的问题也不同，如图所示。

![image-20210727151820982](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151820982.png)

为了便于描述，按照主路和次路（相交道路）将相位分为主路相位和次路相位，主路相位组成的环称为环1，次路相位组成的环称为环2，如图所示。图中东西向为主路，南北向为次路。在相位切换中，如果切换相位和被切换相位属于同一个环，则称之为环内切换；如果切换相位和被切换相位分别位于两个不同的环中，则称为环间切换。将一个环中最开始运行的两个相位称之为起始相位，如P1 和P5；将剩余两个相位称之为结束相位，如P2 和P6。

![image-20210727151828423](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151828423.png)

由于全息检测的范围是停止线上游150m，检测范围内的车辆数能够一定程度上代表交通需求，因此将各流向150m 检测范围内检测到的车辆数称之为150m需求。根据阶段的划分，控制策略主要包含3 大模块，每个模块由一个或几个逻辑规则组成，结构框架如图所示，具体如下：

（1）绿灯保持模块：处于绿灯的开始阶段，这一阶段不考虑是否进行相位切换，只判断是否进入下一阶段。主要逻辑规则为150m 需求规则。

（2）相位切换判断模块：处于绿灯的末尾阶段，主要解决绿灯何时切换的问题。包含排队规则和车头时距规则。

（3）下一相位选择模块：处于绿灯结束时刻，主要解决下一相位的选择问题。包含环内相位切换规则和环间相位切换规则。

![image-20210727151835991](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151835991.png)

在控制策略中，不仅将检测信息直接应用到控制中去，同时对检测信息进行统计。车辆进入检测区域以后，分流向对车辆进行计数，每10 分钟统计一次流量数据。根据最新10 分钟的流量数据计算交叉口的实时饱和度以及转向比例等信息，同时更新与饱和度相关的150m 需求临界值和排队临界值。

###### ① 控制逻辑

本算法的控制逻辑如图所示。主要有以下几个步骤：

第一步：判断是否到达10 分钟间隔，如果是，转到第二步，否则转到第四步。

第二步：根据最近10 分钟的流量数据计算饱和度。

第三步：更新150m 需求临界值和排队临界值。

第四步：检测当前绿灯时间是否大于最小绿灯时间，如果是，转到第五步，

否则继续绿灯。

第五步：检测当前绿灯时间是否达到最大绿灯时间，如果是，结束绿灯相位

转到第十二步，否则转到第六步。

第六步：计算150m 需求。

第七步：判断150m 需求是否大于临界值，如果是转到第八步，否则继续绿

灯。

第八步：选择排队相位，检测排队长度。

第九步：判断排队长度是否大于临界值，如果是转到第十二步，否则转到第

十步。

第十步：预测停车线处车头时距。

第十一步：判断车头时距是否小于临界值，如果是继续绿灯，否则转到第十

二步。

第十二步：判断当前相位是否为起始相位，如果是转到第十三步，否则转到

第十四步。

第十三步：根据环内相位切换规则，选择并切换到下一相位。

第十四步：根据环间相位切换规则，选择并切换到下一相位。

![image-20210727151858592](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151858592.png)

###### ② 主要控制模块

Ø 绿灯保持模块

在绿灯开始的一段时间内，是不需要进行切换判断的。一方面是因为要保证最小绿灯时间，确保行人和机动车的安全；另一方面是因为红灯刚结束，积累的车辆数较多，交通需求较大，需要一定的绿灯时长。因此可以将绿灯保持阶段分为两个部分，第一部分为最小绿灯部分。由于全息检测范围是停车线上游150m，故将第二部分称为150m 需求部分，对应的规则称之为150m 需求规则。

绿灯相位在到达最小绿灯时间之后，进入150m 需求的计算，计算的主要依据是全息检测范围内的车辆数和对应的车道数，即平均每条车道上的车辆数。本方法认为，如果检测范围内车辆数达到一定的数量，说明需要保持绿灯。根据车辆的位置不同，将车辆区分为展宽段车辆和路段车辆，如图所示。位于展宽段的车辆，由于展宽段的车道功能已经确定，车辆的流向及所属的灯组也随之确定；而位于路段上的车辆，由于无法确定其准确流向，故需要乘以对应的转向比例。因此，绿灯150m 需求的计算的公式为：

![image-20210727151923191](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151923191.png)

![](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151923191.png)

![image-20210727151949225](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151949225.png)

![image-20210727151959792](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151959792.png)

![](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727151959792.png)

![image-20210727152022192](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152022192.png)

在全息检测中，可以实时统计到达的车辆数，利用最近一段时间的到达情况，计算当前的到达率。文中用最新10 分钟流量数据计算到达率，并以此作为计算当前排队临界值的到达率。最大可忍受红灯时间的大小国内外学者做过大量的研究，主要与行人的过街迫切程度，交叉口的大小及流量水平有关。一般情况下，上班人员较购物游玩人员的忍耐时间短，交叉口较大时行人的忍耐时间较长，交通流量水平较大时行人的忍耐时间较长。在德国规范中，最大红灯时间一般不超多60s，国内学者研究表明，在中国最大红灯时间不应超过90s，一旦超过行人的闯红灯概率将大大增加[40]。考虑到流量水平的影响，根据饱和度的高低将最大可忍受红灯时间分为以下两个档次

![image-20210727152041686](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152041686.png)

2)车头时距规则

在绿灯末尾阶段，如果车辆已经接近停车线，则应该尽可能使该车在当前绿灯相位驶出停车线，而对于车辆离停车线较远的情况，则应结束绿灯。这样做一方面保证绿灯的利用效率，另一方面防止速度大的车辆紧急刹车带来危险。因此决定绿灯是否进行延长要从车辆速度和到停车线距离两方面考虑。

在感应控制中，常采用3s 的车头时距作为判断绿灯延长的依据，根据交叉口限速将检测器布设在停止线上游。但是这种策略是在假定车辆均按照限速行驶的条件下执行的，对于速度的离散分布并未考虑。对于速度较低的车辆，绿灯延长3s 后依然没能驶出交叉口，造成绿灯延长时间的浪费；而对于速度较高的车辆，较少的时间即可通过停止线，延长3s 依然会造成一部分绿灯时间的浪费，另外对没有检测到的高速车辆，有可能使其陷入进退两难的境地。

针对以上问题，设置停车线车头时距规则。所谓停车线车头时距就是根据当前车辆的速度和位置，预测车辆行驶至停车线所需时间。如果车辆行驶至停车线的时间小于一定的值，则继续保持绿灯，否则结束绿灯。为尽量避免车辆陷入进退两难区，根据车辆速度，将停车线车头时距设置不同的临界值，如下所示：

![image-20210727152059174](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152059174.png)

![image-20210727152114926](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152114926.png)

下一相位选择模块

1）相位顺序

相位切换方式与相位顺序密切相关，相位切换模块实质上就是对相位顺序的优化。相位顺序的设置和优化需要满足3个原则：（1）安全性，（2）效率性，（3）相对稳定性。

安全性

安全性是相位相序设计追求的第一目标，相位相序设置的初衷就是为了避免车流之间的相互交织与冲突，以减少由此而导致的交通事故：因此相位相序的设置不应使同时获得通行权的车流之间存在交织或冲突，同时要保证相位内所有交通实体的通行权。

交叉口任意两股交通流的运行轨迹间存在交点（除分流情况外）时，认为这两股交通流之间存在交通冲突，交点称为冲突点。对某一股交通流而言，与其产生冲突的交通流通常有若干股，因此形成一对多的冲突点组，典型交叉口冲突点如图所示。

![image-20210727152150681](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152150681.png)

一个冲突点组中，对于可以通过让行规则消除的冲突，可不考虑其绿灯间隔时间；必须通过信号控制分离的冲突，则须考虑通行权切换必需的绿灯间隔时间。绿灯间隔时间的计算主要依据停车线距冲突点的距离，保证前一相位的车辆离开冲突点下一相位车辆才可以进入交叉口。任何相交交通流之间都存在一个冲突点，都有一个可能的绿灯间隔时间，所有车流冲突对应的绿灯间隔时间组成的一个二维矩阵表，称之为绿间隔矩阵表。以一个小型交叉口为例，绿间隔矩阵如图所示。

![image-20210727152210791](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152210791.png)

**图**6.61**绿灯间隔时间矩阵**

图中：k1..K6 表示机动车车流；F1..F4 表示非机动车车流.

![image-20210727152221231](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152221231.png)

**图**6.62**交叉口相位顺序****图**

​	相位顺序的设置必须要满足绿灯间隔时间矩阵的约束，保证冲突相位间至少满足表中的绿灯间隔时间。

效率性

相位相序设置应该尽量支持车流放行次序的灵活变换，以求尽量减少损失时间并充分利用交叉口的时间资源。在其他条件保持不变的情况下，通过相位顺序提高效率的方法主要有两种：跳相和搭接。跳相可以使通行权优先给有需求的相位，减少因车辆到达分布不均造成的绿灯时间的浪费；搭接可以将通行权尽可能多的给交通量较大的车流，减少因流量不均衡造成绿灯时间的浪费。假设一个四相位交叉口的相位顺序是主路直行.主路左转.次路直行.次路左转，进行搭接和跳相之后的相位顺序分别如图所示。

![image-20210727152234127](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152234127.png)

![image-20210727152242368](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152242368.png)

**图**6.64**跳相示意****图**

主路和次路之间的任意两个车流间都是存在冲突的（交叉冲突或者合流冲突），因此，常规交叉口中主路和次路之间是不存在相位搭接的，搭接只存在与主路直行和主路左转之间或者次路直行和次路左转之间。从以上两图也同样可以看出，有主次之间的跳相就没有搭接，有搭接就不能进行主次之间跳相。在考虑效率时要充分考虑跳相与搭接之间的矛盾。跳相和搭接都能够提高相位相序的灵活性，提高交叉口效率。但是，从通行能力上来讲，跳相不能够增加通行能力。对于流量分布不均匀的交叉口，搭接可以一定程度上提高通行能力。

相对稳定性

相位相序的设置在一段时间间隔内应该具有相对的稳定性，其稳定是相对于效率性而言的，即相位相序设置在兼顾效率的同时不应该导致驾驶员的困惑，在单点实时自适应控制中，相位相序的相对稳定性是非常重要的，如果相位相序经常发生跳变则会给驾驶员提供错误信息从而导致交通事故，降低安全性。

2）相位结构

综合考虑相位顺序的安全性、效率性和稳定性，本系统采用美国NEMA（National Electronic Manufacturers Association）双环相位结构，如图所示。在相位顺序上，不允许主路和次路之间进行跳相，但是可以允许主路直行和左转之间的顺序灵活调换。在NEMA 相位结构中，barrier 即对应下图中的环1 和环2 的分界线，barrier 左侧的相位为环1，右侧为环2.

![image-20210727152300750](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152300750.png)

**图**6.65**相位结构****图**

 

3）环内相位切换规则

如果当前相位是起始相位，则进行的切换为环内切换。以图5中相位P1和相位P2 之间的切换为例来进行说明。环内切换时只需考虑切换相位和被切换相位之间的关系，而不需要考虑同时运行的其他相位是否同时切换。这就出现了起始相位P1 和相位P5 可能不同时切换的情况，相位P1 的切换时刻有可能早于相位P5，也有可能晚于P5 的切换时刻。反应在相位阶段上就是如下图所示的过渡过程，直行和左转之间存在搭接情况。

![image-20210727152318838](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152318838.png)

**图**6.66**环内相位切换****图**

4）环间相位切换规则

如果当前相位是末尾相位，则进行的是环间相位切换。环间相位切换时，在考虑一个相位是否进行切换时需要兼顾同时运行的另一绿灯相位是否允许切换，如果允许，则同时切换至另一个环中的起始相位，如果不允许，则两个相位均继续绿灯。在环间切换时，由于环1 中的相位和环2 中的相位均存在冲突，因此，切换时另外一个环中的任何一个相位均有可能作为起始相位，那么便存在4 种可能的相位组合，如下图所示。在进行选择起始相位组合时，这里以排队长度作为选择依据。首先选择一个排队最长的相位作为其中的一个起始相位，然后从另外两个与之不冲突的相位中选择一个排队较大的作为另一个起始相位，将这两个相位作为起始相位组合。

![image-20210727152341047](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152341047.png)

**图**6.67**环间相位切换****图**

Ø 控制参数

1）最小绿灯时间

最小绿灯时间是预先为一个相位设置的一段绿灯时间。在这段时间内，不管是否有车辆到达，都必须保证放完这段绿灯时间，最小绿灯时间还要保证行人和非机动车能够安全过街。最小绿灯时间采用行人过街的最小绿灯时间。计算公式为

![image-20210727152356415](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152356415.png)

2）最大绿灯时间

为某一相位设置最大绿灯时间是为了保持最佳绿信比，保证其它相位不会因为当前绿灯相位时间过长而导致排队长度过长甚至造成拥堵。当前相位绿灯时长达到最大绿灯时间时，就强制结束当前绿灯相位。目前，还没有比较公认的最大绿灯时间的优化算法，有一种算法是，将最大周期时间按照绿信比分配到各个相位得到的绿灯时间即时最大绿灯时间。计算公式为：

![image-20210727152410215](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152410215.png)

3）单位绿灯延长时间

单位绿灯延长时间是机动车相位最小绿灯时间结束后，绿灯显示时间的调整步距。取值越小，实时采集、处理和存储的交通流到达信息量越大，相位切换决策分析次数越多，但是，对信号机的数据处理能力和数据存储容量的要求越高。在感应控制中，单位绿灯延长时间与检测器的位置有关，要保证检测到的车辆能在单位延长时间内通过停止线，通常情况下为3s。在典型的单点自适应控制策略中，Miller‘s Algorithm、TOL 和MOVA 的单位绿灯延长时间一般取2s，OPAC取5s。本算法是在全息检测的环境下进行的，全息检测可以实现对车辆速度、位置、车型等信息的实时检测，并每秒更新检测信息。因此本算法的单位绿灯延长时间为1s，即每秒钟都在利用最新的检测数据进行决策，判断是继续绿灯还是结束绿灯。

4）黄灯时间

黄灯时间是机动车相位由绿灯切换至红灯的过渡时间。设置黄灯时间的目的是为了降低驾驶员陷入“进退两难区”的可能性。黄灯时间的取值主要与交叉口的限速有关，《交通信号控制指南——德国现行规范》[40]中规定，交叉口限速50km/h 时，黄灯时长应设为3~4s，限速为60km/h 时，黄灯时长应设为4s，限速为70km/h 时，应设为5s。

5）全红时间

全红时间指本相位黄灯末至下一相位绿灯初的时间间隔。全红时间的设定是为了保证驶出停车线的车辆能在下一相位绿灯开始之前驶出冲突点，以免与下一相位的车辆产生碰撞。依据停车线至冲突点距离，即清空距离和车辆速度而确定。清空距离和冲突点示意图如图所示。全红时间计算公式为：

![image-20210727152424607](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152424607.png)

![image-20210727152429838](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152429838.png)

**图**6.68**冲突点示意****图**

6）饱和度

交叉口饱和度是指交叉口的实际交通流量与饱和通行能力的比值，是反应交叉口服务水平和制定配时方案的重要指标。在双环相位结构下，交叉口的饱和度根据关键冲突车流计算。计算公式如下：

![image-20210727152442928](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152442928.png)

饱和车头时距取2s，绿间隔折减系数取0.85，其他干扰因素折减系数取0.9，冲突点的实际通行能力约为1350pcu/h。冲突车流的车道流量根据最近10 分钟的流量换算成小时流量得出。

###### ③ 特点

与传统基于检测器的自适应控制相比，全息检测主要有以下3个方面的不同：

Ø 信息的实时获取

传统检测器只能获取定点的车辆信息，首先是数据不够全面，其次是通过定点车辆信息预测车辆后期的行为误差较大。全息检测可以实时检测车辆的位置、速度、排队长度等信息。

Ø 决策的实时判断

感应控制的单位延长时间依赖于检测器的位置，一般为3s，时间粒度比较大，反应比较滞后。全息检测下的自适应控制可以每秒都在重新检测并进行新的逻辑判断。

Ø 参数的动态调整

本章控制策略中涉及到的几个关键临界值，150m 需求临界值和排队临界值，都是可以随着流量信息变化的。在车头时距规则中，考虑了速度因素，尽可能减少低流量情况下，速度高的车辆陷入进退两难区的情况。使得控制策略可以适用于各种流量水平下的控制，一方面提高了低流量情况下的安全性，另一方面避免了感应控制在高流量情况下失效的尴尬境况。

## 1.4 基于大数据的OD分析

### 1.4.1 概述

OD调查即起起讫点调查，是对某一调查区域内出行个体的出行起点和终点的调查，属于交通调查的一种专项调查。进行OD调查，其目的就是弄清楚交通流和交通流之间的关系，获取道路网上交通流的构成、流量、流向、车辆的起讫点，大量的OD调查数据，为未来道路交通量的预测、道路的规划、交通服务设施的配置、交通管理和控制、规划方案和建设项目的国民经济评价及财务分析等提供定量依据，进而为交通规划的完善、建设项目可行性研究和决策奠定基础。

OD调查的方法多种多样，总体来说可以分为基于大规模人工抽样调查的传统的OD 调查方法和基于现代先进技术手段的现代OD调查方法。常用的OD调查方法如下：

1、家访调查

家访调查主要是随机从居住在研究区域内的居民中抽取调查对象，再由调查人员去当面询问调查对象家中全体家庭成员的详细交通出行信息，如出发地、出发时间、目的地、到达时间、出行方式、换乘情况、出行目的等出行情况。家访调查方法由于调查员是直接和居民面对面调查，其获取的出行数据较为可靠，而且可以了解居民的个人属性和社会经济特征等相关个人资料。

2、货流调查

货流调查主要是通过发、收调查表的形式获取与物流相关的交通信息，由调查人员制定货流调查表格，去物流相关企业、单位把调查表格分发给货运员，在货运员逐项填写完毕后再由调查员进行回收。该方法的效果会受调查表格的回收率的影响。

3、路边询问法

路边询问法是现今我国公路线网规划和城市交通规划领域中最普遍的一种OD调查方法，主要是由调查人员在调查区域内的主要道路或者城市的出入口上设置出行调查点，让经过的机动车辆停车，调查员询问了解该车的出发地点、终点及其他相关的出行情况。该调查方法由于需要让车辆停下并接受询问，这可能造成车辆的延误甚至道路的阻塞，因此需要在交警的协调下完成调查。

4、明信片调查法

明信片调查是由调查员在调查区域内的收费站、加油站等地点设置明信片发放点，向过往的车辆驾驶员发放出行调查明信片，让对方填写完毕后寄回给调查人员。该方法适用于路边询问法中无法让车停下接受调查的交通繁忙地区，与路边询问法相比，其对交通的影响较小，但是该方法存在一个主要缺点，即明信片的回收率较低。

5、工作出行调查

工作出行OD调查是由调查人员抽样选取调查区域内的工作单位，与单位负责人协调以从相应工作单位的员工的个人档案中获取员工的居住地和工作地信息，实现对调查区域内的职工的居住地(O点)和工作地(D点)的调查。该方法适用于公共交通规划、自行车调查。

6、车辆牌照调查

车辆牌照调查主要是由调查人员在调查区域内主道路和路口设置多个调查点，将所调查时间段划分为小的时段，记录各个时段每个调查点所经过的车辆的牌照数据，然后对所有数据进行整合，将调查时段内第一次记录某个车牌的调查点所在地作为该车的出行起点，最后一次记录该车牌照的调查点所在地作为该车的出行终点。该调查方法需要耗费大量的人力进行数据的记录和校对。

7、月票调查法

月票调查法由调查人员制定调查表，在居民购买或者换月票卡时，将调查表发给居民，并要求对方在表格上重要项目填写完毕后交回。该调查方法成本较低，但是由于调查对象局限于使用月票的居民，所以调查结果只能反映特定人群的出行特征。

8、公交线路乘客调查

公交线路乘客调查是由调查人员去公交车上或者公交车站当面对乘客进行调查，询问乘客的出行起点、终点及换乘等相关信息。

9、电话询问调查

电话询问调查是由调查人员从电话本中随机选择调查对象，先向调查对象询问征求其接受交通出行调查的意向，若调查对象愿意接受调查则调查员向其打电话询问其一定时间内交通出行的相关信息。

传统的OD调查方法主要缺点有：

Ø 基于大规模人工抽样调查，主要采用调查员直接询问或发收调查表的方式来获取居民出行情况，再经过整合后得到OD矩阵，其所需的成本较高。

Ø 抽样率较低，一般约为1.5％-5％。

Ø 调查获取的数据精度不足，难以分析单个个体或特殊群体的出行情况。

Ø 调查数据的实时性差，一般每5年实施一次调查，并且获取的OD矩阵是静态OD矩阵。

传统的OD调查不适用于所有的交通方式，而且这种调查方式已经越来越不能适应现在的发展形势，这就需要不断完善现有调查的基础上，同时探索和寻求心的调查方法，而交通大数据挖掘与应用也许是未来OD调查的一个方向。

本方案中的基于车辆识别的大数据OD调查是基于出行车辆的出行轨迹进行大数据分析后得到的OD结果，采用了Hadoop分布式计算框架，输出的结果作为传统OD调查的补充以及验证。

基于移动通信网络数据的OD分析作为一种新的OD调查方式，具有很多的特点和优势：拥有极大的样本量，并且覆盖范围广，采集数据实时性强，对基础设施要求低，定位精度满足交通分析的需求，很适用于对通勤交通的分析。同时基于手机数据可以分析预测居民出行状态、出行韵律，为分析城市交通出行状态，居民出行行为，理解城市交通发生机理，分析城市交通拥堵和城市交通管理与规划提供参考依据。

本方案中的两种OD分析方法都是对传统OD调查的补充和验证，对传统OD调查的结果具有指导意义。

### 1.4.2 基于Hadoop大数据OD分析

#### 1.4.2.1 Hadoop大数据简介

Hadoop是一个由Apache软件基金会所开发的分布式系统基础框架，它实现了一个分布式文件系统（Hadoop Distributed File System），简称HDFS。HDFS具有高容错性的特点，并且设计用来部署在低廉的硬件上，而且它提供高吞吐量来访问应用程序的书，适合那些有着超大数据集的应用程序。

下图是Hadoop的生态系统，最下面一层是作为数据存储的HDFS，其他组件都是在HDFS的基础上组合或者使用的。HDFS具有高容错性、适合批处理、适合大数据处理、可构建在廉价机器上等优点，缺点是低延迟数据访问、小文件存取、并发写入、文件随机修改。

 Hadoop MapReduce是一个软件框架，基于该框架能够容易地编写应用程序，这些应用程序能够运行在由上千个商用机器组成的大集群上，并以一种可靠的，具有容错能力的方式并行地处理上TB级别的海量数据集。这个定义里面有几个关键词：软件框架、并行处理、可靠且容错、大规模集群、海量数据集就是MapReduce的特色。

HBase是一个高可靠、高性能、面向列、可伸缩的分布式存储系统，利用Hbase技术可在廉价PC Server上搭建大规模结构化存储集群。HBase 是Google Bigtable 的开源实现，与Google Bigtable 利用GFS作为其文件存储系统类似，HBase 利用Hadoop HDFS 作为其文件存储系统；Google 运行MapReduce 来处理Bigtable中的海量数据， HBase 同样利用Hadoop MapReduce来处理HBase中的海量数据；Google Bigtable 利用Chubby作为协同服务， HBase 利用Zookeeper作为对应。

 Hive是由Facebook 开源，最初用于解决海量结构化的日志数据统计问题的ETL(Extraction.Transformation.Loading) 工具，Hive是构建在Hadoop上的数据仓库平台，设计目标是可以用传统SQL操作Hadoop上的数据

Flume是Cloudera提供的一个高可用的，高可靠的，分布式的海量日志采集、聚合和传输的系统，Flume支持在日志系统中定制各类数据发送方，用于收集数据；同时，Flume提供对数据进行简单处理，并写到各种数据接受方(可定制)的能力。

ZooKeeper 顾名思义就是动物园管理员，它是用来管大象(Hadoop) 、蜜蜂(Hive) 和小猪(Pig) 的管理员， Apache Hbase和 Apache Solr 以及LinkedIn sensei等项目中都采用到了 Zookeeper。ZooKeeper是一个分布式的，开放源码的分布式应用程序协调服务，以Fast Paxos算法为基础实现同步服务，配置维护和命名服务等分布式应用。

![image-20210727152605432](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152605432.png)

**图**6.69 **hadoop生态****示意图**

#### 1.4.2.2 框架

![image-20210727152623575](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152623575.png)

**图**6.70**系统框架****示意图**

本系统是基于Hadoop分布式计算框架开发的，通过前端采集设备采集的车辆信息通过基础网络服务平台采集到主机，进行数据规整后形成实时车辆信息文件发送到Hadoop集群中，Hadoop将文件保存在HDFS分布式文件系统中，MapReduce分布式计算框架计算每个交通小区的进出车辆数，生成的结果保存到数据库中。

#### 1.4.2.3 技术实现

##### 1.4.2.3.1 数据接口定义

###### ① 车辆实时位置文件

前端感知设备.基于车辆识别的视频设备采集车辆信息发送数据给基础网络服务平台采集服务，采集服务采集数据后通过数据规整生成车辆实时位置文件，文件中记录车辆的基本信息，比如车牌号，车辆类型等，具体的格式如下表：

**表**6.76**车辆基本信息格式**

| **字段名**  | **字段类型** | **字段说明**           |
| ----------- | ------------ | ---------------------- |
| DevicedId   | String       | 监控点设备Id           |
| PlateNumber | String       | 车牌号                 |
| VehicleType | Int          | 车辆类型，小型车、货车 |
| Time        | String       | 采集时间               |

###### ② 交通小区划分表

交通小区是具有一定交通关联度和交通相似度的节点或者连接线的集合，随时间、关联度和相似度的变化而变化反映了城市道路路网的时空变化特性。交通小区主要以道路或者住宅群分界，是进行出行调查，搜集交通数据的基本单元。

交通小区的划分是交通调查和规划的基本工作，交通小区的划分和规模都将直接影响到交通调查、分析、预测的工作量及精度，从而影响整个城市的交通规划和布局。

交通小区的划分原则普遍遵循以下原则：

Ø 保证交通小区内土地利用、经济、社会等特性尽量一致，划分范围内的土地利用特征尽可能简单，尽量不打破城市行政区的划分；

Ø 尽量以铁路、河川等天然屏障作为分区界限，尽可能避免小区内存在自然或者人为障碍线；

Ø 小区应尽可能规则，避免狭长形状；

Ø 充分考虑城市道路网的构成，尽可能使小区划分与道路网协调一致，尽可能使交通小区出行形心位于路网节点上；

Ø 考虑到城市道路干道是汇集交通的渠道，因此一般不以干道作为规定小区的界限，尽可能使道路两侧在同一个交通小区；

Ø 划定区内的出行次数尽可能不超过全区域出行总数的10%~15%。

交通小区划分表记录了交通小区划分的情况，主要格式如下：

**表**6.77**交通小区划分**

| **字段名**      | **字段类型** | **字段说明** |
| --------------- | ------------ | ------------ |
| TrafficZoneNo   | String       | 交通小区编号 |
| TrafficZoneName | String       | 交通小区名称 |

###### ③ 监控点与交通小区对应表

监控点与交通小区对应表主要描述交通小区内的监控点的集合，根据监控点ID可以找到所属的交通小区，从而推算车辆在哪个交通小区，表结构如下：

**表**6.78**监控点与交通小区对应**

| **字段名**    | **字段类型** | **字段说明**       |
| ------------- | ------------ | ------------------ |
| DevicedId     | String       | 监控点设备Id       |
| TrafficZoneNo | String       | 所属的交通小区编号 |

###### ④ OD分析结果表

OD分析结果表是数据经过处理后的结果，主要记录从一个交通小区到另一个交通小区的车辆数，具体结构如下：

**表**6.79 **OD分析结果**

| **字段名称**       | **字段类型** | **字段说明**             |
| ------------------ | ------------ | ------------------------ |
| TrafficZoneNoA     | String       | 交通小区A编号            |
| TrafficZoneNoB     | String       | 交通小区B编号            |
| SmallCarNumber     | Long         | 小型汽车数量             |
| TruckNumber        | Long         | 货车数量                 |
| PassengerCarNumber | Long         | 客车数量                 |
| StatistcalTime     | String       | 统计时间（可精确到小时） |

##### 1.4.2.3.2 数据存储

车辆实时位置信息文件保存在HDFS分布式文件系统中，HDFS采用master/slave架构。一个HDFS集群是由一个NameNode和一定数目的DataNodes组成。NameNode是一个中心服务器，负责管理文件系统的名字空间以及客户端对文件的访问。集群中的DataNode一般是一个节点一个，负责管理它所在节点上的存储。HDFS暴露了文件系统的名字空间，用户能够以文件的形式在上面存储数据。从内部看，一个文件其实被分成一个或者多个数据块，这些数据块存储在一组DataNode上，NameNode执行文件系统的名字空间操作，比如打开、关闭、重命名文件或者目录，它也负责确定数据块到具体DataNode节点的映射。DataNode负责处理文件系统客户端的读写请求。在NameNode的统一调度下进行数据块的创建、删除和复制。

下图是HDFS文件系统的架构：

![image-20210727152842689](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152842689.png)

**图**6.71 **HDFS文件系统架构****示意图**

##### 1.4.2.3.3 **数据处理**

###### ① MapReduce分布式计算框架

Hadoop 的 Map/Reduce 集群主要由两类服务器构成：作业服务器及任务服务器。其中，作业服务器，也成为 Job Tracker，主要负责管理运行在该架构下的所有作业，也是为各个作业分配任务的核心。其与 HDFS 的 Namenode 类似，也是作为单点存在的，以简化负责的同步流程。而具体的负责执行用户定义操作的，是任务服务器 Task Tracker，每个作业被拆分为很多任务，包括 Map 任务和

Reduce 任务等，而作为基本执行的基本单位——任务，它们被分配到合适的任务服务器去执行，任务服务器一边执行一边向作业服务器汇报各个任务的状态，以此来帮助作业服务器了解作业执行的整体情况，分配新的任务等。

​	Hadoop 的 Map/Reduce 的系统架构，如下图所示：

![image-20210727152927159](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152927159.png)

**图**6.72 **Map/Reduce系统架构****示意图**

![image-20210727152933095](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727152933095.png)

**图**6.73 **Map/Reduce工作流程****图**

上图为Map/Reduce 的工作流程图。总体而言，整个 Map/Reduce 的工作流程，主要分为四个子流程：1、提交作业；2、作业初始化；3、任务分配；4、任务执行。根据该步骤流程，可以了解该框架的作业执行原理：

Ø 提交作业

首先，Map/Reduce 程序启动一个 Job Client 实例(步骤 1)；然后向 Jobtracker 请求一个新的作业 ID(步骤 2)；接着 Jobtracker 将运行作业所需要的资源——包括作业 jar 文件、配置文件和计算所得的输入划分——复制到一个以作业 ID号命名的目录Jobtracker的文件系统(步骤 3)；最后告诉 Jobtracker，作业准备执行(步骤 4)。

Ø 作业初始化

Jobtracker 接收到其作业准备执行的消息后，会将此作业放入一个内部自身维护的队列当中，通过作业调度器来对该队列的作业进行调度，并对该作业进行相应的初始化。初始化工作包括创建一个对象，代表正在运行的这个作业，同时为了方便跟踪任务的状态和进程，初始化时也将任务和记录信息封装进该对象 (步骤 5)；最后，为了创建运行任务列表，作业调度器首先从共享文件系统中获取 Job Client 已计算好的输入划分信息(步骤 6)，然后为每个划分创建一个 Map 任务。而 reduce 任务的数量由配置文件决定。最后调度器便创建这么多 reduce 任务来运行，而任务就在此时指定了 ID 号。

Ø 任务分配

Task Tracker 执行一个简单的循环，定期发送心跳方法调用到 Jobtracker，以告诉其自己的存活情况(步骤 7)。在 Jobtracker 为 Tasktracker 选择任务之前，Jobtracker 必须选定任务所在的作业，在这里，默认的方法是简单的维护一个作业优先级列表。选择好作业，Jobtracker 就可以为该作业选定一个任务。

Ø 任务执行

经过以上 3 个子流程后，已经将任务分配给 Tasktracker 了，接下来就是执行相应的任务。首先，它本地化作业的 jar 文件，从 HDFS 分布式文件系统将相应的 jar 及应用程序所需要的全部文件都复制到 tasktracker 所在的本地文件系统中(步骤 8)；然后新建一个属于该任务的本地工作目录，将 jar 文件的内容解压到该文件夹下；最后，新建一个Task Runner 实例来执行任务。对于每个任务，Task Runner 会启动一个新的 Java 虚拟机(步骤 9)来运行(步骤 10)，使得不会因为自定义的 map 函数及 reduce 函数的任何缺陷而影响 Tasktracker 的正常运行。

### 1.4.3 基于移动通信手机定位数据的OD分析

交通出行调查是为获取居民日常交通出行数据，通过数据分析可挖掘出居民对整个城市交通及其他城市功能需求的特征与分布情况，可对迸一步的城市交通规划、建设提供信息与决策支持。其中出行OD是进行交通规划和路网管理的重要基础信息，是反映出行需求空间分布的重要参数，其准确程度将影响交通分配模型的效果。

近年来，移动通讯技术以及定位技术的快速发展，有很多基于手机数据获取交通数据的研究。移动通信网络(Mobile commumcation Netrork(MCN))包含移动通信基站(Mobile CommuIlic“on Network Base Stations(MCN．Bs))及其发射信号和移动台(主要指手机(Mobile phone))。随着手机拥有量的与同俱增，城市居民已经普及了手机的使用，手机可以作为一个居民随身的出行探测器，实时返回居民的出行位置信息，利用移动通信网络设施分析出行0D信息已经具备实际应用的条件。并且传统的OD获取基本上是通过入户调查、询问调查等居民出行调查的方法。该方法一般是询问被访者对前一天或者当天出行信息回想并填写问卷，问卷信息包括出行时问，出行起止点等。这种方法存在一些问题和局限。比如：1)居民出行调查成本较高，耗费的人力物力财力以及时问较多；2)抽样的样本非常有限，拘于成本的限制，该方法只能抽取较少部分居民进行出行问卷调查：3)数据更新频率较低，各大城市居民出行调查基本上是每隔5年以上才进行一次；4)调查数据质量较低。被访者对出行的信息回忆不清，或者随意给出出行信息，严重影响了调查数据的准确度。5)数据采集分析过程较长，整个采集分析过程需要3个月以上。然而基于手机数据的OD获取基本上可以克服上述问题。手机目前已经成为普遍使用的移动通信工具，手机对外通信或者跨区移动时就会与附近的基站进行信息交互，基站将会记录通信手机编号、事件类型、交互时间、基站编号等信息传回后台移动业务数据管理中心。通过这些记录信息结合基站的位置信息，可以判断用户出行时间及出行位置，得到用户一天的出行链，从而推断城市交通出行数据。相比其他交通数据采集系统，基于移动通信网络数据的交通信息提取方法拥有多方面的优势。

Ø 覆盖范围广

移动通信网络目前已经基本实现无缝覆盖，尤其是城市区域内。在网络覆盖区域内均可以获取用户记录数据，并且可是多层次分析，从热点区域、城市市域到跨省路网。

Ø 样本量极大

手机用户量的不断增长，移动通信网络覆盖率的进一步提升，都为数据采集样本量提供了保证。例如仅北京市移动用户多大1500多万，每天产生记录数据上亿条。

Ø 采集数据实时性强

移动通信网络实时采集数据可以得到任意时刻的动态的交通数据。为全面优化评估城市交通状态提供数据支撑。

Ø 基础设施再投资少

移动通信网络基础设施已经具备，并且提取交通信息不需要大量的额外配置，分析数据只需要很少的设备，相对传统交通数据采集手段投资低廉。

Ø 定位精度基本满足交通信息提取要求

定位精度与采用定位技术有关，同业还要取决于外部环境，包括地理位置、无线传播环境以及基站密度。基站分为两类，一类是宏蜂窝，覆盖半径在1—25km，一类是微蜂窝，覆盖半径在30.300m。市域内基站密度较高，搭配有较高比例的微蜂窝，定位精度可以达到30—300m的范围。美国Fcc要求的移动通信定位精度在 50m以内的概率为67％，定位精度在150m以内的概率为95％。

Ø 适合城市通勤交通分析及OD获取

移动通信网络数据的定位精度以及数据采集机制非常适合城市通勤交通的分析和OD数据分析。分析城市早晚高峰交通拥堵成因，分析用户出行与城市交通出行的机理。

由上述分析可以看出，相对于传统的调查方法，移动通信网络数据用于交通数据采集在手机普及率较高的地方，其数据来源稳定可靠、样本量大，并且基础设施投资小，费用低，非常适合交通信息采集。以手机作为用户出行的移动探测器，基站网络作为固定监测器，从而组成全息的城市交通出行信息获取系统。

#### 1.4.3.1 OD调查相关理论基础

##### 1.4.3.1.1 OD调查的结果表达

![image-20210727153106396](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153106396.png)

![image-20210727153114358](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153114358.png)

##### 1.4.3.1.2 出行停留点

在用户的出行轨迹中，如果某用户在某个位置游览或者驻足，而不只是简单地路过，我们就认为该用户在这个位置处于停留状态，即该位置是此用户本次出行的一个停留点。停留点通常是用户感兴趣的区域，如居住地、学校、工作地、商场、重要交通枢纽等。识别用户出行的停留点具有十分重要的意义，作为用户行为分析中的一个关键环节，它可以用于分析与预测用户的行为模式从而基于用户的特征向用户推送满足其潜在需求的位置服务、获取居民出行OD矩阵帮助交通规划与管理等等。

常用的停留点提取方法：

基于行进速度识别停留点

根据手机用户的定位数据计算用户在每个定位位置的移动速度，若移动速度小于预先设定的速度阈值，则认为该位置是停留位置，然后结合停留点判别时间阈值，将持续一定时间的停留位置判定为停留点。该算法的主要流程如图所示。

![image-20210727153154856](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153154856.png)

**图**6.74**基于行进速度识别停留点算法流程****图**

基于K.中值聚类算法的停留点识别算法

该算法主要是利用K.中值聚类算法来获取用户出行的停留点信息，具体步骤如下：预先设定聚类半径r及簇中点的最小数量minPts：从用户定位数据中的第一个定位点开始，计算连续minPts个定位点中任意两个定位点之间距离的最大值，如果最大值小于聚类半径r，则新建一个簇C并计算该簇的中心，然后计算簇中心与簇外下一个定位点的距离d，若d小于r，则将该点加入簇C中，否则输出簇C；重复以上判断过程，直到定位数据中所有的定位点处理完毕，最终得到的各个簇也就是识别出的停留点，停留时间为簇中第一个点与最后一个点的定位时间差。基于K.中值聚类算法的停留点识别算法的主要流程如图所示：

![image-20210727153204287](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153204287.png)

**图**6.75**基于K.中值聚类算法的停留点识别算法****流程图**

基于K.中值聚类的停留点识别算法用簇内相距最远的两个定位点之间的距离来界定一个簇，因此停留点识别效果受到噪声的影响比较大，此外，该聚类方法无法适应形状不规则的簇。

基于DJ.Cluster聚类的停留点识别算法

预先设定聚类半径r和簇中点数的最小值minPts，并将所有定位点的簇标记初始化为.1。从定位数据中选择一个簇标记为.1的定位点P，计算点P的r.邻域内的定位点数量，若小于minPts，则令点P的簇标记为0(即将点P标记为噪声点)，否则建立一个新簇C，并将点P和点P的卜邻域内的所有定位点均加入簇C中；判断已有的簇中是否存在簇和簇C相交，如若存在则将其与簇C合并。基于DJ．Cluster的停留点识别算法的主要流程如图所示。

![image-20210727153212832](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153212832.png)

**图**6.76**基于DJ.Cluster聚类的停留点识别算法****流程图**

 

基于DJ．Cluster聚类的停留点识别算法使用的前提是定位数据等时间间隔采集，在实际情况中由于定位数据非等时采集而普遍存在定位数据缺失的现象，因此在实际应用中该方法识别出的停留点误差比较大。

基于CB.SMoT聚类的停留点识别算法

预先设定CB.SMoT算法的聚类半径r和停留点判别时间阈值t；从定位数据中选择一个未处理的定位点P，计算得到点P的r.线性邻域内的所有定位点集合Neighbors，点P是核心点，则依次对Neighbors中的点进行以下处理：从Neighbors中选取一个定位点q，计算点g的r.线性邻域内的所有定位点，并将其加入Neighbors，将Neighbors设为一个簇，并将Neighbors中的所有点标记为已处理；结合停留点判别时间阈值f对聚类所得的各个簇分别进行判别，从中识别出最终的停留点。

基于CB.SMoT聚类的停留点识别算法采用的是线性邻域，即考虑的是相邻点之间的累积距离，因此容易受到定位漂移的影响，特别是当用户处于停留状态时产生的长距离漂移会对停留点识别的准确度带来致命的影响。

##### 1.4.3.1.3 交通小区划分

在城市交通规划的过程中通常需要先把握城市交通现状，这需要调查、分析城市居民的出行情况。通过对居民出行的调查和研究，城市规划人员掌握了大量的出行相关数据，这些数据都是以微观的形式呈现的，一方面包含了出行者的出行信息，如出行者的出发地、出发时间、目的地、交通方式、出行距离、出行目的等信息，一方面包含了出行者的个人信息，如出行者的年龄、性别、职业身份、收入情况、工作地点、家庭住址等信息。

每条出行数据都是一个相对独立的交通源，由于城市交通规划是相对宏观的一个概念，它是以某个城市或某个区域内某个群体为研究对象而不是某个个体的行为，因此这些微观的交通源在实际研究过程中会给城市规划带来许多的麻烦。比如说即使我们掌握了某个城市区域内所有的出行信息，但是由于数据量太过庞大，难以从海量的微观信息中去提取出它的特征，以致于我们无法掌握交通研究中真正需要的信息。因而我们必须把交通调查获取的微观的出行数据进行宏观化，也就是把这些交通源转换为宏观交通源，交通小区就是在这样的背景下以作为宏观交通源而出现的，它根据研究区域内不同子区域的人口性质、用地属性、经济特性、社会特性等基本特征将研究区域划分为多个子区域。

由交通OD调查得到了某个研究区域内共20条居民出行信息，其中，每个箭头表示一次交通出行。利用交通小区划分方法对该研究区域进行交通小区划分，将研究区域划分成了5个交通小区，即4、B、C、D和B然后将同一个交通小区内的不同位置地点都统一用该交通小区标识来表示，这样便将图中的20条出行信息转化成了5个交通小区之间的出行关系，转换后该研究区域内的交通出行情况如图所示，从该图中可以看出原本看起来复杂而杂乱的出行信息变得直观了，并且转换后可以将小区间的出行与各个小区的特征联系起来，便于规划者从宏观角度来研究交通问题。

![image-20210727153240833](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153240833.png)

**图**6.77**某区域交通OD调查获取的20条出行信息****示意图**

![image-20210727153248584](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153248584.png)

**图**6.78**将研究区域划分成5个交通小区****示意图**

交通小区划分的主要作用如下：

Ø 在保证一定精度的基础上，提高了交通调查在实际应用中的可行性，减少了调查过程所需的工作量，降低了分析、预测交通信息的难度；

Ø 将原本微观上看起来杂乱无章的各个居民的出行信息转换成宏观上有章可循的交通小区之间的交通发生／吸引量，可以方便城市规划者直观的观测空间上的交通流动情况；

Ø 可以获取城市路网上的交通流量，再结合交通分配理论模型即可模拟路网上的交通流。

交通小区划分原则：

交通小区划分的大小与数量会对交通调查、分析和预测的工作量及结果的精度产生显著的影响，从精度上考虑，交通小区划分的面积越小越好，然而如果我们把交通小区划分得过小，那么相应后续的交通调查、分析与预测的工作量便会急剧增大。因此划分交通小区需要考虑诸多因素，一般而言需要遵循以下几条原则：

Ø 尽量使同一交通小区内部不同区域的土地使用、经济、社会等特性保持一致，小区内的土地利用特性应尽量简单；

Ø 尽量保持已有的行政区划分方案，便于在交通规划中可以直接利用行政区现有的相关统计资料；

Ø 尽量将铁路、河流、山川等天然屏障当作交通小区划分的边界，避免同一交通小区里有自然或者人为的障碍线；

Ø 划分的交通小区数目应当适中，一般来说，中等城市划分的小区数最好在50个以内，大城市最好在100～150个；

Ø 将城市道路网的构成纳入考虑，尽量使得交通小区划分结果和城市现有路网保持一致，可以选取路网中的节点作为交通小区的质心；

Ø 由于城市干道是交通汇聚的地方，所以通常情况下不将干道作为小区划分的边界，而应尽量将道路两边划分到一个交通小区内；

Ø 交通小区内部的出行次数最好保持在全区出行总次数的10%~15％的范围内；

Ø 对于已经作过交通OD调查的研究区域，一般应当保持现有的交通小区划分方案；

Ø 均匀性和由中心向外逐渐增大原则：如果研究区域的面积比较小并且用地强度的差异性不大，则交通小区划分一般应在小区面积、区内人口、交通发生／吸引量等方面保持一定的均匀性；而如果研究区域的面积比较大或用地强度的差异性较大，则随着距离核心区域的距离增大，交通小区划分的亟积也相应地逐渐增大；

Ø 如果某交通小区内部包含高速公路闸道、大型公共交通枢纽或者车站，为了便于利用这些交通设施的流动性进行进一步分析，应尽量使这些交通设施包含在某个交通小区内部，避免将其分割到多个不同的交通小区中。

交通小区划分方法：

基于区域特性聚类分析的交通小区划分

先参考研究区域内的行政区划信息，对研究区域进行初步的细粒度的交通小区划分，然后分析各个交通小区内的用地性质、土地利用、经济、社会等特性，采用系统聚类方法，选取适当的聚类指标对初步小区划分所得的交通小区进行聚类，将空间上相近且小区特性相近的小区合并，再根据交通小区划分原则对合并后的交通小区予以修正，得到最终的交通小区划分方案。基于区域特性聚类分析的交通小区划分的总体划分流程如下图所示。

![image-20210727153300223](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153300223.png)

**图**6.79**基于区域特性聚类分析的交通小区划分流程****图**

面向控制的交通小区划分

对同一交通小区内部的路网交叉口进行协调控制，基于对交通路网拓扑结构特点的分析，将交通小区动态划分策略与交通小区静态划分策略结合，形成小区划分算法，结合关联度变化情况得到最终的小区划分结果。

基于区内出行比例的交通小区划分

将交通小区划分原则中的区内出行比例作为约束小区划分的条件，先调整小区半径的取值，并计算当小区半径取R、出行距离取S时的区内出行比例，再将计算得到的区内出行比例与约束条件比较，判断其是否满足约束条件，若不满足则重新调整交通小区半径后继续判断，若满足则根据小区半径只得到交通小区划分方案。

基于对手机话务量的聚类分析的交通小区划分

首先根据土地利用特性初步进行交通小区划分，并结合基于Cell.ID定位的手机定位数据得到交通OD矩阵，然后将基站覆盖的范围映射到初步划分好的交通小区上，使得基站的覆盖范围与交通小区相结合，得到最终的交通小区划分方案。

基于扇形分割法的交通小区划分

先从研究区域内的路网中找出能够利用的路网节点，并且为每个节点画一个扇形势力圈，然后基于GIS利用泰森多边形对研究区域进行几何分割实现交通小区的划分，同时用加权平均法对小区的人口、土地利用特性等属性数据进行分割。

基于GPS数据聚类的交通小区划分

从交通数据中抽取出租车乘客上下车的GPS位置坐标，经过优化处理后得到居民出行的起讫点，基于聚类和交通划分的相似性，利用K.Means聚类算法对起讫点聚类，然后计算每个簇的边界，得到交通小区划分方案。基于GPS数据聚类的交通小区划分的总体划分流程如图所示

![image-20210727153309854](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153309854.png)

**图**6.80**基于GPS数据聚类的交通小区划分****流程图**

#### 1.4.3.2 手机定位数据的预处理

目前主要的手机定位方法包括以下几种：

Ø Cell.ID定位法，根据用户所持移动终端所处的基站位置来定位用户的位置，其定位精度受基站覆盖小区半径的影响，定位精度比较低

Ø TOA(Time ofArrival，到达时间) 定位法，基于用户移动设备和设备所处基站信号传播时延来获得基站与设备终端之间的距离，通过某一终端与多个基站之间的距离关系列方程组获取该终端所在的位置，即用户所处的位置，该定位方法受多径效应的影响较大

Ø TDOA(Time Difference of Arrival，到达时间差)定位，其主要思想是测量移动终端信号传到多个基站所用时间的差值，该定位法具有无需更改现有手机终端、较高的定位精度等优点，是GSM系统中最流行的一种移动终端定位技术

Ø AOA(Angle of Arrival，到达角度)，主要基于电磁信号的入射角度对移动终端进行定位，该方法安装维护费用高，易受到多径传播的影响

Ø GPS(Assisted GPS，辅助GPS技术)定位，它通过融合移动基站提供的位置信息和GPS位置信息来定位移动终端，具有定位精度高、首次捕捉GPS信号速度快的优点。

本系统的源数据为电信用户的手机定位数据，其采用的定位方法为TDOA定位法，源定位数据中的字段包括：用户识别码、定位日期、定位时间、位置经度、位置纬度、记录类型、归属地、年龄、性别，其中，位置经纬度采用WGS．84坐标系。从源数据中提取出与OD矩阵获取相关的重要字段，经过数据提取、整合后的每个定位点的字段说明如表所示：

**表**6.81**定位点字段说明**

| **字段名称** | **字段数据类型** | **字段描述**                           |
| ------------ | ---------------- | -------------------------------------- |
| UserId       | String           | 用户识别码，经过加密处理后的用户手机号 |
| Date         | DATE             | 位置更新日期                           |
| Time         | TiME             | 位置更新时间                           |
| Longtitude   | Double           | 定位位置的经度值                       |
| Latitude     | Double           | 定位位置的纬度值                       |

手机定位数据存在的问题：

在手机定位数据的采集、存储过程中，由于GSM网络自身存在的一些缺陷和外部自然、人为环境的干扰，以及所采集数据记录、转移过程中错误数据的引入，导致源定位数据中存在着大量“噪声”数据，这些“噪声”的存在会对OD矩阵的获取产生极大的影响。

通过对提取出的源定位数据进行分析，发现其主要存在以下数据缺陷：

（1） 缺陷数据

手机定位数据中的重要字段主要包括：用户识别码(UserlD)、定位日期(Date)、定位时间(Time)、位置经度(Longtitude)、位置纬度(Latitude)，其中任一字段为空值或其值不在该字段正常取值范围(如经度不在![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps92.jpg)范围内)，则可认为该条定位数据属于缺陷数据。

（2） 漂移数据

城市内林立的高楼和茂密的植被造成了电磁波非视线传播和多径效应的存在，这使得采集的手机定位数据具有一定程度的误差，使记录的移动终端的定位位置与其实际所处的位置之间具有较大程度的偏移，即产生了漂移数据。漂移数据对于出行用户来说是其实际的出行过程中未曾发生的，属于虚假的行程，其实质是用户出行轨迹中的“噪声”数据，这种虚假的行程会对识别用户出行的停留点产生极大的影响，它可能造成某一停留点被分割成多个，甚至某些停留点根本无法被识别出来。为了更精确地识别用户出行的停留点，需要针对漂移数据进行处理。

（3） 定位数据采集的时间间隔不均匀

一般来说手机定位数据采集主要是在用户接＼打电话、收＼发短信、上网、移动终端所属的基站小区切换时记录用户所处的位置，再加上一定时间周期地自动更新用户的位置，最终所采集到的定位数据并不是等时间间隔的，这导致两条不同的定位数据在时间维度上的所代表的意义可能不一样。如下表所示，某用户U有四条定位数据，通过分析表中的四条定位数据，我们可以推测出U的行程：U于18：01：01到达位置A，在位置A停留了4分钟，然后于18：06：01到达位置B，最后于18：07：01到达位置C。由于这四条定位数据的采集时间不是等时间间隔的，所以其在时间维度上的意义不同，其中第3条和4条定位数据在时间维度上只分别表示了一分钟，而第l条和第2条数据在时间维度上表示了连续的四分钟。不同的定位点在时间维度上的意义不同，会对后续停留点识别算法产生极大的影响，所以需要针对这一问题进行相应的数据预处理，使得定位数据是等时间间隔的。

**表**6.82**数据处理结果**

| **序号** | **用户识别码** | **定位日期** | **定位时间** | **定位位置** |
| -------- | -------------- | ------------ | ------------ | ------------ |
| 1        | U              | 20170501     | 18:01:01     | A            |
| 2        | U              | 20170501     | 18:05:01     | A            |
| 3        | U              | 20170501     | 18:06:01     | B            |
| 4        | U              | 20170501     | 18:07:01     | C            |

针对手机定位数据存在的主要问题，统一在数据清洗系统中进行处理，主要的处理方法有：

1、缺陷数据的处理

缺陷数据的处理主要包括：

Ø 去除存在任意重要字段缺失的定位数据；

Ø 去除某一字段值不在该字段正常取值范围的定位数据。

2、漂移数据的处理

![image-20210727153843174](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153843174.png)

3、定位数据等时间间隔化处理

![image-20210727153903262](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153903262.png)

![image-20210727153917287](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727153917287.png)

其中，k表示插入的第k个点，取值范围为![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps93.jpg)。

重复以上等时间间隔化过程，直到所有定位点均处理完后结束，即得到等时间间隔化后的定位数据。例如用以上定位数据等时间间隔化处理方法对表中用户U的四条定位数据进行处理，其中tslot取lmin，处理后的定位数据如表所示：

**表**6.83**数据处理结果**

| **序号** | **用户识别码** | **定位日期** | **定位时间** | **定位位置** |
| -------- | -------------- | ------------ | ------------ | ------------ |
| 1        | U              | 20170501     | 18:01:01     | A            |
| 2        | U              | 20170501     | 18:02:00     | A            |
| 3        | U              | 20170501     | 18:03:00     | A            |
| 4        | U              | 20170501     | 18:04:00     | A            |
| 5        | U              | 20170501     | 18:05:00     | A            |
| 6        | U              | 20170501     | 18:06:00     | B            |
| 7        | U              | 20170501     | 18:07:00     | C            |

对表中的定位数据经过等时间间隔化处理后，原始的四条定位数据变为了七条，每条数据在时间维度上代表的意义相同，即1分钟的时间间隔，便于后续用聚类算法对定位数据进行聚类以识别用户出行的停留点和出行链。

#### 1.4.3.3 基于“空间.时间”双层聚类的停留点识别算法

OD矩阵即起讫点矩阵，要想获取某个城市在某个时间段内的OD矩阵，就需要知道该市居民在这个时问段内所有交通出行的起点和讫点，即出行停留点。在居民的出行定位数据中，不同的定位点的重要性可能不同，其中一些点表示人们会停留一段时间的位置，如工作地点、住家、商场、学校等，这类的点就称为停留点。如下图所示的某居民出行移动轨迹中有两种类型的停留点：第一种停留点是单个的轨迹点，如点![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps96.jpg)，表示居民在一段时间内在该点处于静止状态；第二种停留点是多个轨迹点组成的停留区域内的所有点的几何中心点，如点!![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps97.jpg)，表示居民在该位置附近小范围移动，或者虽然居民在该位置处于静止状态但由于定位误差的存在使得居民看似在小范围移动。

将停留点按到达时间(到达某个停留点的时间即为第一个进入该停留点所处停留区域的轨迹点的定位时刻)进行升序排列，就得到了刻画该用户出行的出行链。为了从手机定位数据中获取用户出行的停留点和出行链，本文提出了基于“空间.时间”双层聚类的停留点识别算法。

![image-20210727154043645](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154043645.png)

**图**6.81**出行轨迹中的停留点****示意图**

##### 1.4.3.3.1 空间层聚类并优化聚类结果

1、DBSCAN聚类算法简述

聚类分析是数据挖掘领域的一个重要算法，其目标是让位于同一簇里的各个对象之间最大限度地相似，而位于不同簇里的各个对象之间最大限度地相异。根据聚类思想的不同，聚类算法总体来说可以划分为如下几大类：基于划分的聚类、基于层次的聚类、基于密度的聚类、基于网格的聚类、基于模型的聚类。在用本文中的提出的数据等时间间隔化处理方法对原手机定位数据进行预处理后，居民在某个地点停留时间的长短就可以由定位轨迹点在空间上的密度的高低得到，因此本文利用基于密度的聚类算法对定位点在空间层上聚类，再结合停留点判别时间阈值这一约束条件，初步实现居民出行候选停留点的获取。

DBSCAN算法是聚类算法中的一种基于密度的聚类算法，它的目的是将低密度部分过滤掉，将高密度样本点识别出来，该聚类算法不仅可以识别出任意形状和大小的簇、而且具有较高的抗干扰性。

DBSCAN算法相关的几个定义如下：

![image-20210727154155853](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154155853.png)

![image-20210727154209469](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154209469.png)

2、基于聚类获取候选停留点

由于手机定位存在一定程度的误差，即使居民的位置不动其定位结果也会出现一定程度的改变；而且根据交通调对出行的界定，出行是指交乘坐通工具行驶超出500米或者步行耗时超出5分钟的活动，因此，从定位数据上反映出来的小范围内居民的位置移动并不意味着居民进行了一次出行。基于以上考虑，本文将居民出行的停留点定义为：对于给定的定位点P，如果以点P为中心、半径为R(停留点判别距离阈值)的邻域内的定位点的个数N≥MinP(MinP为使得定位点P满足停留点定义的R．邻域内的最小点数)，则称点P及其R.邻域内所有的定位点组成的集合S为停留区域，用集合S中所有点的几何中心点来表示这个停留区域，这个几何中心点也就是停留点，到达该停留点的时间为S中的第一个定位点，停留时长为N(单位时间)。由于前面对定位数据进行了等时间间隔化处理，每个定位点在时间维度上的长度相同，都为一个单位时间tslot，所以上述停留点定义中使得点P满足停留点定义的MinP的取值也就是停留点判别时间阈值，点P的R．邻域内的定位点数量N也就是该停留点的停留时长。

为了快速从居民的手机定位数据中获取停留点，本文首先利用DBSCAN算法的聚类思想来对数据预处理手机定位数据进行聚类，获取居民出行的候选停留点。

3、基于KNN算法的思想优化聚类结果

前面对原手机定位数据进行了预处理，其中包含漂移数据的处理，其主要思想是基于速度删除移动速度大于城市交通最大速度的漂移点，但是由于原始手机定位数据是非等时、不均匀采集的，并且连续两条定位数据采集的时间间隔有时候较大，这使得即使某个定位点与前一定位点之间的位移速度小于城市交通最大速度但该点仍然可能是漂移点，因此仅仅根据两个定位点之间的位移速度无法识别出全部的定位漂移点，而这些定位漂移点的存在会极大地影响停留点的识别效果，它们的存在可能会将一个长时停留点划分为多个短时停留点，甚至可能会导致一部分停留点根本无法被识别出来。因此，为了更精确地识别出用户出行的停留点，我们利用KNN算法（k.近邻法）的思想对聚类结果进行优化。KNN算法是机器学习算法之一，其主要思想是：对于一个给定的样本，如果与此样本相距最近的K个实例中大部分属于某个类别，则判定此样本同样属于这个类别。

基于KNN算法思想对聚类结果进行优化的具体步骤如下：

![image-20210727154247117](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154247117.png)

##### 1.4.3.3.2 时间层聚类

对居民出行轨迹点进行聚类并优化后，从手机定位数据中提取出了居民出行的候选停留点。由于在空间维度上相近的定位点在时间维度上可能相距较远，例如某居民上午在地点A工作，中午离开地点A吃午饭，下午继续回到地点A工作，仅在空间层上对该居民的轨迹点聚类会将其上午和下午的工作地点A聚为同一个簇，即只能识别出一个候选停留点，但实际上该居民在地点A停留了两次，从理论上来说应该有两个停留点，因此需要在时间维度上对候选停留点经过进一步地处理，才能得到居民出行最终的停留点及出行链。本文在空间层聚类并优化后所提取出的候选停留点的基础上，在时间层上聚类以对候选停留点进行划分和取舍。具体实现步骤描述如下：

![image-20210727154315335](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154315335.png)

通过上述步骤1）~5）的处理后，得到最终的居民出行的停留点集合SP，由于该集合中的停留点是按照到达相应停留点的时间升序排列的，所以可由停留点集合SP直接获取居民出行的出行链。

 

本系统的所提出的该算法的主要优势在于：

1）预先设定停留点判别时间阈值和距离阈值后，停留点识别算法将连续时间内距离间隔在停留点判别距离阈值内的轨迹点聚为一类，再结合时间阂值进行停留点的取舍，该算法在停留点识别过程中停留点判别范围是固定，也就是预先设定的距离阈值，而停留点识别结果受距离阈值取值大小的影响，取值过大会导致将多个停留点识别为一个或者将非停留点识别为停留点，取值过小会导致一些停留点无法被识别出。此外，不同地理位置的停留点判别距离阈值也可能不同，该算法使用同一距离阈值作为标准来识别所有的停留点也会导致结果有所偏差。本文所提的停留点识别算法先利用DBSCAN算法的思想对轨迹点在空间层上进行聚类并优化聚类结果得到候选停留点，再在时间层上对候选停留点进行划分和取舍，只需预先设定满足出行定义的最小出行距离为停留点判别距离阈值来对定位数据进行聚类，最终的停留点判别范围不是预先固定的唯一值而是会在聚类过程中自适应。

2）现有的去定位数据漂移主要是基于轨迹点的位移速度进行判断，将移动速度大于城市交通最大速度阈值的轨迹点删除，而实际上由于定位误差的存在，加上手机定位数据的采集不是周期、频繁性的，因而去漂移处理并不能处理移动速度在最大速度阈值范围内的漂移点，而传统的停留点识别算法受定位漂移的影响较大，易将一次停留分割成多次停留甚至无法识别出某些停留点。本文所提的算法在聚类后结合停留点定义利用K.近邻法的思想对聚类结果进行优化，可以去除部分定位漂移点，提高了停留点的识别率。

#### 1.4.3.4 居民出行OD矩阵获取

##### 1.4.3.4.1 基于K.Means算法的交通小区划分

通过5.4.3.3章提出的基于“空间.时间”双层聚类的停留点识别算法，可得到某城市居民在某个时间段内所有交通出行的停留点，也就是居民出行的起点或者终点，其反映了该城市居民交通出行的空间分布特征，基于聚类与交通小区划分的相似性，可以利用K.Means类算法对停留点进行聚类从而实现交通小区的划分。基于K.Means聚类算法的交通小区划分方法的具体步骤如下：

1、K.Means算法中参数k的确定

利用K.Means算法对停留点进行聚类，聚类所得的k个簇即为k个交通小区。K.Means算法使用前需要先设定参数k的取值，为了确定在本交通小区划分方法中K.Means算法中的参数k，本文结合前面章节中介绍的交通小区划分原则中可量化的以下两条原则来约束k的取值。

原则1：交通小区的划分数量要适量，中等城市划分小区数应在50个以内，大城市应在100..150个，交通小区划分数量与城市入口对应关系如表所示；

**表**6.84**交通小区划分数量与城市人口对应关系**

| **城市人口（万人）** | **交通小区数（个）** | **城市人口（万人）** | **交通小区个数（个）** |
| -------------------- | -------------------- | -------------------- | ---------------------- |
| 10~25                | 5~10                 | 50~100               | 15~50                  |
| 25~30                | 8~20                 | 100~200              | >50                    |

原则2：交通小区内部出行的次数与交通小区总出行次数之比应限制在5％15％的范围内。

2、用K.Means算法对停留点聚类

基于l中计算得到的参数k的值，利用K.Means算法对停留点进行聚类，主要步骤如下：从所有停留点中随机选择后个停留点作为初始聚类中心，分别计算其他停留点到各个聚类中心的距离，再将每个停留点分配给最接近的聚类中心所在的簇，然后计算每个簇中停留点的几何中心作为新的聚类中心，并基于新的聚类中心重新分配停留点。重复以上迭代过程，直到簇中心几乎不再变化或预先设定的迭代终止条件时聚类结束，即得到k个簇。

3、计算交通小区边界

使用K.Means聚类算法将停留点聚为了k个簇，映射到地图上即为k个区域，接下来需要分别对每个簇进行边界计算，以获取各个小区的小区边界。小区边界计算的主要步骤如下：

![image-20210727154411341](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154411341.png)

![image-20210727154415212](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154415212.png)

![image-20210727154424468](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154424468.png)

![image-20210727154426812](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154426812.png)

步骤4：通过步骤l~步骤3初步得到的小区边界呈锯齿状，在不破坏小区边界线要素的基本形状的前提下，利用ArcGIS工具箱中的折弯简化工具来删除初步计算得到的小区边界线中无关紧要的折弯和无关紧要的凹进和凸出。折弯简化将线状要素看作是由一系列的折弯组成的，其中各个折弯在其连续折点处的拐角符号都是相同的，通过比较每个折弯处的多个几何属性以及直径为预先设定的简化容差的参考半圆的对应属性，以确定某个折弯是应该保留还是删除，如果需要删除则用基线(即连接原折弯端点的线)来代替原本的折弯，从而实现线状要素的简化。

##### 1.4.3.4.2 OD矩阵计算

![image-20210727154459341](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154459341.png)

![image-20210727154511310](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154511310.png)

![image-20210727154523135](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154523135.png)

![image-20210727154533493](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154533493.png)

![image-20210727154539715](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727154539715.png)

**图**6.84**判断停留点是否在某个交通小区内**