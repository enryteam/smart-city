# 一、什么是物联网平台

物联网平台是一个集成了设备管理、数据安全通信和消息订阅等能力的一体化平台。

向下支持连接海量设备，采集设备数据上云；向上提供云端API，服务端可通过调用云端API将指令下发至设备端，实现远程控制。

物联网平台与设备、服务端、客户端的消息通信流程如下。

![企业基于物联网平台的业务链路](https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/5826597261/p132750.png)

使用物联网平台实现设备完整的通信链接，需要您完成设备端的设备开发、云端服务器的开发（云端SDK的配置）、数据库的创建、手机App的开发。在设备和服务器开发中，您需完成设备消息的定义和处理逻辑。

# 二、IoT设备消息通信

## 2.1 阿里云

设备通过物联网平台上下行通信说明如下。

| 通信链路 | 说明                                                         |
| -------- | ------------------------------------------------------------ |
| 上行通信 | 设备通过MQTT协议与物联网平台建立长连接，上报数据（通过Publish发布Topic和Payload）到物联网平台。 |
|          | 通过AMQP消费组，将设备消息流转到您的ECS服务器上。            |
|          | 通过物联网平台的云产品流转功能，处理设备上报数据，将处理后的数据转发到RDS、表格存储、函数计算、TSDB、企业版实例内的时序数据存储、DataHub、消息队列RocketMQ等云产品中，进行存储和处理。 |
| 下行指令 | 通过手机App下发指令，使ECS业务服务器调用基于HTTPS协议的API接口Pub，给Topic发送指令，将数据发送到物联网平台。 |
|          | 物联网平台通过MQTT协议，使用Publish发送数据（指定Topic和Payload）到设备端。 |

## 2.2 华为云

​        【摘要】 消息通信是基于物模型设计的，数据上行主要分为属性上报、消息上报，数据下行主要分为命令下发、消息下发、属性修改（下发）。基于物模型的包含属性、命令，事件，超出物模型定义之外的包含消息。    

物联网平台具有双向设备通信的功能。一方面您可以通过设备侧接口，将数据上报到物联网平台，再通过订阅推送把数据推送到您的应用上，或者转发到其他华为云通道。另一方面，您可以通过应用侧接口或控制台，将命令下发给设备，实现对设备远程控制。

**消息通信是基于物模型设计的，数据上行主要分为属性上报、消息上报，数据下行主要分为命令下发、消息下发、属性修改（下发）。****基于物模型的包含属性、命令，事件，超出物模型定义之外的包含消息。**



| 数据类型 | 消息类型 | 差异点                                                       | 相同点                                               |
| -------- | -------- | ------------------------------------------------------------ | ---------------------------------------------------- |
| 数据上行 | 属性上报 | 依赖产品模型，需要与产品模型中定义的的属性相匹配，支持在控制台的设备详情中查看最新上报的快照数据，支持推送给已订阅的应用侧，支持通过数据分析服务查看历史数据。 | 都可以通过设备侧接口上报数据给平台，都支持规则转发。 |
|          | 消息上报 | 不依赖产品模型，平台对消息内容不进行校验，不支持在控制台的设备详情中查看最新上报的快照数据，不支持通过数据分析服务查看历史数据。 | 同上。                                               |
| 数据下行 | 命令下发 | 依赖产品模型，需要与产品模型中定义的的命令相匹配，是同步的（命令下发后等待设备侧的回复响应，若无响应则超时失败），支持控制台下发命令。 | 都可以通过应用侧接口调用给设备下发指令。             |
|          | 属性修改 | 依赖产品模型，需要与产品模型中定义的属性相匹配，是同步的（属性修改后等待设备侧的回复响应，若无响应则超时失败），支持控制台属性配置（设备影子），支持通过设备影子修改设备属性实现异步方式。 | 同上。                                               |
|          | 消息下发 | 不依赖产品模型，平台下发消息给设备，是异步的（消息下发后无需等待设备侧回复响应），不支持控制台下发消息。 | 同上。                                               |

