# 具有资源开放性的物联网能力要求

2021-04-30发布 	2021-08-01实施

# 1 范围

本标准规定了具有资源开放性的物联网的需求、应用场景,以及开放物联网的系统架构,在此基础上对物联网平台、感知延伸网络和应用层提出了进一步的能力要求。本标准适用于开放性的物联网。

# 3 术语、定义和缩略语

## 3.1 术语和定义

### 3.1.1资源 resource

具有唯一标识(如URI),能够被统一接口访问,即能够被创建、修改、更新、删除的一些信息资源。
注:资源可以是通过应用或服务映射而得到的信息资源,包括:设备侧应用及其能力、网络侧应用及其能力,也可以是通过应用数据的映射而得到的信息资源,包括:一个文件、一张图片、一段视频等。

## 3.2 缩略语

下列缩略语适用于本文件。
GPS:全球定位系统(GlobalPositioningSystem)
URI:统一资源标识符(UniformResourceIdentifier)
URL:统一资源定位符(UniformResourceLocator)

# 4 需求

具有资源开放性的物联网架构应满足以下需求:
———在物联网应用中,<font color='red'>数据可是感知延伸层上传给物联网应用的数据,也可是物联网应用传递给感知延伸层设备的数据</font>，在开放的架构下,物联网支撑平台可根据物联网应用的需求或者最终用户的需求对数据进行缓存,当物联网应用或者最终用户需要使用这些数据时到物联网平台去查询,这样可灵活地部署和使用物联网应用。

例如在远程医疗的应用中,用户不用实时接收其身体的状况,可定时去平台读取其身体的各项指标,而部署远程医疗应用的单位(如社区)可在每天的固定时刻去平台读取病人的数据供分析整理,这样可大大简化远程医疗的部署。同时为了省电等原因,物联网设备可进行休眠,此时物联网应用给设备的命令可缓存在平台中,等设备上线后转发给物联网设备。
———针对物联网应用,<font color='red'>平台可对应用进行注册和发布,在注册过程中平台可对物联网应用进行认证和授权,并且可通过测试来判断该应用是否可注册在物联网平台上</font>,物联网平台还可将物联网应用发布到物联网应用注册及发现管理平台上供更多的消费者选择,在发布需求中,物联网平台应和物联网应用发现平台交互,将物联网应用建立索引和目录供消费者选择。
———针对物联网设备<font color='red'>,物联网平台应具有设备注册和设备管理的需求</font>,针对不同的物联网应用可实现群组管理。当物联网设备或者网关第一次接入物联网平台时应执行设备注册过程,将设备/网关和物联网应用绑定并在物联网平台上形成映射关系,使物联网应用可管理到这些设备,也可使这些设备产生的数据传递给物联网应用,物联网平台还可根据物联网应用的需求对这些物联网设备/网关进行设备管理,可<font color='red'>进行远程管理、设备升级、故障修复等工作。</font>

# 5 具有资源开放性的物联网架构

在物联网总体架构基础上,为满足具有资源开放性的物联网能力要求,增加了物联网资源开放的功能模块和相关接口。具有资源开放性的物联网架构见图1。

![image-20210726145906355](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726145906355.png)

在具有资源开放性的物联网架构中,<font color='red'>物联网支撑平台向物联网应用提供应用接口</font>,物联网支撑平台的功能应遵循YD/T2398的要求。

物联网应用的开发者使用该应用接口将其开发的<font color='red'>物联网应用注册、发布</font>在物联网支撑平台上，物联网支撑平台应为物联网应用提供资源,为物联网应用提供相应的支撑管理功能,包括通过统一的资源访问接口进行<font color='red'>应用和设备注册、数据存储与转发、群组管理、应用发布、资源发现、安全隐私保护的功能,以及对多种物联网设备、网关、感知节点进行远程设备管理(如配置、升级)的适配功能</font>。

物联网支撑平台应向网络和感知延伸层提供网络/设备接口,物联网应用或者物联网支撑平台可通过该接口对物联网设备/物联网网关进行管理,提供设备管理、数据缓存、数据转发、群组管理等功能。

物联网应用请求者通过应用层的物联网应用发现平台发现物联网应用。

物联网应用可通过物联网支撑平台将物联网应用开发者创建的物联网应用注册到物联网应用发现平台,物联网应用请求者通过用户终端接入物联网应用发现平台查询物联网内物联网应用开发者所注册的物联网应用,实现开放物联网内的应用共享。

感知延伸层、物联网设备、物联网网关应提供适配接口,可适配物联网应用相关的业务能力。

物联网设备、物联网网关应支持管理能力开放,使物联网应用能够通过物联网支撑平台、物联网网关对远端的物联网端节点进行远程设备管理(如配置、升级)。

物联网设备、物联网网关应支持数据共享能力开放,物联网设备、物联网网关的适配接口应提供对设备、网关、传感器节点的数据共享的适配能力,使物联网应用能够通过物联网支撑平台、物联网网关获取到传感数据。

# 6 物联网资源开放的平台能力要求

## 6.1 概述

物联网业务层是在核心网络之上的物联网支撑平台,主要功能包括:
———物联网支撑平台作为承接核心网络和上层具体应用的中间关键实体，应具备对核心网络能力进行抽象和管理的能力，并遵循物联网系统内统一的规则以接口的形式提供给上层的物联网用户和应用调用;

———物联网支撑平台应具备对感知延伸层设备、网关以及感知节点的管理能力，采用标准的面向资源的协议和接口实现对设备和网关的性能、故障、软件和固件的更新，并能够把感知延伸层的物联网设备、网关和感知节点的相关信息以统一的资源接口方式，提供给上层的物联网应用。

物联网支撑平台根据物联网设备/网关发来的物联网应用层能力请求可路由到相应的物联网应用，同时物联网支撑平台应具备向物联网应用发现平台进行应用注册的能力。

## 6.2 设备注册

设备注册模块应包括如下能力:
———应完成对接入设备的双向认证;
———应协同适配接口其他模块的需求实现设备的注册过程。

## 6.3 设备管理

设备管理模块应包括如下能力:
———应对物联网端<font color='red'>节点/设备/网关的远程配置管理、故障管理、性能管理、软件/固件升级;</font>
———应对物联网端节点/设备/网关的远程唤醒触发及配置引导;
———应对物联网端<font color='red'>节点进行增加或删除、修改物联网端节点间连接关系以及发现、维护和描述物联网端节点所在的传感网拓扑结构</font>;
———应维护物联网端节点/设备/网关的管理对象信息与管理对象资源数据间的映射关系;
———应将各种设备<font color='red'>管理命令功能适配为统一的资源访问API提供给物联网应用;</font>
———应维护物联网支撑平台与物联网端节点/设备/网关之间的设备管理会话;
———应针对设备管理的访问权限控制。
设备管理模块的能力中所涉及的物联网端节点应是具有一定处理能力的感知节点。

## 6.4 应用注册

应用注册模块应包括如下能力:
———应用与物联网支撑平台之间双向认证能力:物联网应用可向物联网支撑平台注册,在注册过程中,应用和物联网支撑平台之间应进行双向认证,在此过程中物联网支撑平台可向应用发送安全参数;
———应用配置环境能力:物联网应用可在物联网支撑平台上配置所需环境,并将应用上传到物联网支撑平台进行测试;
———应用发布管理能力:应通过测试的物联网应用可选择发布到物联网应用发布/管理平台上或者暂时不发布。

## 6.5 应用发布

应用发布应包括如下能力:
———物联网应用发布:物联网支撑平台应向物联网应用发现平台发布物联网应用相关信息,物联网应用发现平台应根据应用发布请求建立应用资源,存储物联网应用相关信息;
———物联网应用查询:物联网支撑平台应根据物联网应用查询请求检索物联网应用资源,向物联网应用请求者返回物联网应用查询结果。

## 6.6 资源发现

针对应用接口,资源发现模块应包括如下能力:
———应从应用发布模块获得已发布应用的资源信息;
———应根据获得的已发布的资源信息形成资源发现模块的内部资源;
———应根据检索条件对资源进行检索;
———应响应应用和发现管理平台的资源查询请求。

## 6.7 数据缓存

针对应用接口,数据缓存模块应包括如下能力:
———应根据物联网应用注册时的需求保存感知延伸层报送的数据;
———应根据物联网应用及发现管理平台注册时的需求保存物联网应用的数据;
———应根据应用适配接口其他模块的需求保存相关的数据。
针对网络/设备接口,数据缓存模块应包括如下能力:
———应根据物联网应用注册时的需求保存设备管理相关的数据;
———应根据应用适配接口其他模块的需求保存相关的数据。

## 6.8 数据转发

针对应用接口，数据转发模块能确保物联网应用的用户数据(在应用与应用之间，应用与设备/网关之间)的可靠传递，应包括如下能力:
———用户数据缓存能力;
———获取物联网应用/设备/网关在线状态的能力;
———转发用户数据的能力。

## 6.9 群组管理

物联网支撑平台中的平台群组管理模块应包括如下能力:

———应根据物联网应用需求创建相关的群组资源,通过统一的资源访问接口管理一组资源数据。群组资源还可包括子群组资源，子群组资源可由物联网应用或者物联网支撑平台创建。
———应根据物联网应用需求对群组进行管理,对群组成员资源批量访问包括查询、更新和删除。
———应根据物联网应用需求对群组成员资源批量访问请求(如批量获取传感数据、控制设备等)。
———应负责避免成员资源的重复、循环访问。

## 6.10 计费管理

物联网支撑平台中的平台计费管理模块应包括如下能力:
———应根据物联网应用的计费需求,配置业务能力和网络资源的可计费事件和计费参数;
———应根据配置在可计费事件发生时,记录物联网应用使用设备管理、数据缓存、数据转发、资源发现、群组管理等功能的计费数据,记录物联网应用使用网络资源(如短信、彩信、IP)的计费数据;
———应支持在线计费和离线计费两种计费方式;
———应支持将计费数据传送给计费服务器,进行批价并生成计费账单。

# 7 物联网资源开放的应用层能力要求

应用层主要包括具体的物联网应用以及物联网应用发现平台。
物联网应用通过适配接口接入物联网支撑平台,实现与物联网支撑平台之间的应用注册、应用管理、数据获取/发送等功能。
物联网应用发现平台是物联网系统中进行物联网应用注册、发布、查询的管理实体,主要功能应包括:
———应接收物联网支撑平台的注册请求,根据注册请求中携带的物联网支撑平台的描述信息在本地创建相应的资源(即物联网支撑平台资源);
———应接收物联网支撑平台的应用注册请求,并根据物联网支撑平台所支持的应用的描述信息为该应用的描述信息创建与物联网支撑平台资源相对应的资源,并存储该描述信息用于物联网应用请求者通过用户终端接入物联网应用发现平台,通过物联网支撑平台的描述信息和物联网支撑平台所支持的物联网应用的描述信息查找/发现该物联网应用;
———应接收物联网应用请求者发送的物联网应用查询消息,物联网应用发现平台根据物联网应用请求者提供的查询条件查询本地存储的物联网应用的描述信息,将得到的与查询条件相匹配的物联网应用的描述信息及支持该物联网应用的物联网支撑平台的描述信息返回给物联网应用请求者,以便物联网应用请求者使用所查询到的物联网应用。

# 8 基本业务流程

## 8.1 设备注册

当物联网设备/物联网接入网关接入到物联网支撑平台时,应与物联网支撑平台进行双向认证,在此过程中,物联网支撑平台可给物联网设备/物联网接入网关下发安全参数,如物联网设备的密钥等信息,同时物联网支撑平台将该设备/物联网网关的信息保存在物联网支撑平台中,供应用或者其他管理模块调用。
设备注册流程见图2。

![image-20210726150211320](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150211320.png)

a 物联网接入网关/设备向设备注册模块发起注册请求,其中应包含设备资源标识、资源属性以及URI等。
b 设备注册模块对该设备进行双向认证。
c 认证成功后,应到资源发现模块查找该设备资源标识是否已经存在,如果不存在,则创建新的资源管理标识和相应的属性,并通知设备管理模块。
d 设备注册模块向设备返回注册成功的响应消息。
e 在设备侧建立所注册的支撑管理平台的资源标识。
f 向设备注册模块发送获取支撑管理平台信息(如接入点信息)的请求。
g 检验该设备是否有权获取支撑管理平台的相关资源信息,如果有,则向资源管理或设备管理模块查询相应资源信息。
h 设备注册模块向设备返回响应消息。

## 8.2 设备管理

物联网业务支撑平台应维护设备管理对象资源数据与远程物联网设备或网关中的管理对象信息的映射关系,以及资源访问请求与各种具体设备管理协议中的管理命令之间的映射关系。物联网业务支撑平台应接收物联网应用发来的针对设备管理对象资源的访问请求,根据预设的映射关系,将其适配转换为目标物联网设备或网关所支持的设备管理命令,并将所访问的管理对象资源数据适配转换为对应设备管理命令所要操作的管理对象信息,然后将适配转换后的设备管理命令下发到目标设备或网关,最后将从目标设备或网关接收到管理执行结果返回给物联网应用。
设备管理流程见图3。

![image-20210726150254611](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150254611.png)

a 物联网支撑管理平台通过其适配接口中的设备管理模块,获取物联网节点/设备/网关上的管理对象信息,并据此创建对应的管理对象资源和分配唯一访问地址 URI,同时建立所述管理对象信息和管理对象资源之间的映射关系。
b 物联网支撑平台通过其适配接口中的设备管理功能,接收物联网应用发送来的针对管理对象资源 URI的资源访问请求(如获取、更新、删除等),该访问请求中应包含请求方标识(即物联网应用标识)、访问类型、管理对象资源URI,物联网支撑平台首先获取该访问请求中的参数并确认其参数是合法的,然后进行业务处理。
c 物联网支撑平台通过其适配接口中的设备管理模块,根据预先设定的映射关系,将所接收的资源访问请求转换为对应的设备管理命令,同时根据a中的映射关系确定设备管理命令所要操作的位于目标设备(即物联网节点/设备/网关)上的管理对象信息。
d 物联网支撑平台通过其适配接口中的设备管理模块,与物联网节点/设备/网关建立设备管理会话(或使用已经建立的设备管理会话),将转换后的设备管理命令发送到管理对象资源 URI所对应的目标设备,从而操作和管理目标设备中对应的管理对象信息。
e 物联网支撑平台通过其适配接口中的设备管理模块,接收目标设备执行设备管理命令后的结果数据,并将其转换为资源访问响应返回给物联网应用,该响应中应包含状态报告(如成功、失败)、结果数据。

## 8.3 应用注册

应用注册服务应用层,应与物联网应用发现平台交互,根据应用注册的需求,其应与平台中的安全隐私、设备管理、群组管理、应用发布存在交互关系。应用注册流程见图4。

![image-20210726150333820](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150333820.png)

a 基本信息注册是指物联网应用向物联网支撑平台进行注册的过程。在基本信息中应包含物联网应用的身份信息、物联网应用类型以及用于获得应用收益的银行账号信息,同时在此处应包含法律条款,用来约束物联网应用的行为和保证开发者的权益。
b 应用需求发布是指物联网应用向物联网应用发现平台上发布需求信息。在该过程中,物联网应用发布需求信息,从注册/发现管理平台获得可用的信息,如果未发现合适的信息,则在注册/发现管理平台上发布一条应用需求。
c 应用环境配置过程是物联网应用对应用环境进行搭建过程。在环境搭建时,应声明需要哪些 API,针对什么类型的物联网设备。由支撑管理平台对所需的资源进行审核,在配置结果消息中返回给开发者。
d 应用上传测试是指将开发完成的应用部署在按照应用配置中完成的环境上进行测试的过程。应用测试在独立于平台的环境中部署,将完成功能、性能、安全及其针对的物联网设备特殊要求的测试,测试周期完成后,会将结果反馈给开发者和支撑管理平台。
e 物联网应用发布是指物联网应用可选择是否发布测试通过的应用。由物联网应用来掌握发布时机能够提高应用的成熟度,同时给物联网应用更多的自主选择权利。
f 应用发布是指测试完成的应用发布到应用注册/发现管理平台上的过程。在支撑管理平台上测试通过后的应用就能够发布到应用注册/发现管理平台,通过这个平台提供给设备用户,并获得相应的回报。

## 8.4 应用发布和发现

物联网应用在物联网支撑平台上注册后,可向物联网应用发现平台进行发布(通过物联网支撑平台向物联网应用注册发现/管理平台注册物联网应用),供消费者或者最终用户选择。应用发布功能实现物联网应用向物联网应用发现平台注册发布,应用发布流程见图5。

![image-20210726150412227](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150412227.png)

a 物联网支撑平台向物联网应用发现平台请求注册,该注册请求包含物联网支撑平台本身的描述信息,包括物联网支撑平台的名称、接入URI信息等标识信息。
b 物联网应用发现平台接收物联网支撑平台的注册请求,并在本地为该支撑管理平台创建资源(即物联网支撑平台资源)以存储物联网支撑平台的描述信息。
c 物联网应用发现平台向物联网支撑平台返回同意注册消息,以便物联网支撑平台接收到注册成功的响应后,向物联网应用发现平台发送物联网应用注册请求。
d 物联网支撑平台向物联网应用发现平台发送物联网应用注册请求,该注册请求携带物联网支撑平台所支持的物联网应用的描述信息,包括物联网应用的名称、物联网应用的业务类型、物联网应用的标识信息、物联网应用的提供方信息等。
e 物联网应用发现平台在本地已创建的该物联网支撑平台资源下为物联网应用创建相应的物联网应用资源以存储物联网支撑平台所支持的物联网应用的描述信息,如建立索引、创建应用目录等,以使物联网应用请求者通过用户设备接入物联网应用发现平台,根据物联网支撑平台的描述信息和物联网支撑平台所支持的物联网应用的描述信息查询和发现物联网应用。

应用发现功能实现物联网应用请求者向物联网应用发现平台注册查询和发现相应的物联网应用,应用发现流程见图6。

![image-20210726150445346](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150445346.png)

a 物联网应用请求者通过用户设备向物联网应用发现平台发送物联网应用查询消息,物联网应用查询消息携带有查询条件,包括请求查询的物联网应用的名称、物联网应用的业务类型、物联网应用服务的区域信息等。
b 物联网应用发现平台接收物联网应用查询消息,根据物联网应用查询消息提供的查询条件查询本地存储的物联网应用的描述信息,得到与查询条件相匹配的物联网应用的描述信息,包括物联网应用的名称、物联网应用的业务类型、物联网应用的标识信息、物联网应用的提供方信息等。
c 物联网应用发现平台根据查询到的物联网应用的描述信息,查询本地存储的支持物联网应用的物联网支撑平台的描述信息,得到支持所查询到的物联网应用的物联网支撑平台的描述信息,包括物联网支撑平台的名称、接入URI信息等标识信息。
d 物联网应用发现平台将得到的与查询条件相匹配的物联网应用的描述信息及支持该物联网应用的物联网支撑平台的描述信息返回给物联网应用请求者,以便物联网应用请求者使用所查询到的物联网应用。

## 8.5 资源发现

为了使海量的资源被有效利用,物联网支撑平台需要具备资源发现能力。资源发现能力需要获取网络新增资源的信息,并具备资源检索功能。
通过物联网支撑平台的资源发现能力,需求方(即物联网应用、物联网设备/网关)能够查找到需要的各种资源,从而实现资源的共享。
以物联网应用的资源发现为例,资源发现流程参见图7(将“物联网应用”换成“物联网设备/网关”,将“应用注册模块”换成“设备注册模块”即可成为物联网设备/网关的资源发现流程)。

![image-20210726150518732](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150518732.png)

a 物联网应用向应用注册模块进行注册,注册信息包括物联网应用的资源信息即物联网应用的资源标识符、物联网应用的资源描述等。
b 应用注册模块把物联网应用的资源信息向应用发布模块发布。a、b属于资源发现的前置条件。
c 应用发布模块把物联网应用的资源信息报告给资源发现模块,在资源发现模块内形成相应的资源。应用发布模块向资源发现模块报告资源信息的方式有两种:一种是应用发布模块主动上报,另一种是应用发布模块在资源发现模块的触发下被动上报。
d 物联网应用/设备/网关A向应用和发现管理平台发起资源请求。请求信息中包括被查找资源的描述。
e 物联网端应用发现平台向资源发现模块发起物联网应用/设备/网关A的资源查询请求。请求信息中包括被查找资源的描述。
f 资源发现模块根据被查找资源的描述对资源进行检索。
g 返回被请求的资源结果。


# 8.6 数据缓存

物联网支撑平台应根据物联网应用的需求保存从物联网设备传上来的数据供物联网应用或者最终用户访问。物联网支撑平台应根据物联网应用的需求将物联网应用的数据进行缓存供物联网设备/网关进行访问。
针对应用接口,数据缓存流程(应用接口)见图8。

![image-20210726150546107](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150546107.png)

a 物联网应用在向应用注册模块进行注册时,如果其应用需要对采集的数据进行缓存,则通知应用注册模块其需要进行数据缓存。
b 应用注册模块通知数据缓存模块该物联网应用需要进行数据缓存,数据缓存模块保存其需求。
c 物联网应用发现管理平台向应用注册模块进行注册时,如果需要对采集的数据进行缓存,则通知应用注册模块需要进行数据缓存。
d 应用注册模块通知数据缓存模块该物联网应用注册及发现管理平台需要进行数据缓存,数据缓存模块保存其需求。
e 当感知延伸层数据发送到数据缓存模块时,数据缓存模块进行判断,如果需要进行缓存则进行缓存,如果不需要缓存则发送给物联网应用或者管理支撑平台。

![image-20210726150611388](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150611388.png)

a 物联网应用在向应用注册模块进行注册时,如果其应用需要对一些数据(如设备管理数据等)进行缓存,则通知应用注册模块其需要进行数据缓存。
b 应用注册模块通知数据缓存模块该物联网应用需要进行数据缓存,数据缓存模块保存其需求。
c 物联网支撑平台或者设备管理模块需要对一些数据(如设备管理数据)进行缓存,则通知数据缓存模块其需要进行数据缓存。
d 当物联网应用的数据或者物联网管理支撑平台/设备管理模块发送数据到数据缓存模块时,数据缓存模块进行判断,如果需要进行缓存则进行缓存,如果不需要缓存则发送给物联网网关或者物联网设备。

## 8.7 数据转发

为实现用户数据的可靠传递,确保发送方(即物联网应用、物联网设备/网关)在接收方(即物联网应用、物联网设备/网关)离线的情况下发出的用户数据也能被接收方收到,物联网支撑平台需要具备数据转发能力。
数据转发应了解接收方的在线状态,并具备数据缓存和转发用户数据的功能。
应通过物联网支撑平台的数据转发能力传递用户数据能够减少发送方多次查询接收方接收状态的操作,降低用户数据传输失败的可能性,简化物联网应用、物联网设备/网关的设计和实现。
以物联网应用与物联网设备/网关之间的数据转发为例,应用接口数据转发模块流程参见图10[将模块中的“物联网设备/网关”换成“物联网应用”,将“设备管理模块(网络/设备接口)”换成“设备管理模块(应用接口)”即可成为从物联网应用到物联网应用的数据转发流程]。

![image-20210726150644532](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150644532.png)

a 物联网应用向数据转发模块发送用户数据[包括接收方信息(如URL)和业务数据]。
b 在物联网应用签约物联网支撑平台的数据转发能力的条件下,数据转发模块接收用户数据,并对用户数据缓存。
c 根据接收方信息(如URL),数据转发模块向设备管理模块查询物联网设备/网关的在线状态;根据获得在线状态信息判断物联网设备/接入网关是否在线。如果物联网设备/网关不在线,那么继续查询。如果物联网设备/网关在线,则进入d。
d 数据转发模块将缓存的数据发送给物联网设备/网关。

  针对网络/设备接口,数据转发模块将物联网设备或接入网关的数据转发给一组物联网设备或接入网关,网络/设备接口数据转发模块流程见图11[将模块中的“物联网应用”换成“物联网设备/网关”,将“设备管理模块(应用接口)”换成“设备管理模块(网络/设备接口)”即可成为从物联网设备/网关到物联网设备/网关的数据转发流程]。

![image-20210726150713410](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150713410.png)

a 物联网设备/网关向数据转发模块发送用户数据[包括接收方信息(如URL)和业务数据]。
b 在物联网设备/网关签约物联网支撑平台的数据转发能力的条件下,数据转发模块接收用户数据,并对用户数据缓存。
c 根据接收方信息(如URL),数据转发模块向设备管理模块查询物联网应用的在线状态;根据获得在线状态信息判断物联网应用是否在线。如果物联网应用不在线,继续查询。如果物联网应用在线,则进入d。
d 数据转发模块将缓存的业务数据发送给物联网应用。


## 8.8 群组管理

群组管理模块应根据物联网应用需求创建相关的群组资源,通过统一的资源访问接口管理一组资源数据。

群组资源还可包括子群组资源,子群组资源可由物联网应用或者物联网支撑平台创建;群组管理模块应根据物联网应用需求对群组进行管理,对群组成员资源批量访问包括查询、更新和删除;应根据物联网应用需求对群组成员资源批量访问请求(如批量获取传感数据、控制设备等)。

群组管理模块还应避免成员资源的重复、循环访问。
群组管理流程见图12。

![image-20210726150739404](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150739404.png)

注1:b、c为根据物联网应用需求创建子群组资源。
注2:d、e为根据物联网应用需求创建群组资源。
注3:g~n为平台群组管理模块分发成员资源访问请求。
a 物联网设备、网关通过位于物联网支撑平台的设备注册模块进行注册,保存设备信息和业务数据信息。
b 物联网应用可根据群组成员信息确定群组中一系列位于同一网关或者同一设备的成员资源并由此创建子群组。
这个创建请求中应包括请求方标识、群组成员信息、接收方标识。平台群组管理模块根据接收方标识将这个创建请求转发给相关的网关/设备。网关/设备的设备群组管理模块接收该访问请求,获取该访问请求中的参数并确认参数是合法的,继续进行业务处理。设备群组管理模块创建子群组资源并维护子群组资源及其成员信息。
c 设备群组管理模块返回响应结果,该响应中包括状态报告(如成功、失败)和新建子群组的标识。

d 根据物联网应用需求创建群组资源,成员可包含设备/网关中的设备管理对象资源、业务数据资源等。群组资源中还可包括子群组资源,由物联网应用或其他应用等事先创建。这个创建请求中应包括请求方标识、群组成员信息、接收方标识。设备群组管理模块接收该访问请求,获取该访问请求中的参数并确认参数是合法的,继续进行业务处理。位于物联网支撑平台的平台群组管理模块创建群组资源并维护群组资源及其成员信息,并给物联网应用返回群组标识。
e 设备群组管理模块返回响应结果,该响应中包括状态报告(如成功、失败)和新建群组的标识。
f 物联网应用发起群组成员资源批量访问请求,这个访问请求中应提供请求方标识、访问类型、群组标识信息、接收方标识。平台群组管理模块接收该访问请求,获取该访问请求中的参数并确认参数是合法的,继续进行业务处理。平台群组管理模块根据物联网应用提供的群组标识信息获取各个群组成员信息,对该群组成员批量访问(如批量获取传感数据、控制设备等)。
g 平台群组管理模块给物联网设备、网关分发多个成员资源访问请求。每个成员资源访问请求中均包括请求方标识、访问类型、群组成员信息、接收方标识,由收到访问请求的物联网设备、网关处理和返回响应。物联网设备、网关获取该访问请求中的参数并确认该访问请求中的参数是合法的,继续进行业务处理。
h 设备群组管理模块返回响应结果,该响应中包括状态码(如成功、失败)、结果数据。
i 平台群组管理模块可在接收群组成员资源批量访问请求后,根据从群组标识信息获取的群组成员信息确定群组中一系列位于同一网关或者同一设备的成员资源并由此创建子群组(参见b、c)。设备管理模块创建子群组资源并维护子群组资源及其成员信息。
j 设备群组管理模块返回响应结果,该响应中包括状态报告(如成功、失败)和子群组标识。
k 平台群组管理模块给物联网设备、网关分发子群组成员资源批量访问请求(参见f)。该访问请求中应包括请求方标识、访问类型、子群组标识、接收方标识。物联网设备、网关获取该访问请求中的参数并确认该访问请求中的参数是合法的,继续进行业务处理。子群组访问请求由收到访问请求的物联网网关、设备的设备群组管理模块分解为多个成员资源访问请求分发给成员资源。其中,子群组资源由一系列位于同一网关或者同一设备的成员资源组成,由物联网应用或者物联网支撑平台等确定和创建。此外,群组管理模块还应具有辨识重复、循环的成员资源的能力,比如根据从群组标识信息获取的群组成员信息。而且在根据该群组成员信息判断出包含子群组资源时,群组管理模块接收群组成员资源批量访问请求后还可生成请求标识,随成员资源访问请求发放给成员资源并存储下来,如果成员资源所在实体的群组管理模块判断后续收到带有相同的请求标识的成员资源访问请求就忽略收到的访问请求。
l 设备群组管理模块给物联网设备、网关分发成员资源访问请求(参见g)。
m 物联网设备、网关返回响应结果,该响应中包括状态码(如成功、失败)、结果数据(参见h)。
n 设备群组管理模块汇聚响应并返回响应结果,该响应中应包括状态报告(如成功、失败)和结果数据。
o 平台群组管理模块汇聚响应并返回响应结果,该响应中应包括状态报告(如成功、失败)和结果数据。


## 8.9 计费管理

物联网支撑平台可配置业务能力和网络资源的计费参数(如次数、时长、费率等)和可计费事件,根据这些配置来收集计费数据。物联网支撑平台负责记录和统计计费数据,收集物联网应用对设备管理、数据缓存、数据转发、资源发现、群组管理等功能的使用情况,收集物联网应用对网络资源(如短信、彩信、IP)的使用情况。物联网支撑平台将记录的计费数据传送给计费服务器,由计费服务器进行批价并生成计费账单。
物联网支撑平台中的平台计费模块可配置可计费事件,包括物联网应用访问设备管理、数据缓存、数据转发、资源发现、群组管理等业务功能模块。物联网应用使用网络资源进行通信,包括短信、彩信、分组域承载、近距离无线通信、有线通信等。
物联网支撑平台中的平台计费模块可根据运营商策略、签约信息为可计费事件配置计费参数,其中计费参数可包括物联网应用标识、业务功能标识、网络通信类型、接入网络标识、次数、时长、流量、数据存储、时间戳等,计费参数参见表1

![image-20210726150849987](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150849987.png)

计费管理流程见图13。

![image-20210726150900130](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210726150900130.png)

a 物联网支撑平台中的计费模块配置可计费事件和计费参数。
b 业务功能模块接收物联网应用对业务资源的访问请求,并将访问请求发送至计费模块处理。
c 计费模块记录和统计计费数据,计费模块根据访问请求确定发生了可计费事件时,确定并记录与访问请求相关的计费数据,计费数据可包括物联网应用标识、业务功能标识、流量等;对于在线计费,计费模块应将计费数据发送到计费服务器以便于计费服务器确认是否允许物联网应用对业务资源的访问,其中计费数据可包括业务功能标识、计费单元等;随后计费服务器返回响应,允许物联网应用的访问。
d 业务功能模块对物联网应用的访问进行处理。
e 物联网支撑平台中的业务功能模块对访问进行处理,并将访问的响应发送至计费模块处理。
f 计费模块记录确认访问成功时,应确定并记录与访问响应相关的计费数据,计费数据可包括时间戳、检索资源结果、时长、流量等。
g 计费模块将计费数据传送到计费服务器,进行批价并生成计费账单。计费模块将访问请求和访问响应相关的计费数据发送到计费服务器,计费数据中还应包括序列号、结束符等信息用于区别不同的计费数据。
h 计费服务器返回响应,说明已成功发送。