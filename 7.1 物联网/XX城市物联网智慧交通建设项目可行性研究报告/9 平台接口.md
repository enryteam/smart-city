# 9.1 集成技术

集成技术应用于智能交通管理平台各服务间，同时应用于智能交通管理平台与各子系统交互间。需要说明的是：EHL Message Server和EHL统一集成Web服务提供的远程访问技术具有平台无关性和工具无关性，应用系统无论运行在Windows、Linux等操作系统、采用.Net、Java等开发工具，均可采用该规范，实现指挥调度集成应用接入。同时，该规范具有良好的可扩展性，完全能够适应指挥调度集成业务的发展要求。

- 统一消息服务

应用系统软总线包括技术实现上的、也包括设计规范上的。应用系统设计可面向总线进行，设计者只需识别总线，根据总线的规定去设计，将各组件按照总线接口的标准与总线连接而无需单独为各组件设计连线。这就简化了系统的设计，也简化了系统的结构，使系统易于扩充和更新。统一消息服务是应用系统软总线的一个关键技术，是各组件联系的纽带，在接口技术中扮演着重要的角色。

统一消息服务为系统间交互的中间件，交互机制采用异步方式。当需要多个应用程序进行相互交互时，不要寄希望于每个应用都了解其他所用应用中的方法的签名特性。相反，应用无须了解与其进行交互的其他应用的错综复杂的服务接口。每一个参与者需要关心的仅是确保能够向消息传送系统发送和接收消息。

![image-20210817150727249](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210817150727249.png)

ATMS对子系统的集成基于消息总线结构，子系统之间通过消息总线进行通讯。消息总线是系统的连接件，负责消息的分派、传递和过滤，以及处理结果的反馈；各个子系统挂接在消息总线上,向总线发送消息，并订阅感兴趣的消息类型；统一消息服务收到消息后，负责将该消息分发到消息的订阅方（子系统）；子系统接收到消息后，根据自身状态对消息进行响应，并通过总线返回处理结果。

消息服务中间件集中管理所有消息，可以屏蔽不满足用户信息和权限要求的消息请求，并提供日志管理。

通过定义新的消息格式，系统能够进一步为今后对其他系统的集成提供简单的方法和灵活的部署。

消息通讯机制采用TCP socket。统一消息服务为tcp socket server端，接入方为tcp socket client端。消息的传递采用XML格式。

- Web Services技术

 Web Services是解决应用程序间相互通信的一项技术。它使用标准规范的XML描述接口，实现了不同平台，不同技术间的互操作，其目的在于结合各种相关服务，以提供使用者更具效率性与方便性的全面服务。Web Services是面向服务的体系结构。Web Services是基于SOAP、WSDL和UDDI的全新服务体系框架。

SOAP是基于XML的分布式对象访问协议，是Web Services消息交互的基础。一般意义上SOAP是与应用平台完全无关的协议，基于XML封装信息的机制，可用于跨平台信息交互。在Web Services中，SOAP通过XML文档传递方法参数，进行Web调用。SOAP把本地计算机的信息发送到远程计算机上，远程计算机执行远程方法，然后返回结果。对于本地用户就好像调用本地方法一样。SOAP为在一个松散的分布环境中使用XML对等地交互结构化和类型化信息提供了简单而轻量级的机制。SOAP本身并不定义任何语言，只是定义了一种简单的机制，通过模块化的包装模型和对模块种特定格式编码的数据得宠编码机制来表示应用语义。

WSDL是对Web Services进行描述的语言，是一种基于XML的语法定义，它将Web Services定义为一组服务访问点，客户端可通过这些服务访问点对包含面向文档信息或面向过程调用的服务进行访问。WSDL首先对访问的操作和访问时使用的请求响应消息进行抽象描述，然后将其绑定到具体的传输协议和消息格式上，以最终定义服务访问点。相关具体部署的服务访问点通过组合就成为抽象Web Services。

UDDI是一种用于描述、发现、集成Web Services的技术，通过UDDI用户可以灵活地发布和查找Web Services。有了SOAP和WSDL能实现Web Services完成跨软硬件平台、跨语言的集成，却不能使Web Services更广泛的共享和推广应用，其需要一个集中服务注册中心目录来注册服务，以实现广泛环境内服务的发现和服务集成。为此，W3C通过并公布了UDDI协议。UDDI在逻辑上分为两部分：商业注册和技术发现。前者用于描述用户及其提供的Web Services的一份XML文档；或者定义了一套基于SOAP注册和发现Web服务的编程接口。凡是实现UDDI规范的站点被称为UDDI操作入口站点，这些站点通过复制机制保持彼此间内容同步。因此这些站点在逻辑上被看作一个整体，被称作UDDI的商业注册中心。由于注册和查找所用的传输协议是SOAP，因此商业注册中心的适用范围可覆盖所有遵循SOAP协议的站点。

​	智能交通管理平台众多的数据访问方式就是采用webService技术实现的。如所有的应用程序对数据库的访问均通过基于webServic技术的DataService实现。除上述优点外，客户端不再需要安装oracle client，体现了系统的易维护性。

# 9.2 系统接口分类

接口是智能交通管理平台中的关键内容，涉及到各技术子系统、数据中心（位于指挥中心）及其他外部系统。通过接口，智能交通管理平台可获取其他技术子系统的信息，同时向其他技术子系统下达控制指令。

接口分为三类：统一消息接口、数据访问接口、地理信息数据接口（远程调用）。

![image-20210817150756940](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210817150756940.png)

# 9.3 接口概要说明

## 9.3.1 统一消息接口

用于对其他技术子系统进行控制与调度时使用，系统使用的消息为一种异步消息，消息的发出时间不确定，利用消息机制可保证系统高效工作，而不必为等待事件的发生而加大计算机系统开销。

- 消息结构

采用消息总线结构，子系统通过总线进行连接，不要求各子系统具有相同地址空间或局限在一台机器上，避免了维护困难的问题，确保了整个系统的工作稳定性。

各子系统通过统一的消息挂接在统一消息服务中间件上。可随时将本身状态、信息请求、控制指令、数据反馈等信息以统一消息形式提交给统一消息服务中间件，统一消息服务中间件自动根据信息的提供与消费关系决定信息的流向，从而各子系统可以及时得到自己所关心的信息。

![image-20210817150827197](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210817150827197.png)

- 消息格式

在公安交通指挥系统集成时，将定义各子系统的多种消息格式，实现对各子系统的监控功能。统一消息服务中间件集中管理所有消息，屏蔽不满足用户信息和权限要求的消息请求，并提供日志管理。通过定义新的消息格式，进一步为今后其他系统的集成提供简单的方法和灵活的部署。

信息的传递符合CORBA规范，消息体采用可扩展标记语言（XML）格式，为标准通用标记语言（SGML）的一个子集。XML是元标记语言，用户自定义所需标记，但必须根据某些通用规则创建。标记有三类意义：结构、语义和样式。结构定义元素间层次关系，语义将单个元素与外部实际事物联系起来，样式指定如何显示元素。XML描述一类称为XML文档的数据对象，同时部分地描述处理数据对象的计算机程序动作。

为实现系统集成，定义了各子系统消息传递格式，通用部分的格式如下：

```xml
<message>
    <systemtype></systemtype>
    <messagetype></messagetype>
    <messagesource></ messagesource >
    <messagetarget></messagetarget>
</message>
```

## 9.3.2 数据访问接口

系统集成时需提供三种方式的数据访问接口，第一种是采用XML描述的数据访问接口，第二种是采用SQL语句参数方式的数据接口，第三种是基于数据库连接池的数据访问接口，实际是三种不同接口的动态链接库。

本平台基于Web Service技术开发整套数据访问中间件（DataService）——通用数据接口，实现接口可扩展、高性能、高安全性。DataService数据访问中间件提供三种方式的数据访问接口，直接与三种不同的数据库服务端相连，同时与Web服务器连接，用户通过URL连接到DataService后，可直接在应用程序中使用三种数据访问接口，实现通用数据接口的要求，如下图所示。

![image-20210817150903285](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210817150903285.png)

采用Web Service技术实现数据访问接口，不但能实现基本分布式应用，还能通过Web集群达到负载均衡、提升容错能力，彻底解决应用程序服务器平台不兼容问题，防火墙阻塞的问题，开发和应用复杂问题。

## 9.3.3 地理信息数据接口

依托美国ESRI公司的Arc GIS Server的标准，因此Arc GIS Server的连接是标准的接口形式，同时各图层的命名与数据规范也是地理信息数据接口的一部分。

城市公安交通指挥系统GIS数据规范，主要包括：智能交通管理平台、五个业务体系的各技术子系统与公安交通管理地理信息平台之间，通过地理信息接口进行数据调用与同步，将公安交通指挥系统所用的地理信息数据定期从城市公安交通管理地理信息平台进行同步。

# 9.4 系统接口图

![image-20210817150935165](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210817150935165.png)

# 9.5 平台接口描述

## 9.5.1 与122接处警系统接口

122（三台合一）接处警系统接口主要包括122报警接口、122案件（事）件定位接口、122案（事）件查询接口等。

- 122报警接口

122报警接口将案件、事件报警消息上传到集成指挥平台，122报警接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过122报警接口接收案件、事件报警消息            |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 122接处警系统                                                |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 122接处警系统主动上传报警消息至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 122案（事）件定位接口

集成指挥平台通过122案（事）件定位接口向接处警系统发送报警电话定位消息，122案（事）件定位接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过122案（事）件定位接口发送报警电话定位消息。  |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 122接处警系统                                                |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传定位指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** |                                                              |

- 122案（事）件查询接口

集成指挥平台通过122案（事）件查询接口查询案（事）件详细信息，122案（事）件查询接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过122案（事）件查询接口发送报警记录查询指令，查询案（事）件详细信息。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 122接处警系统                                                |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传定位指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.2 与交通信号控制系统接口

| **编号** | **消息名称**           | **消息方向**                  | **说明** |
| -------- | ---------------------- | ----------------------------- | -------- |
| 1        | 登录或退出请求         | 交通信号控制系统→集成指挥平台 |          |
| 2        | 登录或退出请求反馈     | 集成系统→交通信号控制指挥平台 |          |
| 3        | 设备故障报警           | 交通信号控制系统→集成指挥平台 |          |
| 4        | 流量异常报警           | 交通信号控制系统→集成指挥平台 |          |
| 5        | 灯态改变通知           | 交通信号控制系统→集成指挥平台 |          |
| 6        | 设备状态改变通知       | 交通信号控制系统→集成指挥平台 |          |
| 7        | 流量数据报告           | 交通信号控制系统→集成指挥平台 |          |
| 8        | 查询消息               | 集成系统→交通信号控制指挥平台 |          |
| 9        | 信号机信息查询结果反馈 | 交通信号控制系统→集成指挥平台 |          |
| 10       | 信号状态查询结果反馈   | 交通信号控制系统→集成指挥平台 |          |
| 11       | 检测器信息查询结果反馈 | 交通信号控制系统→集成指挥平台 |          |
| 12       | 特勤方案查询结果反馈   | 交通信号控制系统→集成指挥平台 |          |
| 13       | 流量数据查询结果反馈   | 交通信号控制系统→集成指挥平台 |          |
| 14       | 错误反馈               | 交通信号控制系统→集成指挥平台 |          |
| 15       | 特勤控制命令           | 集成指挥平台→交通信号控制系统 |          |
| 16       | 特勤控制返回           | 交通信号控制系统→集成指挥平台 |          |

## 9.5.3 GPS警用车辆定位系统接口

GPS警用车辆定位系统接口主要包括GPS警用车辆定位接口、GPS警用车辆定位设备状态接口、GPS警用车辆控制接口等。

- GPS警用车辆定位接口

集成指挥平台通过GPS警用车辆定位获取警用车辆位置信息，GPS警用车辆定位接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过GPS警用车辆定位接口接收车辆定位信息。        |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | GPS警用车辆定位子系统                                        |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 系统固定周期方式调取GPS警用车辆定位接口，抽取需要的信息      |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- GPS警用车辆定位设备状态接口

集成指挥平台通过GPS警用车辆定位设备状态接口获取定位设备是否发生故障，GPS警用车辆定位设备状态接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过GPS警用车辆定位设备状态接口接收车辆定位设备状态信息。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | GPS警用车辆定位子系统                                        |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 系统固定周期方式调取GPS警用车辆定位设备状态接口，抽取需要的信息 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- GPS警用车辆控制接口

集成指挥平台通过GPS警用车辆控制接口下发警用车辆调度控制指令，GPS警用车辆控制接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过GPS警用车辆控制接口下发GPS车载终端控制指令。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | GPS警用车辆定位子系统                                        |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传控制指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.4 大屏幕投影系统接口

大屏幕投影系统接口主要包括大屏幕配置接口、大屏幕配置查询接口、大屏幕显示预案查询接口、大屏幕控制接口等。

大屏幕配置接口

集成指挥平台通过大屏幕配置接口进行大屏幕显示系统设置，大屏幕配置接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过大屏幕配置接口下发大屏幕投影系统设置指令。   |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 大屏幕投影系统                                               |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传配置指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 大屏幕配置查询接口

集成指挥平台通过大屏幕配置查询接口查询大屏幕投影系统的配置信息，大屏幕配置查询接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过大屏幕配置查询接口查询大屏幕投影系统的系统配置。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 大屏幕投影系统                                               |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传查询指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 大屏幕显示预案查询接口

集成指挥平台通过大屏幕显示预案查询接口查询大屏幕显示提供的显示预案，大屏幕显示预案查询接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过大屏幕显示预案查询接口查询大屏幕投影系统的显示预案。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 大屏幕投影系统                                               |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传查询指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 大屏幕控制接口

集成指挥平台通过大屏幕控制接口进行大屏幕投影仪的控制，大屏幕控制接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过大屏幕控制接口下发大屏幕投影系统控制指令。   |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 大屏幕投影系统                                               |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传控制指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.5 移动警务系统接口

移动警务系统接口主要包括移动警务设备设施接口、移动警务报送接口、移动警务查询接口、移动警务轨迹接口、移动警务终端设备状态接口等。

- 移动警务设备设置接口

集成指挥平台通过移动警务设备设置接口进行移动警务终端设置，移动警务设备设置接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过移动警务设备设置接口下发移动警务终端设备设置指令。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 移动警务系统                                                 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传设置指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 移动警务报送接口

移动警务终端通过移动警务报送接口进行案件和事件报警，移动警务报送接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 移动警务终端通过移动警务报送接口上传案（事）件信息、事故处理信息、现场执法信息、移动路况采集信息 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 移动警务系统                                                 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 移动警务系统主动上传报送指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 移动警务查询接口

移动警务终端通过移动警务查询接口查询车驾管信息和违法行为等信息，移动警务查询接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 移动警务终端通过移动警务查询接口查询机动车、驾驶人、违法行为、黑名单、常住人口、公安关注信息 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 移动警务系统                                                 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 移动警务系统主动上传查询指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 移动警务轨迹接口

移动警务终端通过移动警务轨迹接口上报轨迹信息，移动警务轨迹接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 移动警务终端通过移动警务轨迹接口上传移动警务终端设备的轨迹   |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 移动警务系统                                                 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 系统固定周期方式调取动警务终端设备轨迹接口，抽取需要的信息。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 移动警务终端设备状态接口

移动警务终端通过移动警务终端设备状态接口报送设备是否发生故障，移动警务终端设备状态接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 移动警务终端通过移动警务终端设备状态接口上传移动警务终端设备的状态 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 移动警务系统                                                 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 系统固定周期方式调取动警务终端设备状态接口，抽取需要的信息。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.6 交通电视监视系统接口

交通电视监视系统接口主要包括交通电视监视设备状态接口、交通电视监视设备控制接口等。

- 交通电视监视设备状态接口

集成指挥平台通过交通电视监视设备状态接口接受摄像机设备是否发生故障，交通电视监视设备状态接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过交通电视监视设备状态接口接收摄像机状态信息。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 交通电视监视系统                                             |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 系统固定周期方式调取交通电视监视设备状态接口，抽取需要的信息 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 交通电视监视设备控制接口

集成指挥平台通过交通电视监视设备控制接口进行摄像机镜头、光圈、云台及雨刷等的控制，交通电视监视设备控制接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 集成指挥平台通过交通电视监视设备控制接口下发摄像机控制指令。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 交通电视监视系统                                             |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台主动上传控制指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.7 交通流信息采集接口

- 流量采集接口接口

交通流信息采集系统通过交通流信息采集接口上传交通流数据，交通流信息采集接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 交通流信息采集系统通过交通流信息采集接口向路况监控系统发送交通流数据。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 交通流信息采集系统路况监控系统                               |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 路况监控系统按固定周期方式调取交通流信息接口，抽取需要的信息 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 路况监控接口

交通路况人工观测系统通过路况监控接口上传交通路况数据，路况监控接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 交通路况人工观测系统通过路况监控接口向路况监控系统发送交通路况数据。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 路况监控系统                                                 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 路况监控系统按固定周期方式调取路况监控接口，抽取需要的信息   |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 路况判态接口

交通流信息采集系统通过路况判态接口上传交通流信息作为路况判态基础，路况判态接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 交通流信息采集系统通过路况判态接口向路况监控系统发送交通流数据。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 交通流信息采集系统路况监控系统                               |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 路况监控系统按固定周期方式调取路况监控接口，抽取需要的信息   |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.8 信息研判系统接口

- 违法报警接口

信息研判系统通过违法报警接口提供违法行为和嫌疑车辆信息，违法报警接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 信息研判系统通过违法报警接口向交通缉查防控报警体系提供违法行为和嫌疑车辆信息。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 信息研判系统缉查布控系统                                     |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 信息研判系统主动上传信号数据指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.9 缉查布控系统接口

缉查布控系统进行违法行为监测和处理、机动车缉查布控和分析，与集成指挥平台、交通态势监控体系、交通信号控制体系进行数据交换，实现功能集成。系统提供专用接口，集成第三方系统的前端治安卡口提供的车辆数据信息、图片和录像，通过接口定时保存到系统数据库的中间表中和文件服务器中。

缉查布控系统提供专用数据接口，集成商第三方系统的前端治安卡口提供的车辆数据信息，通过接口定时保存到系统数据库的中间表中，最后通过数据同步软件实现到正式表的同步。

- 布控设置接口

缉查布控系统通过布控设置接口提供布控车辆和黑名单信息，布控设置接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 缉查布控系统通过布控设置接口向路况监控系统提供布控车辆和黑名单车辆信息。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 缉查布控系统路况监控系统                                     |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 缉查布控系统主动上传信号数据指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 道路状况报送接口

违法行为监测记录系统，包括公路车辆监测记录、雷达超速监测记录、违法监测记录（电子警察）等，通过消息服务器上传观测到的区域治安情况，道路状况报送接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口名称** | 道路状况报送接口                                             |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 违法行为监测记录系统                                         |
| **实现方式** | 基于数据库同步表                                             |
| **触发机制** | 违法行为监测记录系统主动上传执勤情况至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |

- 卡口通行车辆接口

智能卡口系统通过卡口通行车辆接口上传车辆通行数据给机动车缉查布控系统和机动车查控分析系统，卡口通行车辆接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口名称** | 卡口通行车辆接口                                             |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 智能卡口系统、缉查布控系统、查控分析系统                     |
| **实现方式** | 基于数据库同步表                                             |
| **触发机制** | 智能卡口系统主动上传车辆通行数据至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |

- 卡口流量接口

智能卡口系统通过卡口流量接口将通过治安卡口的交通流量数据上传给机动车缉查布控系统和机动车查控分析系统，卡口流量接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口名称** | 卡口流量接口                                                 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 智能卡口系统、缉查布控系统、查控分析系统                     |
| **实现方式** | 基于数据库同步表                                             |
| **触发机制** | 智能卡口系统主动上传流量数据至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |

- 卡口报警接口

智能卡口系统通过卡口报警接口上传治安卡口的报警信号给机动车缉查布控系统和机动车查控分析系统，卡口报警接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口名称** | 卡口报警接口                                                 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 智能卡口系统、缉查布控系统、查控分析系统                     |
| **实现方式** | 基于数据库同步表                                             |
| **触发机制** | 智能卡口系统主动上传报警数据至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |

- 卡口设备状态接口表

智能卡口系统通过卡口设备状态接口将治安卡口前端记录设备状态数据传送给机动车缉查布控系统和机动车查控分析系统，卡口设备状态接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口名称** | 卡口设备状态接口                                             |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 智能卡口系统、缉查布控系统、查控分析系统                     |
| **实现方式** | 基于数据库同步表                                             |
| **触发机制** | 智能卡口系统主动上传治安卡口前端记录设备状态数据至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |

- 车辆布控记录接口表

机动车缉查布控系统和机动车查控分析系统通过车辆布控记录接口将布控数据下发给智能卡口系统前端记录设备，卡口布控记录接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口名称** | 车辆布控记录接口                                             |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 智能卡口系统、缉查布控系统、查控分析系统                     |
| **实现方式** | 基于数据库同步表                                             |
| **触发机制** | 系统自顶向下将布控数据下发至车辆布控记录接口表，智能卡口系统前端记录设备主动轮巡接口表，取走布控数据，同时删除接口表中数据。 |

## 9.5.10 设备管理系统接口

- 设备设施状态接口

交通设备设施管理系统通过设备设施状态接口提供设备故障状态信息，设备设施状态接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 交通设备设施管理系统通过设备设施状态接口向路况监控系统提供路况监控设备状态信息。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 交通设备设施管理系统路况监控系统                             |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 交通设备设施管理系统主动上传信号数据指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.11 勤务管理系统接口

- 勤务管理信息接口

勤务管理系统通过警力配置信息接口为集成指挥平台提供权限管理基础数据，为各警员分配权限。警力配置信息接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 勤务管理系统为集成指挥平台的权限管理提供基础数据。权限管理根据警力配置中的“机构管理”基础数据，为各警员分配权限。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 勤务管理系统                                                 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 系统按固定周期方式调取警力配置信息接口，抽取需要的信息       |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

- 警务考核接口

警务考核系统通过警务考核接口从集成指挥平台、交通态势监控体系、交通缉查防控体系、交通信号控制体系、交通信息服务体系获取警务考核的基础数据。警务考核接口相关系统、实现方式、触发机制、接口功能和数据要求如下表所示。

| **接口概述** | 警务考核系统通过警务考核接口接收集成指挥平台及其他业务体系的警务考核数据。 |
| ------------ | ------------------------------------------------------------ |
| **相关系统** | 警务考核系统集成指挥平台交通态势监控体系交通缉查防控体系交通信号控制体系交通信息服务体系 |
| **实现方式** | XML封装消息传输                                              |
| **触发机制** | 集成指挥平台及各业务体系主动下发控制指令至接口表，由专门数据同步软件同步接口表中数据至正式表，同时删除接口表中数据。 |
| **接口功能** | 请求连接、建立连接、发送XML消息包、接收XML消息包、容错校验、断开连接、自动续连 |

## 9.5.12 与6合一系统接口

- 接口类型：查询类接口

接口标识：01C21

功能说明：根据输入号牌种类HPZL和号牌号码HPHM信息查询机动车全项信息VEHICLE表数据。

处理过程：①接口输入参数通过数据的逻辑校验；②通过统一软件提供的接口查询相关的机动车业务信息。

- 读取机动车业务信息

接口类型：查询类接口

接口标识：01C22

功能说明：根据输入流水号LSH信息查询机动车业务信息表VEHICLE_TEMP的相关信息。

处理过程：①接口输入参数通过数据的逻辑校验；②通过统一软件提供的接口查询相关的机动车业务数据。

- 获取机动车下一检验有效期止

接口类型：查询类接口

接口标识：01C25

功能说明：根据输入当前有效期止日期YXQZ、车辆类型CLLX、使用性质SYXZ以及初次登记日期CCDJRQ来获取机动车下一有效期止日期。

- 查询驾驶人基本信息

接口类型：查询类接口

接口标识：02C06

功能说明：获取驾驶人的基本信息

传入参数：身份证明号码。

- 查询驾驶人业务流水信息

接口类型：查询类接口

接口标识：02C15

功能说明：查询驾驶人业务流水信息

传入参数：流水号

- 读取违法信息接口

接口类型：查询类接口

接口标识：04C01

功能说明：提供给警务通等实时查询违法信息，查询已处罚的违法信息。

处理过程：1、根据传入的条件，接口判断四个查询条件是否为空，不为空时查询条件是and的关系；2、从违法业务记录表和违法业务记录历史表中查询数据，只返回前500条记录；3、查询违法业务表（VIO_VIOLATION）和违法业务历史表(VIO_VIOLATION_HIS)。

- 读取电子监控文本信息接口

接口类型：查询类接口

接口标识：04C03

功能说明：提供给警务通等实时查询机动车的非现场违法信息。

处理过程：1、根据传入的条件，接口判断四个查询条件是否为空，不为空时查询条件是and的关系；2、从电子监控记录表和电子监控记录历史表中查询数据，只返回前500条记录。3、查询电子监控记录表（VIO_SURVEIL）和电子监控历史表(VIO_SURVEIL _HIS)。

- 读取电子监控照片信息接口

接口标识：04C04

功能说明：提供给警务通等实时查询机动车的电子监控记录的照片信息。

处理过程：1、从电子监控记录照片表（vio_jdczp）中查询照片信息，以base64的编码格式返回;2、只返回一条记录。

- 读取刑事案件事故信息

接口类型：查询类接口

接口标识：03C01

功能说明：读取交通肇事刑事案件事故基本信息和认定信息，供公安警务综合平台使用。

- 读取套牌/假牌机动车信息

接口类型：查询类接口

接口标识：05C01

功能说明：根据号牌种类、号牌号码、布控范围（本地发证机关）、获取正在协查中套牌/假牌机动车信息

# 9.6 PGIS接口描述

## 9.6.1 接口需求

警用地理信息基础应用平台是以公安信息网络为基础，以警用电子地图为核心，以地理信息技术为支撑，以服务于公安业务管理、信息共享和决策支持的可视化为目标的重要信息化基础设施。在PGIS平台上构建的各类应用统称为PGIS应用。PGIS系统（即PGIS平台+PGIS应用）是地理信息技术与公安信息系统相结合的产物，是公安信息化的高端应用，可以有效地拉动公安信息整合、信息共享、提升公安信息化应用水平。

在坚持统一指挥、统一规划、统一标准、强行推动、稳步实施、重在实效的指导原则，在公安部统一规范、统一标准和统一领导下，以需求为导向，开展警用地理信息平台建设，是适应治安动态化、社会信息化、国家法制化的需要，是掌握社情，建立维稳基础、维护安全预防打击犯罪、服务社会实现全面发展、强化公安队伍谋求科学发展的需要，是提高公安机关“四个能力”建设的全局性、基础性项目。

## 9.6.2 接口边界

![image-20210817152148809](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210817152148809.png)

需要其他系统为地理信息系统提供服务如下：

| 相关系统名称       | 提供给地理信息系统边界                                       |
| ------------------ | ------------------------------------------------------------ |
| PGIS平台接口服务   | • 栅格地图服务• 数据访问更新服务• 专题图服务• 实时信息主动分发服务• 地址匹配服务• 业务地理关联服务• 警用地理信息采集服务• 警用综合地理信息查询服务• 资源目录与元数据服务• 统一权限服务 |
| ARCGIS平台接口服务 | • 基于MO\AO二次开发SDK                                       |

- 地理信息系统为其它业务系统提供功能列表如下：

| 相关系统名称 | 提供给地理信息系统边界                                       |
| ------------ | ------------------------------------------------------------ |
| GPS系统      | • 将各种需要安装有GPS装备的重点车辆、巡逻车等的实时定位信息，通过无线网络传递到后台并接入到地理信息系统中，地理信息系统需要解析各种无线传输数据协议获取定位坐标，通过实时信息通信服务分发到GIS系统。• 对于已建的GPS系统，本系统通过TCP协议直接和GPS服务器进行通信，即时获取GPS车辆位置信息，并在地图上显示。 |
| 勤务管理系统 | • 在地图上提供执勤岗位绘制功能；• 提供执勤岗位定位功能• 提供执勤路线绘制功能• 提供执勤区域绘制功能• 提供执勤人员位置信息 |
| 设备管理系统 | • 提供设备标注功能；• 提供设备位置定位功能；• 提供设备显示功能；• 提供设备状态显示功能 |
| 指挥调度系统 | • 提供案事件定位功能；• 提供案事件空间分布显示功能；• 提供案事件空间分析功能；• 提供案事件区域位置信息； |
| 特勤任务系统 | • 提供特勤路线绘制功能；• 提供特勤路线显示功能；• 提供特勤人员、岗位等信息显示；• 提供特勤执勤岗位显示功能；• 提供执勤车队定位功能；• 提供执勤车队与路线空间位置关联； |
| 路况监控系统 | • 提供路况状态地图上三色显示；• 提供路况态势绘制功能；• 提供道路状态修改功能； |
| 电子沙盘系统 | • 提供地图图形绘制功能；• 提供地图区域选择功能；• 提供地图投影变化功能；• 提供地图比例尺获取功能； |

## 9.6.3 接口设计

地理信息系统提供访问的接口，根据不同的业务系统访问内容，提供各种访问接口

| 接口名称         | 接口说明                                                     | 接口方向       |
| ---------------- | ------------------------------------------------------------ | -------------- |
| 地图显示接口     | • 提供矢量地图和栅格地图叠加显示功能；• 提供切片地图分级显示功能；• 提供地图按比例尺无级缩放显示功能；• 提供不同专题地图显示功能； | • 系统对外提供 |
| 地图编辑接口     | • 提供信息点数据编辑；• 提供线数据编辑功能；• 提供面数据编辑数据；• 提供属性数据编辑接口； | • 系统对外提供 |
| 地图配置接口     | • 提供地图图层显示比例配置接口；• 提供地图符号化配置接口；• 提供地图标注配置接口；• 提供地图数据源信息配置访问接口； | • 系统对外提供 |
| 地图空间分析接口 | • 提供缓冲区分析接口；• 提供叠加分析接口；• 提供可视性透视分析接口；• 提供距离计算接口； | • 系统对外提供 |
| 地图空间查询接口 | • 提供矩形查询接口；• 提供多边形查询接口；• 提供圆形查询接口；• 提供属性查询接口；• 提供关联查询接口； | • 系统对外提供 |
| 地图操作接口     | • 提供地图缩放操作接口；• 提供地图区域范围设定操作；• 提供地图测量接口； | • 系统对外提供 |
| 地图互操作接口   | • 提供空间元素居中显示接口；• 提供地图图形绘制操作；• 提供地图上特定元素闪烁显示功能；• 提供地图上元素选定功能； | • 系统对外提供 |

## 9.6.4 接口框架

交警支队目前使用的交通管理业务ATMS平台，按照现有PGIS提供的不同的接口方式（Javascript访问API、COM组件、WebService访问API等），封装出业务使用GIS组件（地图界面访问组件、数据访问组件、专题图切换组件、地图查询访问组件等），为交通管理业务提供基础应用框架，以Web应用、C/S客户端应用和WMS服务三种方式对外提供应用界面。

![image-20210817152320972](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210817152320972.png)

各部分说明：

- 数据层

PGIS:包括警用地理信息数据库，分为基础地理信息数据库（道路、水系、建筑物等）、警用公共地理数据库（交通场所、娱乐场所、加油站等）、警用业务信息数据库（人口、案事件等）；

ArcGIS:包括交警自己管理的交通地图空间数据库，包括带拓扑关系的路网数据；

- 服务层

实现面向不同业务系统提供多种业务共享和服务，包括向PGIS其它警种提供交通流等相关数据。

- 应用层

通过使用PGIS提供地图数据接口和ArcGIS提供的二次开发接口，共同为地理信息系统提供支持。

交通地理信息系统,采用本地化管理交通相关地理空间数据和PGIS提供资源共享数据相结合的方式共同为交通服务,通过实现与PGIS无缝隙对接,充分利用PGIS上广阔的共享资源为交警服务,同时交通相关资源亦可以通过PGIS接口上传到PGIS平台上,以达到资源共享的目的。

## 9.6.5 接口定义

### 9.6.5.1 二次开发地图服务

| **服务名称**             | **使用服务实现的功能**                                       | **提供接口形式**            |
| ------------------------ | ------------------------------------------------------------ | --------------------------- |
| 栅格地图服务             | 1、 地图显示2、 地图基本操作（缩放、平移、鹰眼、全图显示、测量、鹰眼等）3、 地图动态元素（点、线、面）绘制4、 地图互动操作（闪烁、居中） | JavaScript、COM组件         |
| 数据访问更新服务         | 1、 地图图层数据（点、线、面）增加、删除、修改等操作；2、 图层数据空间查询操作；3、 空间过滤查询；4、 属性过滤查询 | HTTP请求 + XML              |
| 专题图服务               | 五、统计专题图显示（饼图、柱状图、散点图、点密度专题图、分级专题图等）； | HTTP请求 + XML或者JSON格式  |
| 实时信息主动分发服务     | 1、实现GPS定位系统数据主动上传到数据中心                     | TCP协议                     |
| 地址匹配服务             | 1、实现通过地址匹配地名功能                                  | Javascript接口HTTP请求+ XML |
| 业务地理关联服务         | 1、查询出公安五要素（人、事、物、地、组织）                  | Javascript接口HTTP请求+ XML |
| 警用地理信息采集服务     | ①　建立地理信息采集任务，并查看任务中包含的所需采集图层。②　针对特定的图层，可以按照一定的权限设定，实现对于某一具体图元的增加、删除、修改的操作 | JavaScript 接口 HTTP 协议   |
| 警用综合地理信息查询服务 | 1、 提供查询界面；2、 给出定制查询接口                       | HTTP协议+XML/JSON格式       |
| 资源目录与元数据服务     | 1. 实现空间查询方法（矩形查询、圆形查询、多边形查询）2. 实现ID属性查询3. 实现元数据增加、删除、修改接口 | HTTP协议+XML                |
| 统一权限服务             | 1）与公安部提供PKI体系对接2）实现身份验证方法3）提供用户角色获取方法 | Java接口和COM组件接口       |

### 9.6.5.2 工具集

| **工具名称**     | **使用工具实现的功能**                                       | **提供形式**             |
| ---------------- | ------------------------------------------------------------ | ------------------------ |
| 数据采集工具     | 1）现有交通设备设施信息点标注2）警力机构位置标注3）道路编码采集 | 提供安装包或者发布组件包 |
| PGIS 库管理工具  | 1、 增加交通管理相关的图层；2、 增加图层相关的属性字段       | 提供安装包或者发布组件包 |
| 栅格地图切图工具 | 1、对道路编码后重新切图                                      | 提供安装包或者发布组件包 |