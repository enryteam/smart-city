- [高精地图（二），自动驾驶的“天眼”](https://mp.weixin.qq.com/s/b7zkovj4YbSfY5MYL7jYzg)

## 1 高精地图采集资质

调研下来，发现高精地图圈遵循的还真不是帅气多金就可以为所欲为的社会法则。在这里，崇尚的是一纸文凭，即使你衣衫褴褛、食不果腹，但只要你拿出“院士”的聘任文书，你就依然是科技界、商界、政界大佬们的座上宾。而对于高精地图圈来说，这一纸文凭就是导航电子地图甲级资质。

国家地理信息关乎国防安全，涉及国家秘密，因此在中国从事高精地图测绘活动就需要获取导航电子地图甲级资质。而甲级资质在人员规模、仪器设备、保密管理、作业标准等考核指标方面都有比较高的门槛。以人员规模举例，需要满足具备100人及以上（含注册测绘师5人，其中高级10人，中级20人）测绘及相关专业技术人员的条件。

而大多数传统主机厂和初创地图企业难以满足上述要求，即使满足了也只是具备了人和，你还要静待天时和地利。从2001年四维图新获得第一张甲级资质，到2021年的这20年时间里，9600万平方公里嗷嗷待高精测绘的土地上仅诞生了28家获得高精地图甲级测绘资质的企业。而这28家中除去事业单位、传统图商，所剩科技型初创企业寥寥无几，这与国外高精地图采集产业的繁荣、高速发展形成鲜明对比。

通过多方打听，汇总了国内具有高精地图甲级测绘资质的企业信息如下表，而我所能做的就是找一家情投意合的商谈后续采集的工作。

![image-20220210094631647](https://gitee.com/er-huomeng/l-img/raw/master/l-img/image-20220210094631647.png)

## 2 高精地图数据格式

高精地图目前最主流的通用格式规范有OpenDRIVE和NDS。

### 2.1 OpenDRIVE

OpenX系列标准是ASAM（Association for Standardization of Automation andMeasuring  Systems，自动化及测量系统标准协会）为完整描述一个仿真测试场景而制定，包括OpenDRIVE、OpenCRG和OpenSCENARIO三个标准。其中OpenDRIVE主要用于描述仿真测试场景的静态部分（道路几何形状、道路拓扑结构、交通标识等）；OpenCRG主要用于描述仿真测试场景的表面细节（道路坑洼等）；OpenSCENARIO主要用于描述仿真测试场景的动态部分（人、车等移动障碍物的行为等）。

OpenDRIVE是德国制定的国际通用的高精地图规范，使用XML格式文件来描述路结构，自动驾驶系统可通过读取XML文件构造路网，座舱域可通过进一步渲染后通过显示屏展示给用户。OpenDRIVE目前最新版本为2021年8月发布的V1.7，除了完善仿真场景的需求，还丰富了自动驾驶对高精地图的额外需求。国内玩OpenDRIVE最溜的非百度Apollo莫属，不仅消化吸收，还基于自己的需求做了部分改动和扩展，已经在国内有了专属代号Apollo OpenDRIVE。

OpenDRIVE通过道路参考线（Reference Line）,车道（Lanes）、车道段（Section）、物体（Objects）、交通标志（Road Signals）、标高（Elevation）、交叉口（Junction）等元素来描述道路结构。

![image-20220210094644893](https://gitee.com/er-huomeng/l-img/raw/master/l-img/image-20220210094644893.png)

**（1）道路参考线。**每条道路必须定义且只定义一条道路参考线，道路参考线可以定义到道路中心，也可以有侧向偏移。道路参考线只反映道路在水平投影面的走向，不包括坡度、起伏等特征。为保证在蜿蜒曲折的道路中参考线没有断口，道路参考线可由直线、螺旋线、三次多项式参数方程等几何形状组合。道路参考线的ID通常定义为0。

**（2）车道。**每条道路可设置多条车道。车道的属性包括宽度、类型（行车道、超车道、停车道、自行车道等）、材质（通过摩擦系数表征）、限速级别、路权（不同时间段可通行车辆类别信息）等。车道通过ID区分，道路参考线坐标系s轴正方向左侧，ID依次递增，右侧依次递减。当道路参考线ID定义为0时，左侧车道ID依次为1、2、3、……，右侧车道ID依次为-1、-2、-3、……。

**（3）车道段**。根据车道数变化（增多或减少）、车道虚实线变化，栅栏有无等的原则，将道路切分成一段段，且按照升序来定义，如上图的段A/B/C。

**（4）物体。**通过拓展、定界以及补充道路走向从而对道路产生影响的项，最常见的例子包括停车位、人行横道、交通护栏、限高和隧道等。

**（5）道路标志。**用来控制和规范道路交通所设的路标，包括交通信号灯、各类交通标牌等。

**（6）标高。**包括纵向坡度（沿行驶方向的高低起伏）、横向坡度（转弯处内外侧坡度有明显差异）。

**（7）交叉口**。当有三条及以上道路相交、无法清楚描述道路的连接关系时，通过在交叉口中增加虚拟路，来连接可通行方向。路口由三个部分组成：来路（Incoming Road）、去路（Outgoing Road）和连接路（Connecting  Road）组成。来路为进入路口的道路，可以有不止一条；去路为离开路口的道路，可以有不止一条；来路可同时作为去路,连接路作为来路和去路之间连接。如下图所示，一条来路可以对应多条连接路，而每条连接路都只连接一条来路和一条去路，这样就明确了路口处道路的连接关系。

![image-20220210094703840](https://gitee.com/er-huomeng/l-img/raw/master/l-img/image-20220210094703840.png)

**（8）坐标系。**在OpenDRIVE里定义了三种坐标系，来描述道路元素之间的相对关系。包括惯性x/y/z坐标系（Inertial System），参考线s/t/h坐标系（Reference Line System）和局部u/v/z轴坐标系（Local System）。

![image-20220210094713546](https://gitee.com/er-huomeng/l-img/raw/master/l-img/image-20220210094713546.png)

对局部坐标系位置和方位的确定将相对于参考线坐标系来进行。对参考线坐标系位置与方向的确定则相对于惯性坐标系来开展,如下图展示的各坐标系关系。

![image-20220210094725694](https://gitee.com/er-huomeng/l-img/raw/master/l-img/image-20220210094725694.png)

惯性坐标系遵照右手法则，在绘图平面内，x指向右方，y指向上方，z垂直指向平面外。

参考线坐标系同样同样遵照右手法则。s方向跟随着参考线的切线方向，t方向与s方向成正交,h由右手法则确定。参考线总是位于由惯性坐标系定义的x/y平面里。

局部坐标系同样遵照右手法则。u 向前与s保持匹配，v 向左与t保持匹配 ，z按照右手法则确定。

### 2.2 NDS

NDS（NavigationData  Standard，导航数据标准）是由汽车制造商（宝马、大众、戴姆勒等）、系统集成商、地图提供商、服务提供商等联合开发的一套地图数据全球标准。NDS采用了数据库技术存储地图数据，在兼顾性能和功能的基础上，可以比较好地解决地图增量更新、数据安全、数据可靠的问题。

早先基于嵌入式操作系统开发，不具备数据库环境，因此几乎所有的电子地图存储都采用了文件存储方式，而文件存储中使用大量了地址偏移，计数等。地图的增量更新将引起一系列增删操作，文件的结构难以维护。因此基于数据库技术可以完美解决增量更新的问题。

一份地图数据可以称为一个NDS数据库（NDS  Database），这个数据库是按照NDS标准设计的，只要按照这个标准去制作的地图数据，都是可以兼容的。一个数据库包含不同的产品数据库（Product  Database），这些产品数据库可以是不同图商制作的地图，并且可以进行独立的版本控制和版本更新。而每一个产品数据库还可以被进一步划分成多个更新区域(Update Region)。

如果江苏高精地图是一个数据库，那么苏州市就是是一个产品数据库，工业园区、独墅湖区、相城区等就是一个更新区域。

![image-20220210094735416](https://gitee.com/er-huomeng/l-img/raw/master/l-img/image-20220210094735416.png)

NDS.Live是NDS协会推出的新一代地图数据标准，NDS.Live在2019年开发之初就将关注点放在高度自动驾驶、功能安全性和地图数据无缝分发上。它在NDS的基础上，优化了地图数据的划分结构，以Modules（单元模块）,Service Registries （可配置服务）和Smart  Layers（智能图层）的形式进行组合。这种高度模块化的体系可以实现地图数据在汽车、边缘网络（5G），以及云之间进行跨场景使用及扩展，以便数据高效快速地共享、更新和合成，保证了快速的数据流，同时减少了数据对网络的压力。与此同时，NDS.Live将关注点放在服务接口（service  interface）的标准上，不限制数据储存形式和地点，数据可以来自不同的供应商。NDS.Live扩大了NDS地图数据格式的范围，以更好地支持在线e-horizon服务和动态地图管理，从而为NDS开发人员和汽车厂商提供一个真正的分布式地图体验。因此，自NDS.Live首次提出以来便受到了汽车行业的广泛关注。

另外，NDS.Live不再由一个个数据库组成，而是作为地图分发系统而存在，可以运行于车机端、移动设备端、云端、甚至ECU实时数据端。NDS.Live的发布和部署可以更好的满足车载导航从离线到在线的转变，使得更丰富、有效的动态信息可以实时地从云端发布至车机，有效地解决了地图数据量增长的问题，同样也为ADAS，嵌入式导航和自动驾驶等应用场景的多种需要的应用提供了强有力的支持。

## 3 高精地图制作流程

目前各家图商高精地图的制作流程基本类似，主要包含采集、处理、验证及发布四个过程。

### 3.1 采集

采集是通过装有专业设备的专业采集车（专业采集）及普通设备的私家车（众包采集）在道路上一厘米一厘米的采集完成。目前对于采集设备，主要有两种流派，一种是以激光雷达点云为主的土豪派，一种是以相机视觉为主的技术派。

土豪派重金雇佣的激光雷达以测距精度高而闻名，正好也契合高精度地图的高精度要求，再辅以组合导航、相机等几名3D球员，完成时间同步、运动补偿的团队磨合训练后，就可以派到战场上厮杀了。土豪派虽然也用到相机，但主要用来在处理过程弥补激光雷达点云稀疏的缺点，非采集的主力传感器。此方法主要成本较高，非大富大贵不可驾驭。

技术派采雇佣的相机以信息丰富，物美价廉而闻名，但是本身不输出深度信息，需要辅以各种2D转3D的算法来实现20cm内的高精度要求，对后期处理能力要求很高。此方法适合智商高、家境一般的同学。

### 3.2 处理

对于土豪派来说，得到的是激光雷达输出的点云数据。首先需要将每帧点云数据拼接起来，从而建立整个场景的点云地图，整个过程也称为点云注册。目前实现点云注册的主要有Autoware提供的NDT  mapping及各种离线SLAM方案。下一步就是在拼接好的点云地图基础上，标注出车道线信息、交通标志信息、红绿灯信息等，得出道路的结构化信息。这一过程可辅以相机的图像数据，提高标注准确率。

对于技术派来说，是时候展示祖传手艺的时候了。什么AI深度学习、图像识别、三维视觉等技术，直接往采集数据上招呼。提取、归类感兴趣数据，完成2D转3D的模型，从而最终完成线识别、特征点提取、构建车道的网络拓扑以及制作各种地物（人行横道、标线、交通标志）等。

处理是目前高精地图制作中最费时间精力的，面对的海量点云、图像数据，如果仅靠人工，带动的标注岗位将是喜人的。目前各家均在提高自动化标注的能力、准确率。

### 3.3 保存验证

将处理完的高精地图数据按照客户要求的数据规范保存为固定的格式，并交由专业的技术团队进行质量检查。

### 3.4 发布

验证无误的地图，还不能对外发布，需要按照规定程序送至国家测绘局审核并取得审图号后，方可进行公开出版、展示、登载和销售。