- [基于三维GIS技术的公路交通数字孪生系统](http://www.ztmapinfo.com/blog/index.php/article/20.html)

交通运输系统是四个现代化建设的重要保障，在“一带一路”倡议规划背景下，互联网+、智慧交通提升到国家新战略。智慧交通的基石是建立可映射物理世界的虚拟世界，因此大多数交通管理平台项目通过抽象建模构造二维电子地图，并在抽象模型上集成数据及分析工具，实现运营期信息化管理。随着设计、施工、运营全生命周期细化管理日益增长的需求，传统的交通地理信息(Geographic Informa-tion System-Transportation,GIS-T)系统的压力也随之增加。

交通基础设施数字化映射为三维GIS信息世界的技术方案是突破二维GIS-T系统局限的有效途径，其已成为交通信息化研究的热点课题，目前研究主要集中于建模、数据库协同、可视化分析。

（1）在建模方面，通过三维GIS平台场景中集成建筑信息模型(Building Information Modeling,  BIM)软件创建的地物模型达到宏观和微观的信息表达是最直观的思路。实践发现，交通以线状工程为主，其结构复杂性远低于建筑工程，照搬建筑业BIM不可复用的手工建模方式具有高人力投人的特点，缺乏项目各生命周期出现的模型、选线变更高效应对手段。点云、倾斜摄影等基于机载激光雷达的标准数据(LIDAR Standard,  LAS)雷达和图形学的建模方法十分先进但只适用于运营期，且模型单体化处理技术尚不成熟，难以将场景准确地划分为单体化模型对象集成的相应孪生数据。

（2）在部署及数据协同方面，目前以WEB为中心的浏览器/服务器模式(Brower/Server,  B/S)部署方案已较为成熟可行，开发者可将创造的资源和服务在云端进行托管，前端通过表述性状态传递(Representational State  Transfer, REST)风格的应用程序接口(Application Programming Inter-face,  API)进行调用，将内容服务于用户。现有研究集中于如何通过语义网组织多源数据，以及如何在满足需求的同时尽可能统一模型数据结构，以便模型与数据库能够协同应用。由于刚刚起步，语义编码采取拼音简写的原始方式，存在歧义的同时，编码包含的语义单薄且语义间关系未表达。

（3）在可视化分析方面，由于只重视三维几何模型，不重视物理、运行、规则建模，且虚拟模型配套的标识解析编码原始，使得三维GIS功能停留在外观展示，制约了数据集成、三维灾害仿真、地理查询等实用服务的开发。

基于公路交通系统特性和以上分析，笔者通过提出的五维模型，将基础设施虚拟模型建设问题标准化为数据孪生问题，着重阐述了针对不同生命周期三维几何模型对应的GIS  +BIM的建模方案，并展示了实施效果，针对孪生数据与数据实时交互等应用准则。

结合建模方法提出一套标识编码方案，继而在物理、规则模型建模及数据库协同，体现其应用价值。最后，以数据融合的视角探讨了交通数据孪生系统的应用并以实例进行了说明。

## 1 交通基础设施几何模型建模流程

### 1.1 公路交通几何模型建模方案分析

数字孪生(digital  twin)是以数字化方式创建物理实体的虚拟模型，在交通运输行业，将道路平纵横设计绘制为计算机辅助设计(Computer Aided  De-sign,  CAD)图纸，将路网GIS矢量要素映射组织为电子地图都属于初级的数字孪生范畴。GIS数据结构的丰富使得三维映射物理世界成为可能，即可利用点、线、面、不规则三角网(Triangulated IrregularNetwork, TIN)、栅格、多面体、网络公用数据格式(Network Common data Form,  NCF)等数据结构将交通构筑物映射到数字地球，这一映射方式即为建模过程。在该过程中，关键技术为几何建模数据的获取与处理、三维几何建模技术、虚拟模型的数据组织和管理。

几何建模数据指客观反映现实的地物测量及设计数据，是建模的基础。因此，需首要解决建模数据来源问题，下表汇总分析了目前可作为建模数据的文件来源。道路设计图纸与卫星遥感数据应用广泛，属于既有数据，因此获取难度较小，地面遥感数据需要无人机搭载激光雷达专门采集，数据获取的成本大。

另外，需考虑其数据存在的生命周期，如需将设计方案进行数据孪生继而进行评审，则只能使用设计图纸作为建模数据。

综上所述，应选择道路设计图纸及卫星遥感数据作为三维几何建模数据来源，地面遥感数据作为运营期监控的主要数据源。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20200319144133966.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

三维几何模型作为连接虚拟模型与物理实体的门户，是数字孪生实现的基础。三维几何建模手段主要分为手工建模和规则建模，其中:手工建模指人利用Revit等BIM软件将CAD图纸翻模为三维模型并转化为三维GIS技术支持的数据格式，最后根据测量信息匹配至数字地球的某一坐标，完成共享;规则建模又被称为自动化批量建模，目前具有代表性的软件为臻图的ZTMAPGIS,旨在将地物的几何、纹理等信息利用计算机集成规则(Computer Genera-ted Architecture,  CGA)语言进行描述，二次开发的CGA建模代码加载到交通地物抽象模型上即可完成批量化的三维模型建模。

由于交通基础设施属于线状工程，其特点为规模大但连续重复且几何规律性强，同时线路方案变更可轻松利用抽象模型及代码形参输入实现虚拟模型变更，因此CGA极为适用于交通工程几何建模。

### 1.2 三维几何模型建模流程

#### 1.2.1 建模数据处理

 基于以上分析，提出如下图所示建模流程，建模数据处理是指从设计图纸资料和遥感影像提取以下4种信息:
（1）地面地形测量数据，通过CAD图纸中的等高线图层进行提取。
（2）卫星高程，与(1)融合用于创建场景数字高程模型(Digital Elevation Model, DEM) 。
（3）道路平纵横信息来源于CAD设计文件，用于抽象线路模型建立，及辅助修正DEM 。
（4）纹理材质，采集水泥、沥青路面照片，用于ZTMAPGIS中的CGA建模贴图。
 ![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144216803.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

#### 1.2.2 建模地形及抽象模型生成

DEM的数据来源于地面地形测量及卫星遥感扫描，其中地形测量数据通常集成于道路平面设计图中的等高线图层(等高线间的疏密程度直观地表征地形精确程度)。

在公路选线设计阶段，一般需要基础的地面测量高程作为基础进行前期选线评估等工作，此类测量数据需要工程测量团队进行实地勘测，勘测具体按照中华人民共和国国家标准:工程测量规范执行。

而其测量成果一般包含勘测的地形地物图纸数据以及部分精准的全球定位高程控制点数据，通过对能够形成携带高程信息的等高线CAD图纸图纸进行数字化处理，沿等高线进行等距采样即可为GIS系统输出创建TIN所需的地形点文件。

影响测量精准度的因素主要为人员、环境、仪器。通过一定的控制方法，如严格按照规范养护与校准仪器、严控放样的精度等，可降低或避免测量误差(一般可以将高程误差控制在厘米级)。

在实际工程中，虽然能够将误差控制到足够小，但由于条件限制，难以保证对地形进行连续测量，继而引发采样点形成非凸集合，同时TIN构造地形原理为将测量点利用不规则三角网连接起来从而逼近地形曲面，非凸集性质势必造成错误赋值。

下图所示为高程数据是否凸集化处理所形成的DEM效果比对，由下图可知，在地形点非凸边界，三角网也会连接，生成错误地形。

因此，解决该问题的关键即为保证采样点为凸集。
 ![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144236317.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)
对高程精度要求不高的区域可使用遥感高程补齐以解决非凸现象，遥感高程通过等级机制来划分其对应的精度，目前分级从最低Level-0(精度为134. 75 km)到最高Level-18(精度为8. 22  m)共19个等级。其划分的依据为每个像素元对应正方形区域的宽度，对同一地理区域的描述中，若遥感高程等级越高，对应像素元的边长越小，区域内所容纳的像素点元数目越多，对地形高层的描述也更准确。

因此，调用18级的遥感高程即可达到对目标区域高层信息最逼近真实的描述，将其与地面地形测量数据进行嵌套即可解决地面地形测量数据不连续的问题。遥感高程数据提供了tif图像格式的原生支持，此类文件通过GIS中“contour算法”可还原出与人工测量地形类似的等高线CAD图纸。

本文在设计好容差后，利用地面测量高程与卫星遥感高程进行曲面合并，合并前后的地形效果如上图所示，其原理为利用精确的地面测量地形对卫星高程进行赋值(凸集)，既满足精度又满足凸集。

抽象模型是规则建模的基础，如何精确地在三维空间展示线路的平纵横信息是提高建模精度的关键技术。

令人遗憾的是，此问题常被人忽视，只注意线路平曲线，利用平曲线表面插值到地形(DEM)以获得线路纵断面信息。如此必然存在两个问题:
1）DEM是由TIN算法得出，TIN本身属于一种逼近方法，其高程的误差会传递至纵断面;
2）在建造期，挖填方一定会对地形做出改变，如果不存在线路与地形联动编辑，则势必出现“地形突兀”现象。

因此通过Civildd3D二次设计将二维的线路设计图纸生成三维的抽象模型，具体步骤如下:

步骤1通过绘制工具将平曲线要素还原为Civil3D路线对象。

步骤2将设计文件中的纵断面要素，通过桩号匹配至线路对象，完成纵断面设计。

步骤3通过横断面装配，完成建模参考地形(DEM)的精确校正。

在完成二次设计后，使用放样工具将之导出为点集与GIS通信(如下图)，并在GIS中使用数据管理工具生成标准的矢量抽象模型。

连续地物(桥隧路中心线)五米放样后在GIS中生成线要素，离散地物(如桥墩)按其坐标直接转化为点要素。

特别地，挡土墙虽然属于连续地物，但其贴合于地形，在线性抽象模型上建模不如点的贴合效果好。

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144259410.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

#### 1.2.3 规则建模

国家在《建筑信息模型设计交付标准》中提出最小模型单元(Level of Details,  LOD)和信息穿深等级用于规范工程各生命周期的虚拟模型精细化程度。

在设计期要求体现达到如道路、桥梁等功能层面模型，体现其大体轮廓和孪生规划层面的数据;在运营期要求达到如桩基等构件层面的模型，体现其局部几何尺寸，孪生更加丰富的数据。结合上文分析，模型所达到的精细程度取决于建模数据，遵从建模数据条件设计的建模方案才具有可行性。

设计期具备的道路中心线的平纵横信息、原始地形及经横断面修正的设计地形，其建模诉求为快速地将抽象矢量模型转化为三维几何模型。

独立CGA建模方案可比喻为一个“曲线积分”过程，用CGA语言几何、纹理函数描述横断面构造，该横断面构造即为“被积函数”，沿中心线路径积分即可完成快速建模。

同时，桥、道、隧具有完全不同的横断面，且无法由代码形参输入改变，因此函数为一分段函数。

本文首先按下图一分别设计CGA对象，再通过抽象模型与参考地形的高程差判断其应该继承哪个对象(需考虑误差)，继而使用由CGA函数描述横断面的“被积函数”完成建模。

此代码可自适应地结合参考地形，对道路、梁桥、隧道进行批量自动建模，形成展示方案。

下图二所示为某山区高速公路的互通式立交建模，在地形的作用下，抽象模型会自适应的生成道路、梁桥;同时，孪生于抽象模型的道路宽度可作为CGA的形参输入，通过改变数据即可完成快速的动态建模，如下图二中通过对闸道宽度方案建模比对，右图明显需要挖方才能实施(即1.2.2节所述地形突兀现象)。

独立CGA建模数据依赖小，在拥有高精度地形时，可结合多光谱遥感判读的线路矢量数据，继而完成大规模批量建模。

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144336452.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

图一

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144423137.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

图二

但独立CGA建模方案存在以下问题:

1）CGA几何创造函数能力有限，难免在塔柱、悬索等复杂结构建模上存在不足;

2）在工程运营期，模型变为由分项构件装配成整体工程，继而在分项构件上细化孪生其现实信息，而独立CGA模型依赖道路中心线去继承各种对象完成建模，无论再怎么继承也是一个横断面对象，从原理上无法满足LOD 3.0构件级交付标准。

因此，本文提出装配式CGA建模方案，其思路源于工程预制，现实工程都可由设施基本结构分类，预制件构筑工程，虚拟模型也可参照现实，预制模型簇构筑虚拟模型。该思路成为规则建模方案基本思路之一。

首先将现实地物分解为以构件为叶结点的树状结构，依此结构将现实物理实体按构件的拓扑关系转化为抽象模型，编写CGA代码构筑“装配体”，以装配体的外框控制构件大小，再使用达索的SolidWorks对预制构件建模并形成通用3D文件，最后使用i函数将“装配体”替代为模型即可，如下图所示。

构件依分属划入不同GIS图层，在保证最终模型为独立单体对象的同时，满足依图层批量化操作条件。

装配型CGA代码只需依据点线面抽象模型，实现xyz轴赋值、旋转、平移及目标模型调用路径和染色，共计11项形参设计即可。

其技术难点在于如何创造一种通用映射方法将构件的装配空间拓扑映射为抽象模型。

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144512523.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

## 2 标识解析体系及孪生数据

### 2.1 交通基础设施分类树

依据上述分析，实现LOD3精度的建模方案往往着眼于某一对象，根据个人认识对对象进行拓扑分解并建模，缺乏统一标准。与此同时，虚拟模型必须考虑其孪生数据存储及应用中的数据交换，如桥梁可简单分为桥面和桥墩，将配筋情况数据孪生至桥墩时，如果墩柱和承台的配筋间距不一致，设计数据库就出现了困难。

若要一并解决分解方案及数孪生问题，自然先要解决交通基础设施分类问题。
经过多年发展，交通工程学作为一个知识领域，其目录中包含成熟的知识本体，本体的概念和关系即可作为基础设施分类依据。

本文拟以交通工程中最复杂的斜拉桥阐述分类过程。

一条公路工程由桥道隧组成，斜拉桥作为桥梁的一种，由其上下部、桥塔等具体实现某一功能的单元组成(如下部结构实现将桥梁荷载传递至地基);实现功能依赖于各个单系统分工协作(如桥墩传递上部结构荷载至基础，基础最终将荷载传递至地基)，而单系统由不可再分的构件组成。

斜拉桥分解如下图所示，树状结构足以容纳常见构件，足以满足拓扑分解，且为后续工作打下基础。

 ![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144538800.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

###  2.2 标识解析编码

随着几何模型的建立，初级数字虚拟世界的“骨架”被搭建起来，但来自物理实体孪生数据只需集成至其映射模型即可的思路无法解决数据的多源异构性问题。

举例来说，针对某段桥面这一物理实体，同时包含静态混凝土抗冻等级和动态交通量信息，其数据存储的逻辑模型显然异构，将每小时的交通量设计为一个字段与混凝土抗冻等级存储在一张表内无疑为一种黑色幽默;同时实践表明，关系型数据库设计要求至少满足三范式，即将同一物理实体的不同类信息分别进行存储，如果没有行之有效的主键设计，一对多的存储必然引发“信息孤岛”。

目前，标识解析被认为是唯一有希望解决“信息孤岛”的技术。首先标识解析编码的概念应从两方面理解，标识指构造某种符号区分实体，解析指构造的符号应该具有规律和语义，易于被人或机器识别。落实到本系统即提出一种机器码编撰方案，为所有模型单元构造“身份证”，其主要内涵为:

1）为实体ZTMAPGIS要素固有的属性数据表提供主键;

2）提供有效途径，以便将异构数据源的数据连接至虚拟模型;

3）具有一定的含义，可进行一定的简单筛选查询。

如下图所示为设计4个区来编撰机器码如下图所示，以类型区、桩号区、公路编号区、构件编号区编撰方式展开叙述，为论述方便，标识解析码简称机器码。

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144558284.png)

（1）类型区
交通基础设施分类树体现了各项基础设施构件的本体关系。由上图（2.2上方）可知，利用类似huffman树的结构规律，可以将任何斜拉桥分解为具体构件，构件模型位于“叶结点”，从根节点到叶结点的分类路径即可作为其类型编码依据。对于整个公路而言，拟设计六位数字进行编码，如“223013”代表桥梁一拱式桥一上部结构一主梁一箱梁，其中，0表示在此分类层面无分支。此类编码方式可对106种构件进行编码，容量可满足需求，再加两位起始结束(B、E)字符用于标识第一区域。这样做是因为纯字分类编码会与桩号编码区的里程位置混淆，引发查询错误。如需要查询路段上所有照明灯的集合，可使用LIKE " 601”进行模糊查询，但若桩号区有K010601字段，则位于10 km 601  m处的构件单位将被全部查询出来。若加上起始和结束字符，则可将查询范围限定在类型区，避免查询错误。
（2）桩号区
里程桩号作为特定道路段精准定位手段，在前文二次设计时产生，基于已有道路平、纵、横设计文件对路线对象进行GIS图层绘制，并将线路离散化为以中心线为基准的等距采样点集数据，进而添加桩号字段并批量赋值，所有构件对应的里程桩号也随之确定，在机器码中添加桩号即可快速的对某路段某模型进行追踪。
（3）公路编号区与构件编号区
 由于里程桩号来源于线路设计，是一个局部变量，在多条线路组成的系统中会出现重复，因此添加公路编号区用于保证唯一性(如G15X)。

同时，构件的桩号继承于对应的线路中心线，而在一个横断面中存在交通设施对称建造的情况，因此最后设计两位构件编号确保机器码唯一性。

本文通过在构件地物的抽象模型(点、线、面)上加载建模规则，完成三维几何模型创建，现实构件、抽象模型、实体三维模型是一一对应的，随着场景的精细化大型化，构件对象数目几何增长，必须从规律入手，编写程序自动为虚拟模型填充机器码。

思路如下:将某一图层(如某段线路的桥面)的模型应有的机器码字段拆分为4部分，如G15公路120里程段起点的沥青混凝土桥面所对应的机器码为" B235121EK012001G15X01”拆分为分类码:“B235121E”;桩号码:"  K012001";公路编号码:“G15X”;构件编号码:"  01"。

此图层的模型均为G15公路内沥青混凝土桥面，因此分类码、公路码量固定为B235121E、G15X，若路段中心线离散化点集采样距离为5m(由前文放样方案确定)，其临后的桥面的桩号码为“K012006"，以此桩号递增5 m直至讫点，最后将4个字符串合并，并循环赋值到对应机器码字段即可完成自动填充。

## 3 交通基础设施孪生数据分析

孪生数据(Digital Data, DD)是数字孪生的驱动，文献做出了物理实体(Physical  Entity,PE)数据、虚拟实体(Virtual Entity, VE)数据、服务数据(Service,  Ss)数据、知识数据及融合衍生数据的基础分类，在公路交通数字孪生系统落实为:

（1）PE地位相同，PE数据是数字孪生驱动的基础，来自于公路交通基础设施中的全要素物理实体，主要包括:实体属性、实时运行状态、运行性能及环境4方面数据。全要素物理实体首先包括反映基础设施实体材料、参照国家标准、设计性能等静态结构属性数据。

（2）VE数据为VE包含的数据，VE是多维度、多空间尺度对PE进行刻画和描述的模型，落实到本文即为通过GIS、 CGA、  Solidworks等软件根据PE建立的抽象实体模型。VE数据分为几何数据(几何尺寸、装配关系、位置)和通过机器码关联数据库的属性数据(材料属性、载荷、配筋、工法)。

（3）服务数据(Ss)是对数字孪生应用中所需各类数据、算法及仿真结果等进行服务化封装，Ss数据包括算法、模型、处理方法等数据。以实现某区域积水仿真服务为例进行阐述，此对象的PE为现实中某一区域，以涉及的VE数据为依据创建此区域的高程地形及该区域路面积水监测设备的位置、读数。Ss数据指V8算法处理地形后分析得出的水文仿真、仿真结果结合地面积水监测设备读数进行赋值的程序及最终展示的栅格数据，其鲜明特征可在VE数据上加工得出，区别于狭义的结构化数据，是更加广义的数据、文件。

本文从数据关联的角度提出4条原则，保证虚拟模型与孪生数据之间的联系，具体如下:

（1）依据上文分析，机器码已完成VE中海量物理实体的唯一标识，继而通过机器码匹配至虚拟模型即可完成数据的孪生(如上方图示展示了桥梁下部结构的数据库设计)。因此，提出第一条设计原则:所虚拟模型以机器码作为主键，在开发专题数据库时，调用此主键进行连接以获得相应数据。

（2）本研究的实体具有GIS特色，在第一章建模过程中，每一个三维实体模型单元都基于抽象量模型生成，即抽象和实体模型是物理实体不同维度的映射(上图示虚拟模型);另外，GIS的很多空间分析工具以矢量为输入进行分析(3D缓冲分析、邻近汇总分析)，生成VE数据，放弃矢量抽象模型等于阉割分析功能，因此提出第二条设计原则:针对同一物理实体所有维度映射的模型应作为一整体，共享机器码。

（3）PE数据还需反映现实的运行状况(应力传感器)、实时交通量(环形线圈传感器、闸机读数)等具有动态性的数据，因此提出第三条设计原则:对于具有动态性的PE数据，应遵从其传感器进行数据库设计，再通过存储过程及机器码匹配至虚拟模型完成数字孪生。

（4）对于PE中具有地理信息特征的数据，可利用GIS的要素进行存储。只要拥有规划七线、实时风速分别等专业矢量地图(上图数据层中矢量地图)，则可以利用GIS矢量相交工具轻松完成目标模型的关联，如在虚拟模型的属性中添加空间参考信息，将极大地增加数据维护难度。因此，提出第四条设计原则:使用绘制专业矢量图层的方式存储具有空间性质的环境、规划信息。

通过以上手段可实现交通基础设施的数据集成和初步描述性可视化分析，在此基础上借助数据融合技术，将PE数据融合为VE数据、知识数据，最终实现解释性和探索性分析。

## 4 数据融合与系统验证

### 4.1 数据融合

开发应用服务于用户是数字孪生现实意义，对孪生数据进行不同层面的融合是实现应用的重要手段。为应对不同层面的数据融合，VE模型也进步被细分为几何模型、物理模型、行为模型和规则模型。根据数据融合在交通运输领域的应用历史，笔者认为本系统最终目的是在交通基础设施几何模型上，利用不同层面的数据融合算法(表征层、决策层)计算其孪生数据，得到反应其物理和运行规则的仿真结果。在这个过程中，交通数字孪生系统中的几何、物理、规则模型可映射为数据层、表征层、决策层如下图所示，其中物理模型指在几何模型的基础上增加了PE的物理属性、约束及特征等信息，规则模型可基于物理模型得出属性及特征(如路网中车辆空间分布模式特征栅格)，通过规则的学习和演化(如CNN学习栅格图像的特征)，使VE具有实时评估、优化和预测的能力，对PE进行控制和运行指导，最终供用户进行精准管理与决策。因此，本文所指的几何模型、物理模型、规则模型具有鲜明的层次性，前者依次为后者的基础。

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144631710.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

前文所叙述的几何建模、标识解析过程旨在建立虚实间的桥梁及数据孪生问题，因此数据层包含虚拟几何模型与孪生数据。数据层的算法主要围绕如何使数据精准一致，保证映射质量，主要解决的问题及方法为:

1）配准问题，浮动车技术、卫星遥感影像、设计图纸等数据分别存在定位误差、卫星姿态、投影等误差源。差分GPS可解决由于GPS的内定向元素引发的定位误差，如果车辆GPS轨迹可知，还可使用Kalman滤波进行位置估计;三次卷积(cubic convolution)融合前文建立DEM对遥感影像进行正射校正，同时还可根据控制点(GroundControl Point,  GCP)对线路设计图纸进行校正。

2)估计问题，在现实中存在一些较难获取的数据，可使用算法根据其规律做出可信的估计。如使用去芳香Kalman滤波估计任意无监控节点的交通流信息，亦如使用Kriging插值法对钻孔数据进行扩充，以获得更优良地质断层判断依据，服务于道路选线。

3)测量问题，基于虚拟几何模型的高精度快速测量是实现车联网自动驾驶的突破点，若能解决定位与建模的精度及信号传输速度问题，系统可只根据车辆位置点计算出其与道路各边界间最远距离，控制其行进方向，在夜间货车司机疲劳驾驶时进行有效应急控制，同时虚拟模型较物理实体的限界更加灵活。如无物理分隔的双向车道，车载自动驾驶设备必须基于图形学才能保证车辆在正确的车道行驶，若能绘制一条虚拟限界，该问题就能迎刃而解。

通过对数据层进行统计、分类、插值和聚类，产生能够反映各种物理量空间分布规律的特征栅格或矢量称为表征层融合，得到一种特征图层需要多种空间分析工具融合多种数据层的孪生数据和抽象模型，使用modelbuilder对融合的流程进行工作流建模利于脚本开发和服务打包发布。表征层数据融合需实现:

1）基于各类传感器数据绘制专业矢量图层，继而可利用专业图层对虚拟模型进行关联分析，达到交通运输系统状态感知、监测;

2)对数据层空间数据进行模式分析，得到如拥堵冷热点迁移、事故核密度等时空模式特征，继而解决交通流的区域控制的边界问题。

通过二次开发的工作流，数据层的基础孪生数据被融合为反映空间物理特征的表征层信息，管理人员便可依表征图像做出决策。随着融合因素需要综合考虑的特征图像的维数增加，决策过程的复杂度也随之增加。问题的本质为“表征图像+规则=决策方案”，若存在可信的“表征图像”和“决策方案”，即可转化为机器学习问题，以机器学习出专家判断规则做出自动决策。

最后，得到其物理及运行特征的过程中所涉及的几何模型、孪生数据和算法的集合即为物理及规则模型，这种集合最终可以用restful的API描述其业务逻辑，在数据层资源托管至服务器后，利用API接口即可以开发WEB应用，最终为各类客户端提供服务。

### 4.2 系统验证

系统生命周期内客观存在基于不同部署方式IT架构确认、方案(Standard Operation
Procedure,SOP)的可行性验证、二次开发工作。系统验证报告有助于在开发、维护、扩展上帮助使用者了解系统，促进信息交流，最终提升计算机系统全生命周期管理水平。目前GAMP5(Good automation manufactory practice  5th)是计算机化系统验证通用指南，从系统软件分级开展各层次验证方案论述，分级方案如下表所示。

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144658761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144709989.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)



GAMP1类别的软件属于IT基础架构，是系统验证的先决条件，应主要确认服务器(本文包括ZTMAPGIS for  Server、Portal、数据库托管服务器)的部署方式。

常见的部署方式为云端部署(SaaS)、本地部署(On-premises  model)及混合部署，云端部署具有集群部署及使用组织免于维护硬件的特点，在经济性和可靠性上优于本地部署，若对数据保密性有特殊要求，也可使用混合部署方式将 ZTMAPGIS  forServer部署至本地。

另外，为保证开发的应用正确运行，需要验证各软件的版本类型(如基本版和先进版可调用的API不一样)和GIS服务器提供的API版本，如在GIS向Javascript提供的API接口3. 6版本和4. 11版本变更中，切片地图服务图层的re-quire函数由原来的esri/layers/ZTMAPGISDynamic-MapServiceLayer变更为esri/Layers/TileLayer，若调用不当，应用程序无法工作。

GAMP3类别的软件主要用于开发GIS资源专业软件，是影响建模方案可行性、质量的重要因素，应从软件可输出文件格式和行数限制重点对其功能进行验证。

举例来说，CityEngine理论上支持3ds、fbx、obj等三维模型文件，创造三维素材的GAMP3类软件需首先判断其是否具有直接或间接的具备CityEngine支持文件格式的输出能力与输出模型完整度，在此基础上对软件展开功能测试得出验证结论，3ds Max、Skecth  Up虽具备直接输出ads的能力，但Solidworks具备更丰富的接口，通过与其他工程软件的文件直读也能达到相应目的，同时其参数化与复杂工程结构设计能力更强，且前者输出的模型材质保留完整程度、模型三角节点丢失率等指标不如后者，因此选用更为可靠的Solidworks作为3D模型资源开发的专业工具。

与此同时，文件的行数限制也需重点验证，上文第一张图所示工作流中标注了经测试可行的数据传输文件格式，如生成满足精度要求的DEM需百万级数据，但xls、 xslx无法满足，应选择平面文件类型(txt、csv)进行传输。

GAMP4/5类软件为在前两类软件基础上进行二次开发的软件，其验证手段应面向开发人员进行“白盒测试”，具体包括:

1）对CityEngine工作环境中的CGA代码、调用模型路径进行检查;

2）验证平台源代码API调用版本，审查代码内部逻辑;

3）面向需求，验证是否基于控件开发可行性，若涉及复杂的地理处理任务，使用modelbulider(隶属于ZTMAPGIS )对应用工作流脚本进行搭建、发布托管等测试;

4）审核坐标系，在WEB发布的资源一般使用WGS84椭球体作为参照，国内设计院偏好使用克拉索夫斯基椭球体作为参照(北京54坐标)，若不进行投影转换，会产生影响服务的误差。同时，可利用第三方底图服务对虚拟模型进行精度验证，下图所示为桥梁虚拟模型与天地图底图的匹配情况，模型无偏移的匹配到正确的地理位置。

![上海臻图信息-三维GIS](https://img-blog.csdnimg.cn/20200319144735741.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3p0bWFwMjAyMA==,size_16,color_FFFFFF,t_70)

## 5 应用

交通数字孪生系统可作为实现智慧交通、智慧城市的有效技术手段，交通运输系统在其全生命周期内实施数字孪生工程，可极大地提高规划、设计、施工、运营、安全方面管理水平，实现交通管理决策协同化和智能化，确保交通系统安全高效的运行，如上图所示。

（1）物理世界采集现实中车载、气象、应力等传感器数据与虚拟模型孪生，利用数据层、表征层融合，达到对交通运行状态的充分感知、动态监测和可视化仿真。如通过反重力插值(Inverse Distance Weighted,  IDW)根据监测点风速数据估计目标区域内风速情况，又如利用河面浮标位置实时的对水体进行仿真建模，得出实时的桥下净空和水体轮廓，继而促进通航、及防汛工作。

（2）虚实交互在规划期和设计期，工程并不存在于物理空间，难以做出对周边环境(视线、光照)、工程量、灾害仿真、视觉驾驶疲劳等应用分析，而通过虚拟空间，这一问题得到极大解决。而在运营期，通过物理世界功能实现的感知矢量结果，还可快速关联出受到某种影响的交通对象，做出应急决策;随着虚拟空间的精度和数据传输速度的提高，虚拟测量工具可应用于无人驾驶技术。因此，虚实交互将定义智能交通发展新模式。

（3）灾害监控及安全辅助决策服务通过交通数字孪生系统可有效对泥石流、城市内涝等自然灾害进行仿真模拟，得出其影响范围，继而提高安全管理与应急保障水平。如针对城市内涝，在拥有某城市的DEM时，可根据V8算法计算出区域内的流向、继而得出区域内在一定降雨量下地面流量情况，结合某点地面积水实时监测数据，即可得出区域的实时积水特征矢量(工作流脚本如上图所示)，通过该特征矢量关联出未受损的运输网络，继而在道路通行能力受损情况下，使用VRP方法提供可行的路径规划。