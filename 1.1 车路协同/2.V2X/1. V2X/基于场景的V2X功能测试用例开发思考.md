- [基于场景的V2X功能测试用例开发思考](https://polelink.blog.csdn.net/article/details/119239114)

在[《大话中国C-V2X通信标准应用层标准》](https://blog.csdn.net/weixin_51954443/article/details/115397947?ops_request_misc=%7B%22request%5Fid%22%3A%22162761141616780269858252%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&request_id=162761141616780269858252&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-1-115397947.pc_v2_rank_blog_default&utm_term=大话&spm=1018.2226.3001.4450)一文中，我们向大家介绍了CSAE在国内推行的C-V2X应用层标准。随着国内C-V2X标准的推动，一些量产车型也即将搭载V2X功能上市，V2X功能测试也成为了汽车电子测试中很重要的一个环节。

相较于传统的汽车ECU依赖总线仿真的测试，OBU的V2X测试加入了对测试场景的仿真。因此，如何构建一个完善的覆盖度高的测试用例，成为了测试的关键。

本文将以思维导图的形式对场景进行分析，以表格的形式将测试用例呈现，共同探讨在场景中的V2X功能测试用例开发。

------

# 一、测试环境构成分析

首先我们对OBU的通信环境进行分析：

  ![img](https://img-blog.csdnimg.cn/20210730101558448.png)     图1. 车用通信系统架构示意图   



由图1我们不难发现，实现车辆V2X功能的通信对象主要有四种，分别是

> 1.定位系统天线，用于接收GNSS信息，确定自车的定位
>
> 2.无线电通信子系统，用于向他车发送自车的相关状态
>
> 3.车内总线，向应用电子控制单元推送车辆内部的相关信息
>
> 4.人机交互界面，应用电子控制单元在对数据进行逻辑处理后向人机交互界面推送V2X信息，起到向驾驶员推动消息，发出报警的作用。依据数据流向，我们可以将V2X功能测试拆分为自车向外发送状态消息及自车接收消息对驾驶员进行消息推送及预计两部分，如图2所示：



  ![img](https://img-blog.csdnimg.cn/20210730101800596.png)     图2.1车辆发送射频消息通信构架示意图   



  ![img](https://img-blog.csdnimg.cn/20210730101852255.png)     2.2车辆接收射频消息通信构架示意图   



综合图2.1、图2.2我们可以发现，在车辆发送射频消息通信构架示意图中，定位系统与车内总线是输入端、无线电通信子系统天线是数据输出端，车辆接收射频消息通信构架示意图中，定位系统天线、无线电通信子系统天线、车内总线、是数据输入端，人机交互界面是数据输出端，由此可以构建数据流向图，如图3：

  ![img](https://img-blog.csdnimg.cn/20210730103446880.png)     3.1车辆发送射频消息通信数据流向示意图   



  ![img](https://img-blog.csdnimg.cn/20210730103512839.png)     3.2车辆接收射频消息通信数据流向示意图   



定位系统天线及无线通信子系统天线接收的消息与交通场景强相关。因此，本文主要对车辆接收射频消息通信数据应用场景进行讨论。

依据通信网络的来源属性，我们可以将V2X功能模块的传入数据分为车内数据和车外数据。

- 车内数据可分为车辆的状态信息，如车速信息、车辆危险警示灯状态、车辆挡位信息等
- 车辆车外数据可分为道路环境数据及交通参与者数据，道路环境数据亦可分为动态道路环境及静态道路环境，动态道路环境例如路侧单元发出的红绿灯数据（SPAT），道路事件及路侧单元感知到的道路交通参与者信息（RSI）等
- 静态道路环境，包括地图数据，车道标牌等，交通参与者数据，例如车辆发出的BSM消息，弱势交通参与者（行人、非机动车）的基础安全消息PSM等，如图4所示：



  ![img](https://img-blog.csdnimg.cn/20210730103718606.png)     图4车辆接收射频消息V2X功能测试环境数据构成分析   



# 二、测试用例开发

本文以CSAE 0157中车车协作式变道场景为需求，开发其对应的测试用例。

CSAE 0157对车车协作式变道场景进行了如下描述：

车车协作式变道

车车协作式变道场景描述如下:

> 1. 装备有V2X通信设备的车辆EV-1、 EV-2在道路上正常行驶， EV-2在EV-1相邻车道内行驶
> 2. EV-1和EV-2需具备无线通信能力
> 3. EV-1在行驶过程中需要进行变道时， EV-1将变道意图发送给目标车道的相关车辆EV-2
> 4. EV-2收到EV-1的变道意图，根据自身信息、周围车辆信息或者其它车载传感器感知的周边环境信息，EV-2经决策判断，加速通过后EV-1变道；或EV-2减速让道】。同时EV-2将其自身的驾驶行为调整即时发送给EV-1.如图5：

  ![img](https://img-blog.csdnimg.cn/20210730110138153.png)     图5 车车协作式变道场景描述   

 在场景中，我们可认为：

> 1. EV-1，EV-2之间时距小于等于5秒时，EV-1的变道请求会使得EV-2进入逻辑判断阶段。
> 2. EV-1，EV-2在相邻车道时，EV-1的变道请求会使得EV-2进入逻辑判断阶段。
> 3. EV-2车速小于EV-1，且EV-1与EV-2之间时距小于等于3秒时，EV-2向驾驶员发出预警，并提示减速；当EV-2车速大于等于EV-1，EV-2向驾驶员发出预警，并提示加速通过，EV-1向驾驶员发出预警，并提示延迟变道。
> 4. EV-1完成变道或EV-2完成超车后预警退出。



分析车车协作式变道，我们可以得到如图7所示的车车协作式变道功能测试点：

  ![img](https://img-blog.csdnimg.cn/20210730105418714.png)     图6 协作式车车变道测试点示意图   



图6所示的测试点由环境描述、预警触发条件、预警退出条件三部分构成，对每条测试用例的交通环境、预警功能触发条件及预警功能退出条件进行了约束。

其后，我们对测试场景进行了搭建。

**加速通过场景：**

在加速通过场景中，“红车（EV-1）”接近前车准备变道后，“白车（EV-2）”加速行驶，让出道路后“红车（EV-1）”完成了变道。



<iframe id="UYjXmAWi-1627613735574" src="https://player.bilibili.com/player.html?aid=461961629" allowfullscreen="true" data-mediaembed="bilibili"></iframe>

【北汇信息】车车协作式变道 | 加速通过场景



**减速让道场景：**

在减速通过场景中，“红车（EV-1）”接近前车准备变道后，“白车（EV-2）”通过减速让行的方式让“红车（EV-1）”完成了变道。

<iframe id="ntKlC2JP-1627613853518" src="https://player.bilibili.com/player.html?aid=334447105" allowfullscreen="true" data-mediaembed="bilibili"></iframe>

【北汇信息】车车协作式变道 | 减速让道场景

# 总结

本文对基于V2X功能的测试用例开发进行了探讨。北汇信息是IMT-2020（5G）推进组蜂窝车联（C-V2X）工作组成员，我们致力于在C-V2X领域积极开展LTE-V2X和5G-V2X的测试验证技术研究等工作，积极推动中国V2X的产业落地，为客户提供C-V2X一站式测试解决方案和委外服务。方案覆盖终端接入层一致性、协议栈一致性和场景功能测试。