- [C-V2X仿真测试之虚拟场景设计](https://zhuanlan.zhihu.com/p/408703152)

## 一、前言

V2X（Vehicle-to-Everything）即车对“万物”，通过现代通信与网络技术，实现车与外界的信息交换共享（实时路况、道路信息、行人信息等一系列交通信息），从而提高驾驶安全性、降低交通拥堵、提高交通效率。

![img](https://pic1.zhimg.com/80/v2-bce1f6d2d5b7afe09b971de14ea2b5ec_720w.jpg)图1 V2X组织架构图

 V2X主要包含V2V (Vehicle-to-Vehicle)， V2I (Vehicle-to-Infrastructure)， V2P (Vehicle-to-Pedestrian)和V2N (Vehicle-to-Network)。

搭配V2X系统的车辆可以获取实时交通信息并对其分析，更加合理地规划行驶路径，在一定程度上辅助自动驾驶。

本文基于《CSAE 53-2020 合作式智能运输系统 车用通信系统应用层及应用数据交互标准》对V2X虚拟仿真场景设计进行探索，设计思路如下图所示。

![img](https://pic3.zhimg.com/80/v2-c1d2d2bcc163ffaaf1e7b30e6c153c96_720w.jpg)

图2 V2X虚拟仿真场景设计流程

##  二、**V2V场景设计**

V2V (Vehicle-to-Vehicle)即车载单元之间通信。在进行该类功能的虚拟场景设计时，主要考虑车辆的驾驶行为及各车辆之间的相对运动关系，提取关键元素设计逻辑场景，再结合具体的功能需求对逻辑场景中的元素进行参数化赋值，生成具体的测试场景。

下面以前向碰撞预警（FCW）、交叉路口碰撞预警（ICW）为例详细介绍V2V虚拟场景设计。

### **1. 前向碰撞预警（FCW）**

**（1）功能定义**

前向碰撞预警（Forward Collision Warning）是指，主车（HV）在车道上行驶，与在正前方同一车道的远车（RV）存在追尾碰撞危险时，FCW应用将对HV驾驶员进行预警，防止或减轻追尾事故带来的伤害。

**（2）场景设计**

根据功能定义描述可知，当主车（HV）与同车道远车（RV）之间的相对距离小于阈值时FCW功能触发。因此可设计以下4种逻辑场景：

**场景一**：HV以速度V0保持匀速行驶，RV在HV前方同车道距离X1处以初速度V1、减速度a减速行驶，当HV与RV之间的相对距离小于S（S<X1）时FCW功能触发，FCW应用通过HMI对HV驾驶员进行预警；

![img](https://pic3.zhimg.com/80/v2-86351dfe758105e419e0fc50fa650bca_720w.jpg)

图3 FCW场景一示意图

**场景二**：HV以速度V0保持匀速行驶，RV在HV前方同车道距离X1处以速度V1（V1<V0）保持匀速行驶，当HV与RV之间的相对距离小于S（S<X1）时FCW功能触发，FCW应用通过HMI对HV驾驶员进行预警；

![img](https://pic2.zhimg.com/80/v2-00c45fb9ff27db9e0e54f9c99965856d_720w.jpg)

图4 FCW场景二示意图

**场景三**：HV以速度V0保持匀速行驶，RV在HV前方相邻相邻车道距离X1（X1<=S）处以速度V1行驶并突然变道至HV所在车道，此时FCW功能触发，FCW应用通过HMI对HV驾驶员进行预警；

![img](https://pic3.zhimg.com/80/v2-5e61f5fed04c0cf4b9a70864cd62c752_720w.jpg)

图5 FCW场景三示意图

**场景四（逆向测试场景）**：HV以速度V0保持匀速行驶，RV在HV前方相邻车道距离X1（X1<=S）处以速度V1（V1<=V0）保持匀速行驶，FCW功能未触发；

![img](https://pic3.zhimg.com/80/v2-10f5ffb7bb515a7bf9844d098ec534fa_720w.jpg)

图6 FCW场景四示意图

 结合需求文档，对以上逻辑场景元素HV行驶速度V0、RV行驶速度V1、RV减速度a及车道类型（直道、弯道）进行参数化赋值，生成具体的FCW虚拟测试场景。

### **2. 交叉路口碰撞预警ICW**

**（1）功能定义**

交叉路口碰撞预警（Intersection Collision Warning）是指，主车（HV）驶向交叉路口，与侧向行驶的远车（RV）存在碰撞危险时，ICW应用将对HV驾驶员进行预警。

**（2）场景设计**

根据功能定义描述可知，HV驶向交叉路口并与任意一辆驶向同一路口的RV存在碰撞危险时（TTI及DTI小于阈值）ICW功能触发。因此可设计以下2种逻辑场景：

**场景一**：HV以恒定速度V0驶向前方交叉路口（角度α），RV在 HV左侧以恒定速度V1驶向路口并与HV相交于P点，HV到达P点的时间和距离分别为HV_TTI、HV_DTI  ，RV到达P点的时间和距离分别为RV_TTI、RV_DTI；当以上TTI和DTI满足条件时（存在碰撞危险）ICW功能触发，ICW应用通过HMI对HV驾驶员进行预警；

![img](https://pic2.zhimg.com/80/v2-c1126c35f4280f751fb7b3c8a5a64bbd_720w.jpg)

图7 ICW场景一示意图

**场景二**：HV以恒定速度V0驶向前方交叉路口（角度α），RV在 HV右侧以恒定速度V1驶向路口（与HV无交叉点），HV到达P点的时间和距离分别为HV_TTI、HV_DTI  ，RV到达P点的时间和距离分别为RV_TTI、RV_DTI；当以上TTI和DTI满足条件时（存在碰撞危险）ICW功能触发，ICW应用通过HMI对HV驾驶员进行预警；

![img](https://pic4.zhimg.com/80/v2-0dea4e81f51790106e84800ebc509f9b_720w.jpg)

图8 ICW场景二示意图

结合需求文档，对以上逻辑场景元素HV_TTI、HV_DTI、RV_TTI、RV_DTI及交叉路口角度α进行参数化赋值，生成具体的ICW虚拟测试场景。

## **三、V2I场景设计**

V2I (Vehicle-to-  Infrastructure)即车载单元与路侧单元通信。在进行该类功能的虚拟场景设计时，主要考虑交通环境信息（交通标志、交通事件、交通灯及道路信息），提取关键元素设计逻辑场景，再结合具体的功能需求对逻辑场景中的元素进行参数化设置，生成具体的测试场景。

下面以车内标牌（IVS）、闯红灯预警（RLVW）为例详细介绍V2I虚拟场景设计。

### **1. 车内标牌（IVS）**

**（1）功能定义**

车内标牌（In-Vehicle Signage）是指，当装载车载单元（OBU）的HV收到由路侧单元（RSU）发送的道路数据以及交通标牌信息，IVS应用将给予驾驶员相应的交通标牌提示，保证车辆的安全行驶。

**（2）场景设计**

根据功能定义描述可知，当HV驶入前方标识牌有效范围区域时，IVS功能触发。因此可设计逻辑场景：

**场景一**：HV以速度V0保持匀速行驶，前方有潮汐车道，当HV在标牌有效时间内驶入标牌有效区域时，IVS功能触发，IVS应用通过HMI将标牌信息显示给HV驾驶员；

![img](https://pic1.zhimg.com/80/v2-7b0fea39e2b8338774e3a895e8638aa0_720w.jpg)

图9 IVS场景一示意图

 结合需求文档，对以上逻辑场景元素HV行驶速度V0、标牌类型（潮汐车道、限速等）进行参数化赋值，生成具体的IVS虚拟测试场景。

### **2. 闯红灯预警（RLVW）**

**（1）功能定义**

闯红灯预警（Red Light Violation Warning）是指，主车（HV）经过有信号控制的交叉口（车道），车辆存在不按信号灯规定或指示行驶的风险时，RLVW应用对驾驶员进行预警。

**（2）场景设计**

根据功能定义描述可知，当HV驶向前方有信号灯控制的交叉口（车道）且存在闯红灯风险时，RLVW功能触发。因此可设计逻辑场景：

**场景一**：HV在左转（直行）车道上以恒定速度V0驶向有信号灯控制的交叉口，当前左转（直行）车道信号灯状态为红灯，且红灯剩余时间大于HV到达路口停止线的时间；HV存在闯红灯危险，此时RLVW功能触发，RLVW应用通过HMI对HV驾驶员进行预警；

![img](https://pic2.zhimg.com/80/v2-79a2f85d23ba69bd2aed41bb860b5c49_720w.jpg)

图10 RLVW场景一示意图

 结合需求文档，对以上逻辑场景元素HV行驶速度V0、HV所在车道及车道匹配的信号灯状态（灯色、时间）进行参数化赋值，生成具体的RLVW虚拟测试场景。

## **四、V2P场景设计**

V2P (Vehicle to  Pedestrians)即车载单元与行人设备通信。在进行该类功能的虚拟场景设计时，主要考虑弱势交通参与者与车辆之间的相对运动关系，提取关键元素设计逻辑场景，再结合具体的功能需求对逻辑场景中的元素进行参数化设置，生成具体的测试场景。

下面以弱势交通参与者碰撞预警（VRUCW）为例详细介绍V2P虚拟场景设计。

### **3.1 弱势交通参与者碰撞预警（VRUCW）**

**（1）功能定义**

弱势交通参与者碰撞预警（Vulnerable Road User Collision  Warning）是指，HV在行驶中，与周边行人（P，Pedestrian；含义拓展为广义上的弱势交通参与者，包括行人、自行车、电动自行车等）存在碰撞危险时，VRUCW应用将对车辆驾驶员进行预警，也可对行人进行预警。

**（2）场景设计**

根据功能定义描述可知，当HV与周边行人存在碰撞危险时，VRUCW功能触发。因此可设计逻辑场景：

**场景一**：HV以速度V0保持匀速行驶，侧前方有行人横穿马路，行驶速度为V1；HV与P存在碰撞危险，VRUCW功能触发，VRUCW应用通过HMI对HV驾驶员进行预警；

![img](https://pic3.zhimg.com/80/v2-b689447b1b5ebadc4aed94b584cafa96_720w.jpg)

图11 VRUCW场景一示意图

**场景二**：HV在倒车时，侧后方有行人横穿马路，行驶速度为V1；HV与P存在碰撞危险，VRUCW功能触发，VRUCW应用通过HMI对HV驾驶员进行预警；

![img](https://pic3.zhimg.com/80/v2-2746ba6437a6360e98660c67999b772a_720w.jpg)

图12 VRUCW场景二示意图

**场景三（逆向测试场景）**：HV以速度V0保持匀速行驶，侧前方有行人与HV同向行驶，行驶速度为V1；HV与P不存在碰撞危险，VRUCW功能未触发；

![img](https://pic2.zhimg.com/80/v2-8bc5aeedc5d7b50d4568c54cd7e48ecd_720w.jpg)

图13 VRUCW场景三示意图

 结合需求文档，对以上逻辑场景元素HV行驶速度V0、弱势交通参与者类型P、行驶速度V1进行参数化赋值，生成具体的VRUCW虚拟测试场景。

## **五、总结**

本文举例详细介绍了CSAE 53-2020（第一阶段）中V2V、V2I及V2P虚拟仿真场景的设计思路及方法，对于CSAE 157-2020（第二阶段）中的功能应用，场景搭建思路及方法与之类似，以协作式车辆编队管理（CPM）为例，搭建的虚拟场景如下：

[【北汇信息】C-V2X | 协作式车辆编队管理_哔哩哔哩_bilibili](https://link.zhihu.com/?target=https%3A//www.bilibili.com/video/BV14Q4y1a7BU%3Fspm_id_from%3D333.999.0.0)

[www.bilibili.com/video/BV14Q4y1a7BU?spm_id_from=333.999.0.0![img](https://pic3.zhimg.com/v2-9214ca316848471d22175ef50d3b28ce_180x120.jpg)](https://link.zhihu.com/?target=https%3A//www.bilibili.com/video/BV14Q4y1a7BU%3Fspm_id_from%3D333.999.0.0)

本文中V2X虚拟仿真场景设计是基于仿真软件DYNA4实现的，DYNA4支持场景建模、传感器建模及动力学建模等功能，大家有这方面需求的话可与我们联系。

北汇信息是德国Vector公司、德国Rohde&Schwarz（简称R&S）公司、德国IPG公司、德国PikeTec公司、美国Perforce公司等国际知名企业的官方合作伙伴，同时也是IMT-2020（5G）推进组蜂窝车联（C-V2X）工作组成员，我们致力与在V2X领域积极开展LTE-V2X和5G-V2X的测试验证技术研究等工作，积极推动中国V2X的产业落地，为客户提供V2X成套测试系统及服务。

## **参考文献**

*CSAE 53-2020 合作式智能运输系统 车用通信系统应用层及应用数据交互标准（第一阶段）*

*CSAE 157-2020 合作式智能运输系统 车用通信系统应用层及应用数据交互标准（第二阶段）*

*文中部分内容参考于Vector。*