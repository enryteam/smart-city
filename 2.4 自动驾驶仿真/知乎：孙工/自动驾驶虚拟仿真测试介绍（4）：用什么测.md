- [自动驾驶虚拟仿真测试介绍（4）：用什么测 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/146495384)

## 一、仿真测试平台的构成

我们在上一篇《测什么》中用了一张图来概括自动驾驶算法的构成：

![img](https://pic4.zhimg.com/80/v2-1f8d4f7e2c4b3c6b7af95f98a2d8a01f_720w.jpg)

自动驾驶算法通过各种传感器探测周围环境的状态，进行决策后对车辆进行控制。为了在仿真环境对自动驾驶算法进行测试，需要模拟自动驾驶算法的各种输入，并响应其输出，从而“欺骗”它，让它以为在真实世界工作。

为此，对照真实世界，仿真测试平台由交通场景模块、传感器模块、车辆动力学模块和测试管理模块构成。如下图所示：

![img](https://pic3.zhimg.com/80/v2-bbfee55cc0da36ec49018b4b3dbd53fa_720w.jpg)

**（1）交通场景模块**

交通场景模块用于模拟车辆运行的外部世界。

一方面，模拟各种交通场景要素，比如：①高速公路、城市道路等不同的道路结构；②标志标线、护栏、交通灯等道路附属设施；③轿车、卡车、摩托车、行人等交通参与者；④路障、锥桶、遗撒物等临时物体；⑤晴、阴、雨、雪、白天、黑夜等不同的天气。

另一方面，模拟不同交通场景要素之间的组合和动态关系，即不同的“场景”。比如：高速公路上，一辆轿车在被测车辆前方快速切入；十字路口黄灯时，一辆卡车在被测车辆前方紧急制动停车。

**（2）传感器模块**

传感器模块用于模拟车辆上安装的各种传感器，从而获得交通场景的状态。

一方面，根据传感器种类的不同，模拟不同的信号内容，比如：摄像头传感器输出图像信号，激光雷达传感器输出点云信号，导航传感器输出定位信号。

另一方面，根据传感器特性和参数的不同，模拟出其“局限”，比如：传感器的探测范围，摄像头的畸变和炫光，不同材质对激光雷达光线吸收的影响，护栏对毫米波雷达的杂波影响。

**（3）车辆动力学模块**

车辆动力学模块用于模拟车辆本身对自动驾驶算法控制的响应，特别是对加速、制动和转向的响应。

车辆动力学模块一般参照真实车辆，由车身、动力传动系统、悬架系统、转向系统、制动系统和车轮等不同的子系统构成。

**（4）测试管理模块**

测试管理模块，负责对以上三个部分组成的仿真测试环境的管理，保证仿真测试的效果和效率。

一方面，对测试流程进行管理，比如：测试用例的选择、测试的启动和终止、仿真模块的调度。另一方面，对测试数据进行管理，比如：测试用例的更新、测试数据的记录和分析、测试报告的生成。

## 二、仿真测试工具的流派

目前常见的仿真测试工具有很多种，根据自动驾驶开发团队的来源，大致可分为如下几个流派：传统主机厂倾向于使用汽车工业的商业软件，使用机器人平台开发自动驾驶算法的团队常常使用ROS/Gazebo，很多擅长计算机图形学的团队基于游戏引擎开发仿真工具。而大规模复杂交通流的仿真需求，则由交通规划领域的软件来满足。

下图列举了一些常见的工具：

比如汽车工业的CarSim、CarMaker、VTD和PreScan，机器人开发的ROS和Gazebo，基于游戏引擎的CARLA、AirSim和LGSVL，以及交通规划软件VISSIM和SUMO。

![img](https://pic2.zhimg.com/80/v2-c1ecde08a5eb801ec36c8c76fd85561d_720w.jpg)

## 三、仿真测试工具的选择

如上一篇《测什么》中所说，一个完整的、精度高的仿真测试平台自然是最终的目标，但是在实际的自动驾驶开发中，团队一定会根据当下的具体需求和成本限制进行选择。

比如：是否需要高精度的传感器模型？如果想采用VISSIM等工具模拟区域交通流，是否有合乎实际的交通调查数据？自动驾驶算法测试使用的车辆动力学模型，是否要与底盘调教的车辆模型使用一样的精度？高保真的视觉场景是否满足测试效率的要求？成熟的商业软件是否满足特定的需求？采用开源软件的话，团队的能力和项目进度是否允许？

等等诸如此类的问题，都需要根据不同的实际情况仔细评估后，再做选择。