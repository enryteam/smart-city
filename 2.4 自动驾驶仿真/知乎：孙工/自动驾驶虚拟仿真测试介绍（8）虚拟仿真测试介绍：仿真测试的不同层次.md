- [自动驾驶虚拟仿真测试介绍（8）:虚拟仿真测试介绍：仿真测试的不同层次 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/161732976)

自动驾驶汽车决策过程如下图所示：由各种传感器感知环境状态，并发送给控制器；控制器融合各种传感器的信号，并根据功能和算法的定义给出控制指令；最终由车辆上的执行器执行，使得车辆自动行驶。

![img](https://pic4.zhimg.com/80/v2-21b2f2467c4e4698ef49152f44b0f04b_720w.jpg)

根据上述提到的环境、传感器、控制器和车辆四种元素的状态的不同（是否用真实部件），可以进行不同层次的仿真测试。

![img](https://pic1.zhimg.com/80/v2-f2279ec77b4a8ade9243abb36204895c_720w.jpg)

## 01 层次一

这个层次的仿真测试，没有真实的部件，一般称为模型/软件在环测试，主要测试内容为自动驾驶的控制算法。其结构如下图所示：

![img](https://pic2.zhimg.com/80/v2-9022d1828c4caa32b3728e8feb07a905_720w.jpg)

自动驾驶算法可以是Simulink模型的格式，也可以是C/Python等代码的格式。虚拟场景和传感器由VTD、PreScan等场景仿真软件提供。虚拟车辆由CarSim、veDYNA等车辆动力学软件提供。可以在PC环境中运行三者的联合仿真，进行测试。

其中的虚拟传感器可以采用理想传感器，发送真值数据；也可以采用复杂传感器，考虑到激光雷达、毫米波雷达等不同传感器的特性，发送带误差的数据。

## 02 层次二

这个层次的仿真测试，控制器采用真实部件，这个真实部件可以是量产版的部件或者快速原型机，也可以是近来自动驾驶开发经常使用的工控机。一般称为硬件在环测试。其结构如下图所示：

![img](https://pic2.zhimg.com/80/v2-9cd90889034d2bb00f0cda90e8ed5669_720w.jpg)

场景仿真软件和车辆动力学软件一般在实时仿真机运行，用来保证运行的实时性。自动驾驶控制器中包含自动驾驶算法，并通过硬件接口板卡（如CAN板卡、以太网板卡）与实时仿真机相连，进行车辆状态、传感器信号和控制指令的交互。其中，传感器信号需要按照实车上使用的接口和协议进行发送。

对于使用工控机的情况，或者其他实时性要求不是太高，而且通信接口可以满足测试需求的情况，也可以使用PC作为场景仿真和车辆动力学软件的运行环境。

## 03 层次三

这个层次的仿真测试，相比上一层次，部分传感器采用真实部件：

![img](https://pic1.zhimg.com/80/v2-83f318d5420bb8531b273d7e17c6e44c_720w.jpg)

一般称为硬件在环测试。其结构如下图所示：

![img](https://pic4.zhimg.com/80/v2-2256f705a10f3b2831a56b592956e383_720w.jpg)

与上一层次相比，部分传感器使用真实部件，将场景仿真软件中的虚拟传感器的信号发送至传感器信号仿真设备，进而由传感器信号仿真设备发送传感器信号，影响真实传感器的输出。

值得注意的是，这一层次中部分传感器使用真实部件，大多情况下并不是要对传感器的真实部件进行测试，而是因为供应商不能提供该传感器输出信号的协议，从而不能仅仅使用虚拟传感器进行信号仿真。

## 04 层次四

这个层次的仿真测试，相比上一层次，车辆更改为真实车辆，将真实车辆置于转鼓试验台上进行测试，故一般称为车辆在环测试。或者以驾驶模拟器的形式体现，称为驾驶员在环测试。这一测试的好处是具有真实的执行器和传感器，可以在试验室中制造多样的环境状态（比如雨、雾、强光等）进行测试；另外由于具有真实的座舱，可以对人机交互/HMI等功能进行测试。

其结构如下图所示：

![img](https://pic3.zhimg.com/80/v2-42e15ceb4f8b5656a701d9997f071b56_720w.jpg)

场景仿真和车辆动力学仿真软件联合仿真，以真实车辆反馈的轮速、车轮转角等作为输入，输出行驶阻力和转向阻力，通过转毂试验台反馈给真实车辆，实现闭环测试。这其中的难点在于行驶阻力和转向阻力模拟的真实性。

该层次的一个示例如下图所示：

![img](https://pic3.zhimg.com/80/v2-7491b6bc2c98b6199117fb89049ddf56_720w.jpg)

## 05 层次五

这个层次的仿真测试，相比上一层次，不再将真实车辆置于转鼓试验台上，而是使用真实车辆在真实的道路上行驶，故一般也称为车辆在环测试。其结构如下：

![img](https://pic3.zhimg.com/80/v2-425265daf7ce368e4b1649091c5b2902_720w.jpg)

由于车辆在运动过程中，不再使用传感器信号仿真设备，而是仅使用场景仿真软件仿真传感器信号（有时也使用部分真实传感器，并布置真实交通物体），并通过硬件接口板卡发送给控制器。这一层次仿真的好处是，使用真实车辆在真实道路上行驶，车辆动力学特性完全真实；而且，交通物体的状态通过虚拟传感器模拟，不会发生碰撞等危险情况，从而可以对一些危险场景进行测试。

该层次的一个示例如下图所示：

![img](https://pic3.zhimg.com/80/v2-91794b5b732fe9db2019921e399db3f6_720w.jpg)



**最后谢谢您宝贵的正激励和正反馈！**