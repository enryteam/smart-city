# 三维GIS平台子系统

## 1.1 概述

### 1.1.1 国内外应用现状

随着GIS应用的深入，人们越来越多地要求从真三维空间来处理问题。三维GIS是当今乃至未来GIS技术的主要标志性内容之一，它突破了空间信息在二维地图平面中单调表现的束缚，为各行各业以及人们地日常生活提供了更有效的辅助决策支持。三维GIS的研究对象从二维地图转变为三维世界，使地形地物的空间形态、结构和相互之间的关联关系变得更加的复杂，相应的GIS数据模型和技术方法都需要颠覆性的创新。

三维GIS与二维GIS一样，需要具备最基本的空间数据处理功能，如数据获取、数据组织、数据操纵、数据分析和数据表现等。相比于二维GIS，三维GIS具有以下优势：

1、空间信息的展示更为直观。从人们懂得通过空间信息来认识和改造世界开始，空间信息主要是以图形化的形式存在的。然而，用二维的图形界面展示空间信息是非常抽象的，只有专业的人士才懂得使用。相比二维GIS，三维GIS为空间信息的展示提供了更丰富、逼真的平台，使人们将抽象难懂的空间信息可视化和直观化，人们结合自己相关的经验就可以理解，从而做出准确而快速的判断。毫无疑问，三维GIS在可视化方面有着得天独厚的优势。虽然三维GIS的动态交互可视化功能对计算机图形技术和计算机硬件也提出了特殊的要求，但是一些先进的图形卡、工作站以及带触摸功能的投影设备的陆续问世，不仅完全可以满足三维GIS对可视化的要求，还可以带来意想不到的展示和体验效果。

2、多维度空间分析功能更加强大。空间信息的分析过程，往往是复杂、动态和抽象的，在数量繁多、关系复杂的空间信息面前，二维GIS的空间分析功能常具有一定的局限性，如淹没分析、地质分析、日照分析、空间扩散分析、通视性分析等高级空间分析功能，二维GIS是无法实现的。由于三维数据本身可以降维到二维，因此三维GIS自然也能包容二维GIS的空间分析功能。三维GIS强大的多维度空间分析功能，不仅是GIS空间分析功能的一次跨越，在更大程度上也充分体现了GIS的特点和优越性。

国内外从上世纪90年代开始三维GIS的研究，随着计算机软、硬件，以及海量空间信息数据获取和管理技术的发展，三维GIS软件在国土、测绘、军事、海洋、石油、林业、矿山开发、地理教学等众多行业中逐步得到了成功应用。国外相继出现了Google Earth、Skyline、World Wind等三维GIS软件产品，同期国内也出现了EV.Globe、GeoGlobe等知名三维GIS软件产品。

### 1.1.2 建设需求分析

​	现代交通不断往立体化发展，交通现象越来越复杂，对于小比例尺、宏观的道路网数据处理来说，二维的数据基本能满足需求，因为此时道路交叉口完全可以用节点来代替。但对于大比例尺，特别在进行城市道理的数据处理时，道路交叉口不仅不能忽略，是城市道路数据处理中最难以解决的部分，并且在大型城市的道路网中占据了相当大的比例，因此研究一个适于表达城市道路网三维特征的数据模型和建设三维GIS平台具有重要的意义。

### 1.1.3 建设范围

![image-20210727155844668](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727155844668.png)

**图**6.91**三维GIS平台建设范围**

上图中红色范围表示的区域大小为400平方公里，是本次三维GIS平台建设区域，基本包含高速外环内区域（除去东北角部分区域）。

### 1.1.4 建设内容

本次三维GIS平台建设的内容如下：

l 我市区400平方公里3D地图模型

l 三维空间数据库

l 3D引擎

l 三维GIS平台工具

### 1.1.5 建设目标

三维GIS平台建设目标是以3S(遥感（RS）、地理信息系统（GIS）和全球定位系统（GPS）)技术为基础，整合我市的自然资源、空间地理基础信息、交通信息以及关联的各类经济社会信息，建立多尺度、更新及时的城市交通信息资源共享平台。

## 1.2 三维系统平台介绍

随着计算机技术，遥感技术等高新技术的不断发展，三维地理信息系统的技术愈加的成熟。实时渲染的三维GIS系统突破了传统的二维GIS软件在实时性、表现手段、仿真分析功能等方面存在无法克服的局限性。

三维GIS系统平台支持底层开发的3D引擎，使三维建筑的显示逼真细腻。平台提供了对数据库中各种比例尺专题地图进行浏览和编辑的方法和手段，包括索引图、基本要素分布图等。系统支持海量数据的传输,管理。系统浏览的功能有放大、缩小、漫游、分层浏览、地图刷新等。地图编辑功能有更换模型、信息查询、图层控制、信息定位、区域查询、空间分析等。系统提供了强大的实时三维地理数据管理分析、可视化和科学计算功能，支持空间信息查询和属性数据库查询和管理。

### 1.2.1 三维GIS系统平台构成

l 3d地图引擎

支持简要数据输入和输出。对象实体模型的建造、编辑、注释，实时3D地形浏览、空间分析、读取、输出外部数据源等。支持各种垂直分类数据的检索和标记。灵活，快速，强大。支持用户间互动，数据共享等。

l 3d接口开发包

一套ActiveX的软件开发包（PC SDK），允许用户自定义应用和建立强大的3D地理空间用户界面。并且提供简洁的应用开发接口可与服务端产品无缝集成。能够在任何应用程序或网页平台上，整合与执行3D展现能力。

l 海量并发服务端

系统提供强大的网络数据服务，它能够现时传送3D地理数据，在多计算机（云计算）多处理（多核）的环境下， 能够在所有计算机和获得的处理器中自动分配负载，更好的发挥性能，更有弹性的服务水平扩展能力，可以很灵活的降低您的产品部署成本。在数据安全方面，可以配置达到1024位的加密程度，可以广泛的应用各种对数据安全有要求的应用场景.三维数据创建工具结合大量的航片，卫星影像，地理信息，数字高程模型和矢量数据。简洁快速创建大量三维地表数据集，三维场景。 

l 平台工具

结合大量的航片，卫星影像，地理信息，数字高程模型和矢量数据。简洁快速创建大量三维地表数据集，三维场景。

### 1.2.2 三维GIS地图特点

1、架构合理：

a)	采用面向服务架构（SOA）技术，各种主要功能（如数据、搜索、分析）均为独立服务，支持自定义扩展服务或无缝聚合第三方服务。

b)	支持Internet、Intranet网络应用环境，提供B/S和C/S两种网络解决方案，支持数据、服务的分布式部署。

2、信息丰富：

a)	支持全球三维信息的组织、调度、显示与分析，包括影像、地形、模型、矢量、效果、动画、视频和几何对象

b)	支持MAX数据格式

c)	支持WGS84、西安80、北京54、国家2000坐标系和城市坐标系，支持UTM、高斯、墨卡托等常用投影

3、	云部署：

a)	支持跨平台Linux及Windows环境部署，信息安全级别高、数据服务稳定、并发处理功能强大。

b)	支持云平台部署策略

4、效果：支持光影烘焙和多层纹理，支持动画纹理、骨骼动画、普通动画、反走样（抗锯齿外设）、Flash视频纹理等特效，支持全场景碰撞、多人在线和在线纹理替换等功能。

5、功能强大：

a)	支持各种信息检索和分析。包括加载地名、餐饮等各种信息，并对指定区域的相关信息进行检索查找及量算

b)	支持三维立体数据对象创建、编辑、属性挂接

c)	支持三维量算、水淹、日照、通视、天际线等

6、开放：具有灵活方便的二次开发接口，开发环境和运行环境统一，提供JavaScriptAPI和COM接口，支持主流开发工具——VC++，C#，JavaScript等，提供完整的二次开发文档和示例。

7、人机交互：支持多种人机交互接口，包括普通鼠标、键盘、游戏杆、3D鼠标、触摸屏操控；能在多通道投影上直接播放；支持立体VR浏览。

## 1.3 三维地图模型设计与建设

### 1.3.1 三维GIS地图模型设计

三维GIS的研究对象从二维地图转变为三维世界，使地形地物的空间形态、结构与相互之间的关联关系变得更加复杂，相应的GIS数据模型和技术方法都需要颠覆性的创新，比如传统分幅镶嵌的二维平面地图数据结构需要转变为无缝的三维模型（几何+外观+语义）数据结构；离散比例尺地图符号可视化需要转变为多细节层次（LOD）真实感场景的自适应可视化等。同时，三维实体空间一体化的高精度建模、准确度量分析、高效集成管理与实时可视化分析等一直是三维GIS研究的主题与核心，近年来取得了系统性的突破。

1、真三维GIS数据模型

三维空间数据模型是三维GIS的基础，也是决定三维GIS系统能力的最基本因素。传统三维空间数据模型大都面向特定的专业领域，如地质模型、矿山模型、地表景观模型等，这些模型大部分针对单一数据类型，不能表示多源异构数据，并且缺乏统一的语义表达、在多尺度表达的一致性方面较差，需要在线进行坐标转换、数据结构转换，不同系统功能难以并行处理、增加三维绘制状态的切换频率等，导致三维GIS系统利用率低，多种应用需要多套数据和多种软硬件系统，难以满足地上下和室内外三维空间信息的精准表达、动态更新与一致性维护，以及综合分析的需要。因此，传统三维GIS难以提供一个城市完整的空间表达与管理的解决方案，尤其是宏观规划管理跟微观精细化管理之间的矛盾十分突出。针对地上下和室内外多粒度对象统一表达的复杂性与高效性难题，地上下和室内外一体化表达的真三维GIS模型（图1）刻画了三维空间对象几何、拓扑和语义的特征及其相互关系：统一的空间基准与数据结构、多层次语义与拓扑关系，以及几何与纹理的多细节层次表达等。特别是基于三维几何的精细化表达，实现了建筑、道路等设施及其部件级别的物理性能和功能的语义描述，使得三维GIS进一步拓展能有效支撑物联网信息的承载和关联分析，以及室内外无缝定位与导航应用。该模型扩展了国际OGC标准CityGML四种最主要的常用专题模：建筑模型、道路模型、管线模型和地质模型，实现了将复杂的三维地理环境划分为3个层次进行描述：地形表面层次、地上下立体空间层次和建筑物三维内部空间层次。

（1）地形表面层次是面向完整的2.5D地表空间管理，在整个区域地形表面空间层次上确保合理的空间划分与区域识别；

（2）地上下立体层次是基于基本的立体层次描述的三维空间，主要解决三维空间对象在二维抽象表示中产生的地上下交叠问题，满足三维空间层面的对象精确表达与分析需求；

（3）建筑物三维内部空间层次是基于建筑结构的语义关系进一步详细划分的内部空间层次，使用“位于”和“部分－组成”语义关系来表达建筑物的内部逻辑构成，从而建立完整的三维内部空间表示。

2、精确高效的三维GIS集成建模

2010年，国家住房和城乡建设部颁布了“城市三维建模技术规范”，统一了面向城市规划、设计、建设、管理等应用的城市三维建模技术规范。2012年，国家测绘地理信息局发布了面向基础地理信息产品生产的三维模型数据生产、产品、数据库3本规范，确定了模型的类型、内容，以及模型数据的采集、制作、质量控制、更新维护、数据入库等内容。近年来，倾斜摄影测量和激光扫描测量等高新技术的精度与速度都有了明显的提高，大量的研究致力于地物（尤其是人工地物）的三维自动重建，且依据分辨率、精度、时间和成本等的不同，已有许多适宜的技术方案可供选择。三维空间数据获取技术的成熟与规范化是三维GIS真正普及应用的重要保障。由于各个城市的自然与人文景观千姿百态，准确、逼真、精细、高效的城市三维建模仍然是一项十分复杂的系统工程。地上下和室内外不同环境的三维建模技术手段千差万别，根据已有地图信息和新获取的多角度高分辨率影像或激光扫描点云数据半自动化建模，再结合人工交互式建模的“集成化”模式成为当前乃至今后一段时期满足三维GIS建模精度、效果和效率的主要途径。随着三维GIS在设施规划设计、建设与运行维护等全生命周期中的深化应用，三维CAD模型、三维建筑信息模型（BIM）与三维GIS模型的集成与融合成为新的前沿技术。因此，高细节层次的复杂建筑物或者城市尺度，以及高速铁路和高速公路等大范围三维GIS建模的技术难点在于从高细节层次模型到低细节层次模型的自动转化。

3、大规模三维GIS数据的高效组织管理模式

海量二维GIS数据以及瓦片式地形景观数据的高效组织管理技术已经相对成熟，促进了虚拟地球的应用服务。而高效、一体化地组织与管理复杂的不均匀分布的地上下和室内外三维空间模型数据一直是研究的前沿难点问题，也是三维GIS从局部范围示范应用到城市级综合应用面临的主要技术挑战。三维GIS数据高效组织管理存在两大技术瓶颈：（1）由于模型数据量大、三维空间对象几何形状各异、空间分布稀疏不均、且结构化的二维纹理数据与非结构化的三维几何数据紧耦合引起的数据密集导致数据动态存取存在严重的I/O瓶颈；（2）三维空间数据分析与实时可视化等应用越来越复杂引起的计算密集导致了复杂空间数据操作存在服务器的性能瓶颈。传统三维GIS可视化系统由于采用一次性装载的数据组织管理方式，能处理的数据量受限于计算机内存和显存的大小，而且数据和软件常常还要绑定，难以充分发挥系统应用效能。针对这些技术瓶颈，国际上的研究一方面在最基本的模型表示和数据结构上通过标准化进行统一，尽量减少运行时不同格式模型的转换导致的时间和空间浪费；另一方面，在系统研制上主要是发展三维GIS特有的数据组织模式和相应的空间索引结构，以及动态调度机制。例如，基于数据内容的三维空间数据自适应多级缓存、顾及多细节层次的三维R树空间索引、三维GIS异步通信传输方法，以及文件系统、数据库系统与集群并行系统等灵活的数据库管理系统模式等。如下图所示，典型的三维GIS数据库引擎能灵活适应文件系统和关系数据库管理系统等多种存储管理模式，并满足多用户不同层次的实时可视化分析应用需求。

针对长大铁路、公路和地铁等大规模的复杂三维表面模型无缝的实时可视化分析应用，由于涉及很大范围的沿线地形地质景观模型和地物表面精细模型的多分辨率混合表达，往往要将多分辨率的规则格网Grid和不规则三角网TIN根据三维模型的复杂程度自适应地剖切为标准瓦片大小范围的数据进行高效组织管理。面向智慧城市建设，三维GIS一方面要不断优化改进数千平方公里范围TB级地上下和室内外三维模型数据的一体化组织管理性能，真正实现一个数据库共享应用的目的，显著提升整个城市级多层次应用的效能；既能提供在线协同设计与精细化管理应用服务，也能提供在线轻量化与社会化的应用服务；同时，三维GIS作为时空数据的基本承载引擎，急需大大提升三维GIS支撑多维动态时空数据的组织管理能力，特别是时空关联和语义感知的数据库智能搜索能力。面向大型设施全生命周期的协同设计、施工管理、运营管理与综合养护等需要，三维GIS作为一体化的共享数据库平台，急需不断提升三维GIS组织管理与动态更新更加复杂的BIM/CAD模型，以及与各专业CAD系统之间有机协同的能力，支撑三维环境中的地理设计（GeoDesign）。

![image-20210727155859307](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727155859307.png)

### 1.3.2 三维系统的建设

◆系统概述

三维GIS系统是用于空间基础信息三维数据浏览显示与查询分析的应用系统，三维GIS系统为用户提供了一个三维可视化的数据浏览、查询的信息平台，通过三维GIS系统可以浏览和查询平台基础信息数据库中的DEM、城市景观、遥感影像、城市绿化、城市公共设施分布等数据。系统可以导入各种常用的二维以及三维地理信息数据文件，兼容大多数开放的标准格式。

◆框架设计

三维GIS系统通过应用接口服务获取基础信息数据库中的数据，系统运行模式采用B/S模式，用户访问界面基于WEB浏览器（IE系列）。系统的框架结构如下：

![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps99.png)

系统技术架构

三维GIS系统平台为B/S模式，用户只需安装IE插件，即可访问3D信息服务。三维GIS系统平台采用数据、应用框架和三维GIS服务框架的三层体系架构。

![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps100.jpg)

功能设计

三维GIS系统主要提供以下功能：提供易用的三维虚拟显示应用工具，为不同政务部门提供相应三维空间数据应用子系统。提供三维GIS系统操作功能，包括场景浏览、场景切换、指北针、图层控制等。系统功能组成如图：

![img](https://gitee.com/er-huomeng/l-img/raw/master/img/wps102.png)



### 1.3.3 三维数据的建设

#### 1.3.3.1 模型数学精度要求

（1）采集所有单体占地面积大于3×3米的非临时建筑物（包括在建的但已完成所有外墙装饰的建筑）的外围轮廓，当轮廓线凹凸小于3米、且长度小于10米时可进行综合。

（2）建模完成的所有三维模型的数学精度应完全基于科学、合理的方法获得，应保证其整体误差控制在2米之内。

（3）建筑物顶面的纹理从高分辨率数字正射影像图上采集，建筑物侧面的纹理需在实地用数码相机或数码摄像机获取。建筑物的纹理数据，特别是侧面纹理，均需经过调色、去杂色等编辑处理，以恢复建筑物新建时的色调为准，分辨率不低于300DPI。

#### 1.3.3.2 模型精度要求

采用企业级三维建模软件（如3DS MAX等），按照建筑物的真实尺寸和形状，在保证建筑基本特征的前提下，以尽可能少的三角形面片数量构造建筑物的三维模型，并粘贴编辑好的纹理贴面。

要求采用三级混合精度建模，即精细模型、简单模型和概略模型。

（1）精细模型

精细模型要求模型结构准确，特有结构不能省略，细节表达准确，三角形面数多数在1500以内。精细模型应具有较高精细度，最大程度的接近真实，具有丰富的细节，能够表现建筑的特点，要求贴图纹理逼真。对于城市主干道、立交桥及其两侧建筑物、重要的标志性建筑、工业园区等，要采取精细建模的方法，保证模型的精细度、真实度和美观度。精细模型纹理分辨率要求为2048*2048。

（2）简单模型

简单模型要求模型结构基本正确，表现出基本形状，能够通过该特征明显辨认，三角形面数多数在500以内。简单模型应具有普通精细度，模型比较接近真实，具有最典型的特征细节，如屋顶形式、女儿墙、裙楼等，能够通过典型特征辨认出是真实的哪一栋建筑；简单模型纹理应基本真实。

对于城市次干道及其两侧建筑物、一般公共设施、完善的成片开发住宅区、工业园区等，要采取简单建模的方法，在保证模型的真实程度上提高模型的美观程度。

简单模型纹理分辨率要求为1024*1024。

（3）概略模型

概略模型要求模型结构相似，可从地形图上直接提取相关属性建模，勾勒轮廓线，基本忽略细节，贴仿真纹理，即该类型建筑的通用纹理，不追求与真实情况完全一致，三角形面数多数在150以内。概略模型纹理分辨率要求为512*512。

#### 1.3.3.3 三维数据制作流程

（1）在MAX中导入建设区域的底图作为建模参考，在底图的基础上进行模型位置的定位和模型的建模。

![image-20210727160028149](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727160028149.png)

（2）根据顶视图里面的辅助线的轮廓和朝向进行初步的建模，通常的建模方法是用Line根据CAD基线描绘建筑物的顶面，然后通过挤压面得到初步模型。

![image-20210727160100845](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727160100845.png)

（3）处理采集人员采集回来的图片。把模型分割为不同的面，通过Photoshop为每个面制作贴图，贴图的标准是恢复建筑新建时的状态。

![image-20210727160107516](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727160107516.png)

（4）通过获取建筑物的顶部轮廓为建筑的顶部制作贴图纹理，通常包括女儿墙，阴影效果等。其中阴影的角度为.45度角。对模型的各个面进行题图，并经过烘培处理。

![image-20210727160117133](https://gitee.com/er-huomeng/l-img/raw/master/img/image-20210727160117133.png)

（5）输入建筑物的X Y坐标，调整中心点的位置，确定Z坐标为0。检查模型以确保模型无共面，废点以及未贴图的面。输入OBJ、X和3DS格式文件。加载XX市三维模型进3D系统。

### 1.3.4 系统软硬件环境

#### 1.3.4.1 操作系统

操作系统采用Windows Server2012中文企业版作为服务器操作系统。

#### 1.3.4.2 数据库管理系统

三维城市系统的数据库管理系统建议采用Postgres数据库进行建设。　Postgres是一种特性非常齐全的自由软件的对象.关系型数据库管理系统（ORDBMS），是目前比较先进，功能强大的支持空间运算自由数据库管理系统。

#### 1.3.4.3 3D系统服务器选型

3D服务器在选型上应充分考虑三维城市系统的应用水平和信息处理的数据量大小，保证今后较长一段时间内能满足用户业务的发展。服务器应具备以下特点：

l 很强的CPU处理能力；

l 高速磁盘访问速度，具有较大的内部带宽；

l 服务器能够运行稳定；

l 配备功能强大的操作系统，支持多服务的运行；

l 硬件体系结构和操作系统符合工业标准或支持流行的规范。

l 高性能的吞吐速率与处理速度；

l 大容量：服务器系统必须具备良好的通讯处理、存储和交换性能，满足各业务终端可能产生的并发连接处理的批处理所需占用的系统资源。要求采用大容量硬盘，磁盘列阵；

l 可靠性：数据存储的安全、完整、高效至关重要，从硬件方面来考虑，则要求服务器系统必须具有很高的可靠性。具体包括：

l 采用冗余结构，SMP对称处理器结构的处理器以及失效保护；

l 内存映射文件系统，可优化I/O频繁关系型数据库管理程序运行；

l 高速差错校验及纠错（ECC）的存储器特性，提供多路内存交叉存取；

l 使用热量少、可靠性高的部件及冗余电源/冷却模块来延长硬件寿命；

l 热更换硬件；

l 采用磁盘阵列，保证数据存取高可靠性；

l 系统具有图形化监控工具，强化远程控制及诊断功能，使其具有预防性维护功能。

l 扩展性：要求所选服务器的伸缩性及升级能力强，具有强大的可升级能力，以适应今后较长一段时间的业务处理。

l 通信能力：服务器通过各种方式与各类业务部门相连，因此在联网和远程通信能力方面有较高的要求，应该具备足够的通信接口，如：千兆以太网、100Base.TX（一个或多个端口），100Base.FX、ATM等。另外还应支持多种通信设备和协议。

l 安全性：包括能否适应较长时间的连续运行要求，出现故障后的自动恢复能力、内存保护能力和对数据所提供的安全保护能力等。

l 管理性：所选服务器应提供完备的运行监视系统及良好的界面工具、集成的远程控制台。易于管理人员对其进行管理和维护。

通过对3D系统服务器性能的分析，IBM system x3650 M2可以完全满足上述的技术参数和性能要求。